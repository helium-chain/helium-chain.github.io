<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ | Helium</title>
<meta name="keywords" content="golang, å‡½æ•°">
<meta name="description" content="ğŸ’¥æœ¬æ–‡ç« æ‰€æœ‰ç›¸å…³goä»£ç å‚è€ƒè‡ªgo 1.18&#43;ç‰ˆæœ¬">
<meta name="author" content="helium">
<link rel="canonical" href="https://heliu.site/posts/golang/func/align/">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://heliu.site/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://heliu.site/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://heliu.site/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://heliu.site/apple-touch-icon.png">
<link rel="mask-icon" href="https://heliu.site/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://heliu.site/posts/golang/func/align/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/style.css" />
    <style>
        body {
            font-family: "LXGW WenKai Lite", sans-serif;
            font-family: "LXGW WenKai Screen", sans-serif;
        }
    </style>
</head>
</html>

  

<meta property="og:title" content="å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ" />
<meta property="og:description" content="ğŸ’¥æœ¬æ–‡ç« æ‰€æœ‰ç›¸å…³goä»£ç å‚è€ƒè‡ªgo 1.18&#43;ç‰ˆæœ¬" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://heliu.site/posts/golang/func/align/" />
<meta property="og:image" content="https://heliu.site/favicon-32x32.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-08-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-08-05T00:00:00+00:00" /><meta property="og:site_name" content="Helium" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://heliu.site/favicon-32x32.png" />
<meta name="twitter:title" content="å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ"/>
<meta name="twitter:description" content="ğŸ’¥æœ¬æ–‡ç« æ‰€æœ‰ç›¸å…³goä»£ç å‚è€ƒè‡ªgo 1.18&#43;ç‰ˆæœ¬"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Article",
      "item": "https://heliu.site/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Golang åˆé›†",
      "item": "https://heliu.site/posts/golang/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "ç¬¬9ç«  Function",
      "item": "https://heliu.site/posts/golang/func/"
    }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ",
      "item": "https://heliu.site/posts/golang/func/align/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ",
  "name": "å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ",
  "description": "ğŸ’¥æœ¬æ–‡ç« æ‰€æœ‰ç›¸å…³goä»£ç å‚è€ƒè‡ªgo 1.18+ç‰ˆæœ¬",
  "keywords": [
    "golang", "å‡½æ•°"
  ],
  "articleBody": "å†…å­˜å¯¹é½ åœ¨Cè¯­è¨€å‡½æ•°è°ƒç”¨ä¸­ï¼Œé€šè¿‡æ ˆä¼ é€’çš„å‚æ•°éœ€è¦å¯¹é½åˆ°å¹³å°çš„ä½å®½ã€‚ å‡å¦‚é€šè¿‡æ ˆä¼ é€’4ä¸ªcharç±»å‹çš„å‚æ•°ï¼ŒGCCç”Ÿæˆçš„ 32 ä½ç¨‹åºéœ€è¦ 16 å­—èŠ‚ç©ºé—´ï¼Œ64 ä½ç¨‹åºéœ€è¦ 32 å­—èŠ‚æ ˆç©ºé—´ã€‚ å¦‚æœä¼ é€’å¤§é‡å‚æ•°ï¼Œåˆ™è¿™ç§å¯¹é½æ–¹å¼ä¼šå­˜åœ¨å¾ˆå¤§çš„æ ˆç©ºé—´æµªè´¹ã€‚ Goè¯­è¨€å‡½æ•°æ ˆå¸§ä¸­è¿”å›å€¼å’Œå‚æ•°çš„å¯¹é½æ–¹å¼ä¸ struct ç±»ä¼¼ï¼Œå¯¹äºæœ‰è¿”å›å€¼å’Œå‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥æŠŠæ‰€æœ‰è¿”å›å€¼å’Œæ‰€æœ‰å‚æ•°ç­‰ä»·æˆä¸¤ä¸ª structï¼š ä¸€ä¸ªã€è¿”å›å€¼ structã€‘ å’Œä¸€ä¸ªã€å‚æ•° structã€‘ã€‚ å› ä¸ºå†…å­˜å¯¹é½æ–¹å¼æ›´åŠ ç´§å‡‘ï¼Œæ‰€ä»¥åœ¨æ”¯æŒå¤§é‡å‚æ•°å’Œè¿”å›å€¼æ—¶èƒ½å¤Ÿåšåˆ°è¾ƒé«˜çš„æ ˆç©ºé—´åˆ©ç”¨ç‡ã€‚ é€šè¿‡å¦‚ä¸‹ç¤ºä¾‹å¯ä»¥éªŒè¯å‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„å¯¹é½æ–¹å¼ä¸ struct æˆå‘˜çš„å¯¹é½æ–¹å¼æ˜¯ä¸€è‡´çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š ä»¥ä¸Šçš„æè¿°éƒ½æ˜¯åœ¨å‡½æ•°é€šè¿‡æ ˆä¼ é€’å‚æ•°å’Œè¿”å›å€¼çš„åŸºç¡€ä¸Šçš„ã€‚åœ¨go1.18åç‰ˆæœ¬ä¸­é‡‡ç”¨äº†å¯„å­˜å™¨ä¼ å‚ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 package main type args struct { a int8 // 1 b int64 // 8 c int32 // 4 d int16 // 2 } //go:noinline func f1(a args) (r args) { println(\u0026r.d, \u0026r.c, \u0026r.b, \u0026r.a, \u0026a.d, \u0026a.c, \u0026a.b, \u0026a.a) return } //go:noinline func f2(aa int8, ab int64, ac int32, ad int16) (ra int8, rb int64, rc int32, rd int16) { println(\u0026rd, \u0026rc, \u0026rb, \u0026ra, \u0026ad, \u0026ac, \u0026ab, \u0026aa) return } func main() { f1(args{}) // 0xc000034744 r.d // 0xc000034740 r.c // 0xc000034738 r.b // 0xc000034730 r.a // 0xc00003476c a.d // 0xc000034768 a.c // 0xc000034760 a.b // 0xc000034758 a.a f2(0, 0, 0, 0) // 0xc00003473a rd // 0xc00003473c rc // 0xc000034740 rb // 0xc000034739 ra // 0xc00003476c ad // 0xc000034768 ac // 0xc000034760 ab // 0xc000034758 aa } æ±‡ç¼–ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 TEXT main.main(SB) /mnt/hgfs/workspace/helium/main.go func main() { 0x4551e0 493b6610 CMPQ 0x10(R14), SP 0x4551e4 7657 JBE 0x45523d 0x4551e6 4883ec38 SUBQ $0x38, SP 0x4551ea 48896c2430 MOVQ BP, 0x30(SP) 0x4551ef 488d6c2430 LEAQ 0x30(SP), BP f1(args{}) 0x4551f4 c644241800 MOVB $0x0, 0x18(SP) # a.a 0x4551f9 48c744242000000000 MOVQ $0x0, 0x20(SP) # a.b 0x455202 c744242800000000 MOVL $0x0, 0x28(SP) # a.c 0x45520a 66c744242c0000 MOVW $0x0, 0x2c(SP) # a.d 0x455211 0fb6442418 MOVZX 0x18(SP), AX # a.a AX 0x455216 488b5c2420 MOVQ 0x20(SP), BX # a.b BX 0x45521b 8b4c2428 MOVL 0x28(SP), CX # a.c CX 0x45521f 31ff XORL DI, DI # a.d DI 0x455221 e83a000000 CALL main.f1(SB) f2(0, 0, 0, 0) 0x455226 31c0 XORL AX, AX # aa AX 0x455228 31db XORL BX, BX # ab BX 0x45522a 31c9 XORL CX, CX # ac CX 0x45522c 31ff XORL DI, DI # ad DI 0x45522e e8ad010000 CALL main.f2(SB) } 0x455233 488b6c2430 MOVQ 0x30(SP), BP 0x455238 4883c438 ADDQ $0x38, SP 0x45523c c3 RET func main() { 0x45523d 0f1f00 NOPL 0(AX) 0x455240 e81bcdffff CALL runtime.morestack_noctxt.abi0(SB) 0x455245 eb99 JMP main.main(SB) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 TEXT main.f1(SB) /mnt/hgfs/workspace/helium/main.go func f1(a args) (r args) { 0x4551e0 493b6610 CMPQ 0x10(R14), SP 0x4551e4 0f8642010000 JBE 0x45532c 0x4551ea 4883ec68 SUBQ $0x68, SP 0x4551ee 48896c2460 MOVQ BP, 0x60(SP) 0x4551f3 488d6c2460 LEAQ 0x60(SP), BP # å‚æ•°åˆ†é…æ ˆå¤§å°ç©ºé—´ 0x4551f8 88442470 MOVB AL, 0x70(SP) # a.a 0x4551fc 48895c2478 MOVQ BX, 0x78(SP) # a.b 0x455201 898c2480000000 MOVL CX, 0x80(SP) # a.c 0x455208 6689bc2484000000 MOVW DI, 0x84(SP) # a.d # è¿”å›å€¼åˆ†é…æ ˆå¤§å°ç©ºé—´ 0x455210 c644240800 MOVB $0x0, 0x8(SP) # r.a 0x455215 48c744241000000000 MOVQ $0x0, 0x10(SP) # r.b 0x45521e c744241800000000 MOVL $0x0, 0x18(SP) # r.c 0x455226 66c744241c0000 MOVW $0x0, 0x1c(SP) # r.d println(\u0026r.d, \u0026r.c, \u0026r.b, \u0026r.a, \u0026a.d, \u0026a.c, \u0026a.b, \u0026a.a) ... ... 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 TEXT main.f2(SB) /mnt/hgfs/workspace/helium/main.go func f2(aa int8, ab int64, ac int32, ad int16) (ra int8, rb int64, rc int32, rd int16) { 0x455360 493b6610 CMPQ 0x10(R14), SP 0x455364 0f8631010000 JBE 0x45549b 0x45536a 4883ec60 SUBQ $0x60, SP 0x45536e 48896c2458 MOVQ BP, 0x58(SP) 0x455373 488d6c2458 LEAQ 0x58(SP), BP # å‚æ•°ä¼ å‚ï¼Œä½¿ç”¨å¯„å­˜å™¨ï¼Œä½†æ˜¯å‚æ•°ç©ºé—´è¿˜æ˜¯æ²¡æœ‰ä¼˜åŒ– 0x455378 88442468 MOVB AL, 0x68(SP) # aa 0x45537c 48895c2470 MOVQ BX, 0x70(SP) # ab 0x455381 894c2478 MOVL CX, 0x78(SP) # ac 0x455385 66897c247c MOVW DI, 0x7c(SP) # ad # è¿”å›å€¼åˆ†é…æ ˆå¤§å°ç©ºé—´ 0x45538a c644240900 MOVB $0x0, 0x9(SP) # ra 0x45538f 48c744241000000000 MOVQ $0x0, 0x10(SP) # rb 0x455398 c744240c00000000 MOVL $0x0, 0xc(SP) # rc 0x4553a0 66c744240a0000 MOVW $0x0, 0xa(SP) # rd println(\u0026rd, \u0026rc, \u0026rb, \u0026ra, \u0026ad, \u0026ac, \u0026ab, \u0026aa) ... ... é€ƒé€¸åˆ†æ ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(1) åœ¨è§£é‡Šé€ƒé€¸åˆ†æä¹‹å‰ï¼Œå…ˆæ¥æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æŠŠè‡ªå·²æ ˆå¸§ä¸ŠæŸä¸ªå±€éƒ¨å˜é‡çš„åœ°å€ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚ ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 package main func main() { println(*newInt()) } //go:noinline func newInt() *int { var a int return \u0026a } å‰é¢å¯¹å‡½æ•°æ ˆå¸ƒå±€çš„è®²è§£ newInt() å‡½æ•°çš„å±€éƒ¨å˜é‡aåº”è¯¥åˆ†é…åœ¨å‡½æ•°æ ˆçš„ locals åŒºé—´ã€‚ åœ¨newInt()å‡½æ•°è¿”å›åï¼Œå®ƒçš„æ ˆéšå³é”€æ¯ï¼Œè¿”å›çš„å˜é‡açš„åœ°å€å°±ä¼šå˜æˆä¸€ä¸ªæ‚¬æŒ‚æŒ‡é’ˆï¼Œcaller ä¸­å¯¹è¯¥åœ°å€è¿›è¡Œçš„æ‰€æœ‰è¯»å†™éƒ½æ˜¯ä¸åˆæ³•çš„ï¼Œä¼šé€ æˆç¨‹åºé€»è¾‘é”™è¯¯ç”šè‡³å´©æºƒã€‚ äº‹å®æ˜¯è¿™æ ·çš„å—ï¼Ÿä¸Šè¿°åˆ†ææœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå³å˜é‡ a è¢«åˆ†é…åœ¨æ ˆä¸Šã€‚å‡å¦‚ç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æµ‹åˆ°è¿™ç§æ¨¡å¼ï¼Œè€Œè‡ªåŠ¨æŠŠå˜é‡ a æ”¹ä¸ºå †åˆ†é…ï¼Œå°±ä¸å­˜åœ¨ä¸Šè¿°é—®é¢˜äº†ã€‚ åç¼–è¯‘ newInt() å‡½æ•°ï¼Œçœ‹ä¸€ä¸‹ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š é‡ç‚¹å…³æ³¨ä¸Šè¿°æ±‡ç¼–ä»£ç ä¸­ runtime.newobject() å‡½æ•°è°ƒç”¨ï¼Œè¯¥å‡½æ•°æ˜¯ Go è¯­è¨€å†…ç½®å‡½æ•° new() çš„å…·ä½“å®ç°ï¼Œç”¨æ¥åœ¨è¿è¡Œé˜¶æ®µåˆ†é…å•ä¸ªå¯¹è±¡ã€‚ CALL æŒ‡ä»¤ AX å¯„å­˜å™¨å°±æ˜¯ *int ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›çš„å€¼ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 TEXT main.newInt(SB) /mnt/hgfs/workspace/helium/main.go func newInt() *int { 0x455240 493b6610 CMPQ 0x10(R14), SP # æ ˆå¢é•¿åˆ¤æ–­ 0x455244 7643 JBE 0x455289 0x455246 4883ec28 SUBQ $0x28, SP 0x45524a 48896c2420 MOVQ BP, 0x20(SP) 0x45524f 488d6c2420 LEAQ 0x20(SP), BP 0x455254 48c744241000000000 MOVQ $0x0, 0x10(SP) # *int ä¸´æ—¶è¿”å›å€¼ç©ºé—´ var a int 0x45525d 488d05bc4a0000 LEAQ 0x4abc(IP), AX # type.int å…ƒç±»å‹ # func newobject(typ *_type) unsafe.Pointer # è¿™é‡Œè°ƒç”¨ newobject å‡½æ•°è¿›è¡Œäº†å †åˆ†é… 0x455264 e8d75cfbff CALL runtime.newobject(SB) # AX=*int ç±»å‹ 0x455269 4889442418 MOVQ AX, 0x18(SP) 0x45526e 48c70000000000 MOVQ $0x0, 0(AX) # *a=0 return \u0026a 0x455275 488b442418 MOVQ 0x18(SP), AX 0x45527a 4889442410 MOVQ AX, 0x10(SP) # è¿”å›å€¼ AX 0x45527f 488b6c2420 MOVQ 0x20(SP), BP 0x455284 4883c428 ADDQ $0x28, SP 0x455288 c3 RET func newInt() *int { 0x455289 e8d2ccffff CALL runtime.morestack_noctxt.abi0(SB) 0x45528e ebb0 JMP main.newInt(SB) å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(2) å¦‚æœæŠŠ newInt() å‡½æ•°ä¸­çš„å–åœ°å€è¿ç®—æ”¹æˆä½¿ç”¨å†…ç½®å‡½æ•° new()ï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 //go:noinline func newInt() *int { return new(int) } ç›¸å…³æ±‡ç¼–ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ go build -gcflags=\"-N -l\" -o ./h1 myzx.cn/helium $ go tool objdump -S -s '^main.newInt$' ./h1 TEXT main.newInt(SB) /mnt/hgfs/workspace/helium/main.go func newInt() *int { 0x455240 493b6610 CMPQ 0x10(R14), SP 0x455244 7637 JBE 0x45527d 0x455246 4883ec28 SUBQ $0x28, SP 0x45524a 48896c2420 MOVQ BP, 0x20(SP) 0x45524f 488d6c2420 LEAQ 0x20(SP), BP 0x455254 48c744241000000000 MOVQ $0x0, 0x10(SP) # *int è¿”å›å€¼ç©ºé—´ return new(int) # func newobject(typ *_type) unsafe.Pointer 0x45525d 488d05bc4a0000 LEAQ 0x4abc(IP), AX # type.int å…ƒç±»å‹ 0x455264 e8d75cfbff CALL runtime.newobject(SB) # AX=*int 0x455269 4889442418 MOVQ AX, 0x18(SP) 0x45526e 4889442410 MOVQ AX, 0x10(SP) 0x455273 488b6c2420 MOVQ 0x20(SP), BP 0x455278 4883c428 ADDQ $0x28, SP 0x45527c c3 RET func newInt() *int { 0x45527d 0f1f00 NOPL 0(AX) 0x455280 e8dbccffff CALL runtime.morestack_noctxt.abi0(SB) 0x455285 ebb9 JMP main.newInt(SB) å½“å‡½æ•°å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡å‡½æ•°æ ˆçš„ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œç¼–è¯‘å™¨æŠŠè¯¥å±€éƒ¨å˜é‡ç”±æ ˆåˆ†é…æ”¹ä¸ºå †åˆ†é…ï¼Œå³å˜é‡ä»æ ˆä¸Šé€ƒé€¸åˆ°å †ä¸Šã€‚ ä¸é€ƒé€¸åˆ†æ åªè¦ä½¿ç”¨äº†new()å‡½æ•°å°±ä¼šé€ æˆå †åˆ†é…?\nå‰é¢é€ƒé€¸åˆ†æä»£ç ç¤ºä¾‹ä¸­å°†å‡½æ•°çš„æŸä¸ªå±€éƒ¨å˜é‡çš„åœ°å€ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œæˆ–è€…é€šè¿‡å†…ç½®å‡½æ•° new() åŠ¨æ€åˆ†é…å˜é‡å¹¶è¿”å›å…¶åœ°å€ã€‚ å…¶ä¸­å†…ç½®å‡½æ•°new()æœ‰ç€éå¸¸æ˜æ˜¾çš„å †åˆ†é…çš„å«ä¹‰ï¼Œæ˜¯ä¸æ˜¯åªè¦ä½¿ç”¨äº†new()å‡½æ•°å°±ä¼šé€ æˆå †åˆ†é…å‘¢ï¼Ÿ è¿›ä¸€æ­¥çŒœæƒ³ï¼Œå¦‚æœå¯¹å±€éƒ¨å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œä¼šè¢«è½¬æ¢ä¸ºnew()å‡½æ•°è°ƒç”¨ï¼Œé‚£å°±ä¸ä¼šè¿›è¡Œæ‰€è°“çš„é€ƒé€¸åˆ†æäº†ã€‚ å…ˆéªŒè¯new()å‡½æ•°ä¸å †åˆ†é…æ˜¯å¦æœ‰å¿…ç„¶å…³ç³»ï¼Œä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 //go:noinline func New() int { p := new(int) return *p } åç¼–è¯‘new()å‡½æ•°ï¼Œå¾—åˆ°çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š å³ä¾¿ä»£ç ä¸­ä½¿ç”¨äº†new()å‡½æ•°ï¼Œåªè¦å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰è¶…è¿‡è¿‡å½“å‰å‡½æ•°æ ˆçš„ç”Ÿå‘½å‘¨æœŸï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šè¿›è¡Œå †åˆ†é…ã€‚ äº‹å®ä¸Šï¼Œåªè¦ä»£ç é€»è¾‘å…è®¸ï¼Œç¼–è¯‘å™¨æ€»æ˜¯å€¾å‘äºæŠŠå˜é‡åˆ†é…åœ¨æ ˆä¸Šï¼Œå› ä¸ºæ¯”é…åœ¨å †ä¸Šæ›´é«˜æ•ˆã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 TEXT main.New(SB) /mnt/hgfs/workspace/helium/main.go func New() int { 0x455240 4883ec20 SUBQ $0x20, SP 0x455244 48896c2418 MOVQ BP, 0x18(SP) 0x455249 488d6c2418 LEAQ 0x18(SP), BP 0x45524e 48c7042400000000 MOVQ $0x0, 0(SP) # è¿”å›åœ°å€ int p := new(int) # new å‡½æ•°ç›´æ¥æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ 0x455256 48c744240800000000 MOVQ $0x0, 0x8(SP) # 0x8(SP) ç”¨ä½œintç±»å‹å­˜å‚¨ 0 0x45525f 488d4c2408 LEAQ 0x8(SP), CX # CX=0x8(SP); ä¹Ÿå°±æ˜¯ *int 0x455264 48894c2410 MOVQ CX, 0x10(SP) # 0x10(SP); *int return *p 0x455269 8401 TESTB AL, 0(CX) 0x45526b 488b442408 MOVQ 0x8(SP), AX 0x455270 48890424 MOVQ AX, 0(SP) 0x455274 488b6c2418 MOVQ 0x18(SP), BP 0x455279 4883c420 ADDQ $0x20, SP 0x45527d c3 RET è¿™ä¹Ÿå°±æ˜¯æœ¬èŠ‚æ‰€è°“çš„ä¸é€ƒé€¸åˆ†æï¼Œæˆ–è€…è¯´æœªé€ƒé€¸åˆ†æï¼Œè¿™ç§è¯´æ³•å¹¶ä¸ä¸¥è°¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†çªå‡ºç¼–è¯‘å™¨å€¾å‘äºè®©å˜é‡ä¸é€ƒé€¸ã€‚ ä¸é€ƒé€¸åˆ¤æ–­ åŒ…çº§åˆ«æŒ‡é’ˆ(1) æœ¬èŠ‚ä¸»è¦æ¢ç´¢ç¼–è¯‘å™¨è¿›è¡Œé€ƒé€¸åˆ†ææ—¶è¿½è¸ªçš„èŒƒå›´ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å°±è®¤ä¸ºå˜é‡é€ƒé€¸äº†æˆ–è€…ç¡®å®šå˜é‡æ²¡æœ‰é€ƒé€¸ã€‚ å‰é¢ç ”ç©¶å˜é‡é€ƒé€¸æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡è®©å‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œä½¿å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡å¯¹åº”å‡½æ•°æ ˆå¸§çš„ç”Ÿå‘½å‘¨æœŸã€‚ æŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥çŒœæƒ³ï¼Œå¦‚æœæŠŠå±€éƒ¨å˜é‡çš„åœ°å€èµ‹å€¼ç»™åŒ…çº§åˆ«çš„æŒ‡é’ˆå˜é‡ï¼Œåº”è¯¥ä¹Ÿä¼šé€ æˆå˜é‡é€ƒé€¸ã€‚ å‡†å¤‡ä¸€ä¸ªç¤ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 var pt *int //go:noinline func setNew() { var a int pt = \u0026a } åç¼–è¯‘ setNew() å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 TEXT main.setNew(SB) /mnt/hgfs/workspace/helium/main.go func setNew() { 0x455220 493b6610 CMPQ 0x10(R14), SP # æ ˆå¢é•¿åˆ¤æ–­ 0x455224 765d JBE 0x455283 0x455226 4883ec20 SUBQ $0x20, SP 0x45522a 48896c2418 MOVQ BP, 0x18(SP) 0x45522f 488d6c2418 LEAQ 0x18(SP), BP var a int 0x455234 488d05e54a0000 LEAQ 0x4ae5(IP), AX # type.int å…ƒç±»å‹ 0x45523b 0f1f440000 NOPL 0(AX)(AX*1) # func newobject(typ *_type) unsafe.Pointer # è¿™é‡Œç›´æ¥è°ƒç”¨äº† newobject å †åˆ†é…äº† int 0x455240 e8fb5cfbff CALL runtime.newobject(SB) # *int 0x455245 4889442410 MOVQ AX, 0x10(SP) 0x45524a 48c70000000000 MOVQ $0x0, 0(AX) # a = 0 pt = \u0026a 0x455251 488b4c2410 MOVQ 0x10(SP), CX # CX=0x10(SP)=*int # åˆ¤æ–­æ˜¯å¦å¼€å¯å†™å±éšœï¼Œå› ä¸ºå¯èƒ½åœ¨GCé˜¶æ®µï¼Œå˜é‡çš„èµ‹å€¼éœ€è¦å†™å±éšœ 0x455256 833d0320090000 CMPL $0x0, runtime.writeBarrier(SB) 0x45525d 7403 JE 0x455262 0x45525f 90 NOPL 0x455260 eb09 JMP 0x45526b 0x455262 48890db7320600 MOVQ CX, main.pt(SB) # ç»™å…¨å±€å˜é‡ pt èµ‹å€¼ 0x455269 eb0e JMP 0x455279 0x45526b 488d3dae320600 LEAQ main.pt(SB), DI # å†™å±éšœå¼€å¯çš„æ—¶å€™è°ƒç”¨å†™å±éšœç›¸å…³å‡½æ•°ï¼Œè®°å½•æŒ‡é’ˆçš„å˜æ›´ï¼Œå·²å¸®åŠ©GC 0x455272 e8a9d0ffff CALL runtime.gcWriteBarrierCX(SB) 0x455277 eb00 JMP 0x455279 } 0x455279 488b6c2418 MOVQ 0x18(SP), BP 0x45527e 4883c420 ADDQ $0x20, SP 0x455282 c3 RET func setNew() { 0x455283 e8d8ccffff CALL runtime.morestack_noctxt.abi0(SB) 0x455288 eb96 JMP main.setNew(SB) é€šè¿‡ runtime.newobject() å‡½æ•°è°ƒç”¨å°±èƒ½ç¡®å®šï¼Œå˜é‡aé€ƒé€¸åˆ°äº†å †ä¸Šï¼ŒéªŒè¯äº†ä¸Šè¿°çŒœæƒ³ã€‚ åŒ…çº§åˆ«æŒ‡é’ˆ(2) è¿›ä¸€æ­¥è¿˜å¯ä»¥éªŒè¯é€ƒé€¸åˆ†æçš„ä¾èµ–ä¼ é€’æ€§ï¼Œå‡†å¤‡ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 var pp **int //go:noinline func dep() { var a int var p *int p = \u0026a pp = \u0026p } åç¼–è¯‘ dep() å‡½æ•°ï¼š å¯ä»¥å‘ç°ï¼Œå˜é‡ p å’Œ a éƒ½é€ƒé€¸äº†ã€‚ p çš„åœ°å€è¢«èµ‹å€¼ç»™åŒ…çº§åˆ«çš„æŒ‡é’ˆå˜é‡ ppï¼Œè€Œ a çš„åœ°å€åˆè¢«èµ‹å€¼ç»™äº† pï¼Œå› ä¸º p é€ƒé€¸é€ æˆ a ä¹Ÿé€ƒé€¸äº†ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 TEXT main.dep(SB) /mnt/hgfs/workspace/helium/main.go func dep() { 0x455220 493b6610 CMPQ 0x10(R14), SP # æ ˆå¢é•¿åˆ¤æ–­ 0x455224 0f86b0000000 JBE 0x4552da 0x45522a 4883ec28 SUBQ $0x28, SP 0x45522e 48896c2420 MOVQ BP, 0x20(SP) 0x455233 488d6c2420 LEAQ 0x20(SP), BP var a int 0x455238 488d05e14a0000 LEAQ 0x4ae1(IP), AX # type.int å…ƒç±»å‹; 0x45523f 90 NOPL # func newobject(typ *_type) unsafe.Pointer 0x455240 e8fb5cfbff CALL runtime.newobject(SB) # å †åˆ†é…äº† a å˜é‡; AX *int 0x455245 4889442418 MOVQ AX, 0x18(SP) # 0x18(SP); æ˜¯açš„å†…å­˜ç©ºé—´ï¼ŒæŒ‡å‘å †åˆ†é…æ•°æ® 0x45524a 48c70000000000 MOVQ $0x0, 0(AX) # åˆå§‹åŒ– 0 var p *int 0x455251 488d0508320000 LEAQ 0x3208(IP), AX # type *int å…ƒç±»å‹ # func newobject(typ *_type) unsafe.Pointer 0x455258 e8e35cfbff CALL runtime.newobject(SB) # **int 0x45525d 4889442410 MOVQ AX, 0x10(SP) 0x455262 833df71f090000 CMPL $0x0, runtime.writeBarrier(SB) 0x455269 7402 JE 0x45526d 0x45526b eb09 JMP 0x455276 0x45526d 48c70000000000 MOVQ $0x0, 0(AX) 0x455274 eb11 JMP 0x455287 0x455276 4889c7 MOVQ AX, DI 0x455279 31c0 XORL AX, AX 0x45527b 0f1f440000 NOPL 0(AX)(AX*1) 0x455280 e89bcfffff CALL runtime.gcWriteBarrier(SB) 0x455285 eb00 JMP 0x455287 p = \u0026a 0x455287 488b7c2410 MOVQ 0x10(SP), DI 0x45528c 488b442418 MOVQ 0x18(SP), AX 0x455291 833dc81f090000 CMPL $0x0, runtime.writeBarrier(SB) 0x455298 7402 JE 0x45529c 0x45529a eb06 JMP 0x4552a2 0x45529c 488907 MOVQ AX, 0(DI) 0x45529f 90 NOPL 0x4552a0 eb07 JMP 0x4552a9 0x4552a2 e879cfffff CALL runtime.gcWriteBarrier(SB) 0x4552a7 eb00 JMP 0x4552a9 pp = \u0026p 0x4552a9 488b442410 MOVQ 0x10(SP), AX 0x4552ae 833dab1f090000 CMPL $0x0, runtime.writeBarrier(SB) 0x4552b5 7402 JE 0x4552b9 0x4552b7 eb09 JMP 0x4552c2 0x4552b9 48890560320600 MOVQ AX, main.pp(SB) 0x4552c0 eb0e JMP 0x4552d0 0x4552c2 488d3d57320600 LEAQ main.pp(SB), DI 0x4552c9 e852cfffff CALL runtime.gcWriteBarrier(SB) 0x4552ce eb00 JMP 0x4552d0 } 0x4552d0 488b6c2420 MOVQ 0x20(SP), BP 0x4552d5 4883c428 ADDQ $0x28, SP 0x4552d9 c3 RET func dep() { 0x4552da e881ccffff CALL runtime.morestack_noctxt.abi0(SB) 0x4552df 90 NOPL 0x4552e0 e93bffffff JMP main.dep(SB) å‡å¦‚æŸä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªè¿”å›å€¼ï¼Œç±»å‹éƒ½æ˜¯æ•´å‹æŒ‡é’ˆï¼Œå‡½æ•°åªæ˜¯ç®€å•åœ°æŠŠå‚æ•°ä½œä¸ºè¿”å›å€¼ã€‚ åœ¨å‡½æ•°é—´ä¼ é€’ å°±åƒä¸‹é¢çš„ gom.RetArg() å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 package gom //go:noinline func RetArg(p *int) *int { return p } åœ¨å¦ä¸€ä¸ªåŒ…ä¸­ arg() å‡½æ•°è°ƒç”¨äº† inner.RetArg() å‡½æ•°å°†å±€éƒ¨å˜é‡ a çš„åœ°å€ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›äº†ä¸€ä¸ª int ç±»å‹çš„è¿”å›å€¼ã€‚ ä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 package main //go:noinline func arg() int { var a int return *gom.RetArg(\u0026a) } åœ¨ arg() å‡½æ•°ä¸­å¹¶æ²¡æœ‰æŠŠå˜é‡ a çš„åœ°å€ä½œä¸ºè¿”å›å€¼ï¼Œä¹Ÿä¸å­˜åœ¨åˆ°æŸä¸ªåŒ…çº§åˆ«æŒ‡é’ˆå˜é‡çš„ä¾èµ–é“¾è·¯ï¼Œæ‰€ä»¥å˜é‡aæ˜¯å¦ä¼šé€ƒé€¸çš„å…³é”®å°±åœ¨äºinner.RetArg()å‡½æ•°ã€‚ inner. RetArg()å‡½æ•°åªæ˜¯æŠŠä¼ è¿‡å»çš„æŒ‡é’ˆåˆä¼ äº†å›æ¥ï¼Œè€Œä¸”ä½œä¸ºè¢«è°ƒç”¨è€…æ¥è®²ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å®Œå…¨åŒ…å«åœ¨arg()å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸä»¥å†…çš„ï¼Œæ‰€ä»¥ä¸åº”è¯¥é€ æˆå˜é‡ a é€ƒé€¸ã€‚ äº‹å®åˆ°åº•å¦‚ä½•å‘¢? è¿˜è¦é€šè¿‡åç¼–è¯‘éªŒè¯ï¼ŒèŠ‚é€‰éƒ¨åˆ†å…³é”®æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š å˜é‡aç¡®å®æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œä¹Ÿå°±è¯´æ˜ç¼–è¯‘å™¨å‚è€ƒäº†inner.RetArg()å‡½æ•°çš„å…·ä½“å®ç°ï¼ŒåŸºäºä»£ç é€»è¾‘åˆ¤å®šå˜é‡ a æ²¡æœ‰é€ƒé€¸ã€‚ è™½ç„¶ä»£ç ä¸­é€šè¿‡**noinlineé˜»æ­¢äº†å†…è”ä¼˜åŒ–ï¼Œä½†æ˜¯æ²¡èƒ½é˜»æ­¢ç¼–è¯‘å™¨å‚è€ƒå‡½æ•°å®ç°**ã€‚ å‡å¦‚é€šè¿‡æŸç§æ–¹å¼èƒ½å¤Ÿé˜»æ­¢ç¼–è¯‘å™¨å‚è€ƒå‡½æ•°å®ç°ï¼Œåˆä¼šæœ‰ä»€ä¹ˆæ ·çš„ç»“æœå‘¢? 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 TEXT main.arg(SB) /mnt/hgfs/workspace/helium/main.go func arg() int { 0x455240 493b6610 CMPQ 0x10(R14), SP # æ ˆå¢é•¿åˆ¤æ–­ 0x455244 7643 JBE 0x455289 0x455246 4883ec28 SUBQ $0x28, SP 0x45524a 48896c2420 MOVQ BP, 0x20(SP) 0x45524f 488d6c2420 LEAQ 0x20(SP), BP 0x455254 48c744240800000000 MOVQ $0x0, 0x8(SP) # return int var a int 0x45525d 48c744241000000000 MOVQ $0x0, 0x10(SP) return *gom.RetArg(\u0026a) # å¯ä»¥çœ‹å‡ºè¿™é‡Œè°ƒç”¨gom.RetArgå‡½æ•°æ—¶å‚æ•°ç›´æ¥æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œå¹¶æ²¡æœ‰å †åˆ†é… 0x455266 488d442410 LEAQ 0x10(SP), AX 0x45526b e870ffffff CALL example.com/helium/gom.RetArg(SB) 0x455270 4889442418 MOVQ AX, 0x18(SP) 0x455275 8400 TESTB AL, 0(AX) 0x455277 488b00 MOVQ 0(AX), AX 0x45527a 4889442408 MOVQ AX, 0x8(SP) 0x45527f 488b6c2420 MOVQ 0x20(SP), BP 0x455284 4883c428 ADDQ $0x28, SP 0x455288 c3 RET func arg() int { 0x455289 e8d2ccffff CALL runtime.morestack_noctxt.abi0(SB) 0x45528e ebb0 JMP main.arg(SB) linkname æœºåˆ¶ å¯ä»¥ä½¿ç”¨ linkname æœºåˆ¶ï¼Œè¿åŒä¿®æ”¹åçš„ arg() å‡½æ•°çš„ä»£ç å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \"example.com/helium/gom\" _ \"unsafe\" // ä½¿ç”¨äº† go:linkname å¿…é¡»è¦å¼•å…¥ unsafe åŒ… ) func main() { arg() } //go:linkname retArg example.com/helium/gom.RetArg func retArg(p *int) *int //go:noinline func arg() int { var a int var b int return *gom.RetArg(\u0026a) + retArg(\u0026b) } å†æ¬¡åç¼–è¯‘ arg() å‡½æ•°ï¼ŒèŠ‚é€‰å˜é‡ a å’Œ b åˆ†é…ç›¸å…³çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š å˜é‡ a ä¾æ—§æ˜¯æ ˆåˆ†é…ï¼Œå˜é‡ b å·²ç»é€ƒé€¸äº†ã€‚ åœ¨ä¸Šè¿°ä»£ç ä¸­çš„ retArg() å‡½æ•°åªæ˜¯ä¸ªå‡½æ•°å£°æ˜æ²¡æœ‰ç»™å‡ºå…·ä½“å®ç°ï¼Œé€šè¿‡ linkname æœºåˆ¶è®©é“¾æ¥å™¨åœ¨é“¾æ¥é˜¶æ®µé“¾æ¥åˆ° inner.RetArg() å‡½æ•°ã€‚ retArg() å‡½æ•°åªæœ‰å£°æ˜æ²¡æœ‰å®ç°ï¼Œè€Œä¸”ç¼–è¯‘å™¨ä¸ä¼šè·Ÿè¸ª linknameï¼Œæ‰€ä»¥æ— æ³•æ ¹æ®ä»£ç é€»è¾‘åˆ¤å®šå˜é‡ b åˆ°åº•æœ‰æ²¡æœ‰é€ƒé€¸ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 TEXT main.arg(SB) /mnt/hgfs/workspace/helium/main.go func arg() int { 0x455240 493b6610 CMPQ 0x10(R14), SP # æ ˆå¢é•¿åˆ¤æ–­ 0x455244 7677 JBE 0x4552bd 0x455246 4883ec40 SUBQ $0x40, SP 0x45524a 48896c2438 MOVQ BP, 0x38(SP) 0x45524f 488d6c2438 LEAQ 0x38(SP), BP 0x455254 48c744241000000000 MOVQ $0x0, 0x10(SP) # return int var a int 0x45525d 48c744241800000000 MOVQ $0x0, 0x18(SP) # a,0 var b int 0x455266 488d05b34a0000 LEAQ 0x4ab3(IP), AX # type.int 0x45526d e8ce5cfbff CALL runtime.newobject(SB) # *int 0x455272 4889442430 MOVQ AX, 0x30(SP) # å˜é‡bï¼Œå †åˆ†é…äº† 0x455277 48c70000000000 MOVQ $0x0, 0(AX) return *gom.RetArg(\u0026a) + *retArg(\u0026b) 0x45527e 488d442418 LEAQ 0x18(SP), AX 0x455283 e858ffffff CALL example.com/helium/gom.RetArg(SB) 0x455288 4889442428 MOVQ AX, 0x28(SP) 0x45528d 488b442430 MOVQ 0x30(SP), AX 0x455292 e849ffffff CALL example.com/helium/gom.RetArg(SB) 0x455297 4889442420 MOVQ AX, 0x20(SP) 0x45529c 488b4c2428 MOVQ 0x28(SP), CX 0x4552a1 8401 TESTB AL, 0(CX) 0x4552a3 8400 TESTB AL, 0(AX) 0x4552a5 488b09 MOVQ 0(CX), CX 0x4552a8 480308 ADDQ 0(AX), CX 0x4552ab 48894c2410 MOVQ CX, 0x10(SP) 0x4552b0 4889c8 MOVQ CX, AX 0x4552b3 488b6c2438 MOVQ 0x38(SP), BP 0x4552b8 4883c440 ADDQ $0x40, SP 0x4552bc c3 RET func arg() int { 0x4552bd 0f1f00 NOPL 0(AX) 0x4552c0 e89bccffff CALL runtime.morestack_noctxt.abi0(SB) 0x4552c5 e976ffffff JMP main.arg(SB) æŠŠé€»è¾‘ä¸Šæ²¡æœ‰é€ƒé€¸çš„å˜é‡åˆ†é…åˆ°å †ä¸Šä¸ä¼šé€ æˆé”™è¯¯ï¼Œåªæ˜¯æ•ˆç‡ä½ä¸€äº›ã€‚ ä½†æ˜¯æŠŠé€»è¾‘ä¸Šé€ƒé€¸äº†çš„å˜é‡åˆ†é…åˆ°æ ˆä¸Šå°±ä¼šé€ æˆæ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ã€‚ å› æ­¤ç¼–è¯‘å™¨åªæœ‰åœ¨èƒ½å¤Ÿç¡®å®šå˜é‡æ²¡æœ‰é€ƒé€¸çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†å…¶åˆ†é…åˆ°æ ˆä¸Šï¼Œåœ¨èƒ½å¤Ÿç¡®å®šå˜é‡å·²ç»é€ƒé€¸æˆ–æ— æ³•ç¡®å®šåˆ°åº•æœ‰æ²¡æœ‰é€ƒé€¸çš„æƒ…å†µä¸‹ï¼Œéƒ½è¦æŒ‰ç…§å·²ç»é€ƒé€¸æ¥å¤„ç†ã€‚ è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ä¸Šè¿°ä»£ç ä¸­çš„å˜é‡ b é€»è¾‘ä¸Šæ²¡é€ƒé€¸å´è¢«åˆ†é…åœ¨äº†å †ä¸Šã€‚ å‡½æ•°ç¤ºä¾‹ ç¤ºä¾‹ä¸€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 package main func main() { sum(1, 2) } // sum è®¡ç®—a, bçš„å¹³æ–¹å’Œ func sum(a, b int) int { a2 := a * a b2 := b * b c := a2 + b2 return c } main.mainæ±‡ç¼–ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 TEXT main.main(SB) /mnt/hgfs/g/hello1/hello.go # åˆ¤æ–­æ ˆæ˜¯å¦æº¢å‡º 0x10(R14)æŒ‡å‘g.stackguard0ä½ç½® hello.go:3 0x45b4a0 493b6610 cmp rsp, qword ptr [r14+0x10] cmp 0x10(R14), rsp # è·³è½¬åˆ°0x45b4cfå¤„è®¾ç½®æ ˆä¿¡æ¯ï¼Œåœ¨é‡æ–°è°ƒmain.mainå‡½æ•° hello.go:3 0x45b4a4 7629 jbe 0x45b4cf jbe 0x45b4cf # ä¸ºå½“å‰æ ˆé¢„åˆ†é…å‚æ•°ç©ºé—´ï¼Œç¬¬ä¸€ä¸ª8Bå­˜å‚¨runtime.mainçš„rbpï¼Œç¬¬äºŒä¸ª8Bå­˜å‚¨main.sunçš„å‚æ•°bä¸º1ï¼Œç¬¬ä¸‰ä¸ª8Bå­˜å‚¨main.sunçš„å‚æ•°aä¸º2 hello.go:3 0x45b4a6 4883ec18 sub rsp, 0x18 sub 0x18, rsp # æŠŠruntime.mainçš„æ ˆrbpå­˜å…¥0x10(rsp)å¤„ hello.go:3 0x45b4aa 48896c2410 mov qword ptr [rsp+0x10], rbp mov rbp, 0x10(rsp) # ä»æ–°è®¾ç½®å½“å‰main.mainçš„æ ˆrbpå€¼ä¸º0x10(rsp)å¤„ hello.go:3 0x45b4af 488d6c2410 lea rbp, ptr [rsp+0x10] lea 0x10(rsp), rbp # ä¸ºmain.sumå‡†å¤‡ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾å…¥å¯„å­˜å™¨AXä¸­ hello.go:4 0x45b4b4 b801000000 mov eax, 0x1 mov 0x1, AX # ä¸ºmain.sumå‡†å¤‡ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ”¾å…¥å¯„å­˜å™¨BXä¸­ hello.go:4 0x45b4b9 bb02000000 mov ebx, 0x2 mov 0x2, BX hello.go:4 0x45b4be 6690 data16 nop hello.go:4 0x45b4c0 e81b000000 call $main.sum call $main.sum # æŠŠruntime.mainçš„æ ˆrbpå€¼ä»0x10(rsp)å¤„æ”¾å…¥rbpå¯„å­˜å™¨ hello.go:5 0x45b4c5 488b6c2410 mov rbp, qword ptr [rsp+0x10] mov 0x10(rsp), rbp # rspå¯„å­˜å™¨æ¢å¤è°ƒç”¨main.mainä¹‹å‰æƒ…å†µ hello.go:5 0x45b4ca 4883c418 add rsp, 0x18 add 0x18, rsp # è¿”å›ï¼Œrsp-8å¼¹å‡ºè¿”å›åœ°å€ç»™ripè¿”å›çš„runtime.mainç»§ç»­æ‰§è¡Œ hello.go:5 0x45b4ce c3 ret ret hello.go:3 0x45b4cf e88ccdffff call $runtime.morestack_noctxt call $runtime.morestack_noctxt .:0 0x45b4d4 ebca jmp $main.main jmp $main.main main.sumæ±‡ç¼–ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 TEXT main.sum(SB) /mnt/hgfs/g/hello1/hello.go # ä¸ºmain.sumæ ˆé¢„åˆ†é…0x28ç©ºé—´ hello.go:8 0x45b4e0 4883ec28 sub rsp, 0x28 sub 0x28, rsp # æŠŠmain.mainçš„rbpå­˜å‚¨åˆ°0x20(rsp)ä½ç½® hello.go:8 0x45b4e4 48896c2420 mov qword ptr [rsp+0x20], rbp mov rbp, 0x20(rsp) # ä»æ–°è®¾ç½®main.sumçš„rbpå€¼ hello.go:8 0x45b4e9 488d6c2420 lea rbp, ptr [rsp+0x20] lea 0x20(rsp), rbp # æŠŠä¼ é€’çš„ç¬¬ä¸€ä¸ªå‚æ•°å…¥æ ˆï¼Œæ³¨æ„çœ‹è¿™é‡Œå‚å‚æ•°æ ˆåˆ†é…åœ¨main.mainçš„æ ˆä¸Š hello.go:8 0x45b4ee 4889442430 mov qword ptr [rsp+0x30], rax mov AX, 0x30(rsp) # a = 1 # æŠŠä¼ é€’çš„ç¬¬äºŒä¸ªå‚æ•°å…¥æ ˆï¼Œæ³¨æ„çœ‹è¿™é‡Œå‚å‚æ•°æ ˆåˆ†é…åœ¨main.mainçš„æ ˆä¸Š hello.go:8 0x45b4f3 48895c2438 mov qword ptr [rsp+0x38], rbx mov BX, 0x38(rsp) # b = 2 # åˆå§‹åŒ–rspçš„ç¬¬ä¸€ä¸ª8å­—èŠ‚å—ï¼Œè¿”å›å€¼ç©ºé—´åˆå§‹åŒ– hello.go:8 0x45b4f8 48c7042400000000 mov qword ptr [rsp], 0x0 mov 0x0, (rsp) # return # ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡açš„å€¼æ”¾å…¥å¯„å­˜å™¨ hello.go:9 0x45b500 488b4c2430 mov rcx, qword ptr [rsp+0x30] mov 0x30(rsp), CX # ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡açš„å€¼æ”¾å…¥å¯„å­˜å™¨ hello.go:9 0x45b505 488b542430 mov rdx, qword ptr [rsp+0x30] mov 0x30(rsp), DX # ä¹˜æ³•è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨DXä¸­ hello.go:9 0x45b50a 480fafd1 imul rdx, rcx imul CX, DX # a*a # 0X18(rsp)çš„åœ°å€ä¸ºå˜é‡a2 hello.go:9 0x45b50e 4889542418 mov qword ptr [rsp+0x18], rdx mov DX, 0X18(rsp) # a2=a*a # ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡bçš„å€¼æ”¾å…¥å¯„å­˜å™¨ hello.go:10 0x45b513 488b4c2438 mov rcx, qword ptr [rsp+0x38] mov 0x38(rsp), CX # ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡bçš„å€¼æ”¾å…¥å¯„å­˜å™¨ hello.go:10 0x45b518 488b542438 mov rdx, qword ptr [rsp+0x38] mov 0x38(rsp), DX # ä¹˜æ³•è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨DXä¸­ hello.go:10 0x45b51d 480fafd1 imul rdx, rcx imul CX, DX # b*b # 0X10(rsp)çš„åœ°å€ä¸ºå˜é‡b2 hello.go:10 0x45b521 4889542410 mov qword ptr [rsp+0x10], rdx mov DX, 0x10(rsp) # b2 = b*b # æŠŠa2å€¼æ”¾å…¥CXå¯„å­˜å™¨ hello.go:11 0x45b526 488b4c2418 mov rcx, qword ptr [rsp+0x18] mov 0x18(rsp), CX # è®¡ç®— a2 + b2 hello.go:11 0x45b52b 488d0411 lea rax, ptr [rcx+rdx*1] lea (CX+DX*1), AX # a2+b2 # a2 + b2 å€¼å­˜å…¥0x8(rsp)æ˜¯å˜é‡çš„å€¼ hello.go:11 0x45b52f 4889442408 mov qword ptr [rsp+0x8], rax mov AX, 0x8(rsp) # c = a2+b2 # a2 + b2 å€¼å­˜å…¥(rsp) è¯¥å€¼æ˜¯è¿”å›å€¼ç©ºé—´ hello.go:13 0x45b534 48890424 mov qword ptr [rsp], rax mov AX, (rsp) # return # å¼¹å‡ºmain.mainçš„rbp hello.go:13 0x45b538 488b6c2420 mov rbp, qword ptr [rsp+0x20] mov 0x20(rsp), rbp # ä½¿rspæŒ‡å‘main.mainçš„æ ˆrspä½ç½® .:0 0x45b53d 4883c428 add rsp, 0x28 add 0x28, rsp # å¼¹å‡ºmain.mainçš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ .:0 0x45b541 c3 ret ret æ ˆåˆ†å¸ƒæƒ…å†µï¼š // æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç åœ¨14è¡Œæ—¶ä¹Ÿå°±æ˜¯main.sumå‡½æ•°è¿”å›å‰çš„æ ˆå¸ƒå±€æƒ…å†µ // // æ ˆåº• // ---------------------------- é«˜åœ°å€ // | b // ---------------------------- // | a runtime.mainå‡½æ•°æ ˆå¸§ // ---------------------------- // | è¿”å›åˆ°runtime.mainçš„åœ°å€ +0x48 // -----------\u003e ---------------------------- \u003c------------------------------------- // | è°ƒç”¨å‡½æ•°runtime.mainçš„rbp +0x40 // ---------------------------- // | main.sumçš„ç¬¬äºŒä¸ªå‚æ•° 0x2 +0x38 // ---------------------------- main.mainå‡½æ•°æ ˆå¸§ // | main.sumçš„ç¬¬ä¸€ä¸ªå‚æ•° 0x1 +0x30 // ---------------------------- // | è¿”å›åˆ°main.mainçš„åœ°å€ +0x28 // -----------\u003e ---------------------------- \u003c------------------------------------- // | è°ƒç”¨å‡½æ•°main.mainçš„rbp +0x20 // ---------------------------- // | å˜é‡a2 0x1 +0x18 // ---------------------------- // | å˜é‡b2 0x4 +0x10 main.sumå‡½æ•°æ ˆå¸§ // ---------------------------- // | å˜é‡c 0x5 +0x8 // ---------------------------- // | main.sumçš„è¿”å›å€¼åœ°å€ 0x5 +0x0 // -----------\u003e ---------------------------- \u003c------------------------------------- ç¼–è¯‘æŒ‡ä»¤ ç¼–è¯‘æŒ‡ä»¤ï¼šgo build -gcflags=\"-N -l\" slice1.goã€‚ æŸ¥çœ‹å…·ä½“æ–¹æ³•çš„æ±‡ç¼–æŒ‡ä»¤ï¼šgo tool objdump -S -s â€˜^main.main$â€™ slice1ã€‚ ",
  "wordCount" : "2921",
  "inLanguage": "zh",
  "image": "https://heliu.site/favicon-32x32.png","datePublished": "2024-08-05T00:00:00Z",
  "dateModified": "2024-08-05T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "helium"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://heliu.site/posts/golang/func/align/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Helium",
    "logo": {
      "@type": "ImageObject",
      "url": "https://heliu.site/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://heliu.site/" accesskey="h" title="Blog (Alt + H)">
                <img src="https://heliu.site/helium.png" alt="" aria-label="logo"
                    height="35">Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://heliu.site/" title="ä¸»é¡µ">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/posts" title="æ–‡ç« ">
                    <span>Article</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/archives" title="æ—¶é—´è½´">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/tags/" title="æ ‡ç­¾">
                    <span>Tag</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/search/" title="æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/support" title="æ‰“èµ">
                    <span>ğŸ«¶Help</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">


<article class="post" autonumbering>
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://heliu.site/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://heliu.site/posts/">Article</a>&nbsp;Â»&nbsp;<a href="https://heliu.site/posts/golang/">Golang åˆé›†</a>&nbsp;Â»&nbsp;<a href="https://heliu.site/posts/golang/func/">ç¬¬9ç«  Function</a></div>
    <h1 class="post-title entry-hint-parent">
      å†…å­˜å¯¹é½å’Œé€ƒé€¸åˆ†æ
    </h1>
    <div class="post-description">
      ğŸ’¥æœ¬æ–‡ç« æ‰€æœ‰ç›¸å…³goä»£ç å‚è€ƒè‡ªgo 1.18&#43;ç‰ˆæœ¬
    </div>
    <div class="post-meta">










<span class="x-post-meta-item"><svg t="1720837714681" class="icon" viewBox="0 0 1084 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7520" width="200" height="200"><path d="M123.47509 1023.984942a123.565437 123.565437 0 0 1-123.505206-123.32451V243.863302A123.565437 123.565437 0 0 1 123.47509 120.568908h171.630374V26.06529a26.050232 26.050232 0 0 1 52.070349 0v94.503618h377.592848V26.06529a26.050232 26.050232 0 0 1 52.100464 0v94.503618h183.797189A123.565437 123.565437 0 0 1 1084.171519 243.863302v656.79713A123.565437 123.565437 0 0 1 960.666314 1023.984942H123.47509z m-71.404741-123.32451A71.434857 71.434857 0 0 0 123.47509 971.974825h837.191224a71.434857 71.434857 0 0 0 71.404741-71.314393V442.326922l-946.361273-3.824716a25.598494 25.598494 0 0 1-5.84248-0.692665l-27.796953-6.444798v469.295689zM123.47509 172.579025a71.434857 71.434857 0 0 0-71.404741 71.284277v149.736133l27.796953-6.444797a26.080348 26.080348 0 0 1 5.902712-0.662549l946.301041 3.824716V243.863302a71.404741 71.404741 0 0 0-71.404741-71.284277h-180.183284l-6.173754 12.859479a26.200812 26.200812 0 0 1-23.490383 14.786895 26.261043 26.261043 0 0 1-23.520499-14.786895l-6.173754-12.859479H350.819834l-6.173754 12.859479a26.200812 26.200812 0 0 1-23.490383 14.786895 26.230928 26.230928 0 0 1-23.520499-14.786895l-6.173755-12.859479H123.47509z m156.150814 578.827128a26.050232 26.050232 0 0 1-26.050232-25.990001c0-14.335157 11.68496-26.020116 26.050232-26.020116h521.697312c14.365273 0 26.050232 11.68496 26.050233 26.020116a26.050232 26.050232 0 0 1-26.050233 25.990001H279.625904z" fill="#3D3F42" p-id="7521"></path></svg><span>2024-08-05</span></span>&nbsp;<span class="x-post-meta-item"><svg t="1720839329181" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14106" width="200" height="200"><path d="M699.270662 190.485379c-0.411369 0-0.821715 0.011256-1.227967 0.032746H507.034407a23.041786 23.041786 0 0 0-1.221828-0.031723c-12.779048 0-23.140023 10.359952-23.140023 23.139 0 12.781094 10.360975 23.141046 23.140023 23.141046v0.032746h193.458083v-0.032746c12.780071 0 23.141046-10.359952 23.141047-23.141046 0-12.780071-10.360975-23.140023-23.141047-23.140023zM979.215516 724.005508c0-142.090159-115.186416-257.277598-257.277598-257.277598-72.245418 0-137.532353 29.777187-184.262654 77.725223l45.868677 31.474852c36.227086-33.873482 84.882226-54.617945 138.393977-54.617945 111.945605 0 202.696492 90.750887 202.696492 202.695468h-43.01263l70.331835 104.289228 70.331835-104.289228H979.215516z" fill="" p-id="14107"></path><path d="M748.885664 588.843132c0-14.881942-12.06785-26.945699-26.947746-26.945698-14.883989 0-26.947745 12.063757-26.947745 26.945698v135.164423c0 14.879895 12.063757 26.945699 26.947745 26.945699h107.786889c14.881942 0 26.945699-12.063757 26.945698-26.945699s-12.063757-26.945699-26.945698-26.945699h-80.839143V588.843132zM721.937918 926.702c-111.947651 0-202.696492-90.74884-202.696492-202.696492 0-0.144286 0.004093-0.285502 0.004094-0.429788h43.004443l-70.330812-104.289228-70.331835 104.289228h43.075051c0 0.144286-0.00307 0.285502-0.00307 0.429788 0 142.091182 115.187439 257.279644 257.278621 257.279645 72.241324 0 137.530306-29.77821 184.260607-77.727269l-45.86663-31.474852c-36.227086 33.873482-84.884272 54.618968-138.393977 54.618968zM694.633039 423.38066c-1.354857-11.487635-11.120268-20.400632-22.972201-20.400632H206.362486c-12.780071 0-23.140023 10.359952-23.140023 23.138999 0 12.781094 10.359952 23.141046 23.140023 23.141047H596.949252c30.209022-13.81668 63.104223-22.76754 97.683787-25.879414zM438.548616 623.143333H206.362486c-12.780071 0-23.140023 10.358929-23.140023 23.140023 0 12.780071 10.359952 23.140023 23.140023 23.140023h219.956598a298.463626 298.463626 0 0 1 12.229532-46.280046zM506.934123 513.062192H206.362486c-12.780071 0-23.140023 10.359952-23.140023 23.139 0 12.781094 10.359952 23.140023 23.140023 23.140023H469.936487a302.241672 302.241672 0 0 1 36.997636-46.279023z" fill="" p-id="14108"></path><path d="M442.765661 835.277778a298.531164 298.531164 0 0 1-14.365173-46.150087H146.542052v-0.065491c-33.036417 0-59.81941-26.78197-59.81941-59.819411V329.36031h704.907545v100.905154a298.561863 298.561863 0 0 1 46.150086 14.996552V194.619536h-0.162706c0-53.422723-43.307342-96.728018-96.730065-96.728018h-68.89409V84.418668c0-33.037441-26.782993-59.81941-59.81941-59.81941v-0.361227h-18.87079v0.032745c-33.038464 0-59.820434 26.78197-59.820433 59.819411 0 0.109494 0.008186 0.218988 0.008186 0.328481h-0.339738v13.47285H345.203648V84.418668c0-33.037441-26.782993-59.81941-59.819411-59.81941v-0.361227h-18.872836v0.032745c-33.036417 0-59.81941 26.78197-59.81941 59.819411 0 0.109494 0.007163 0.218988 0.008186 0.328481h-0.339737v13.47285h-69.189826c-53.4217 0-96.729042 43.306318-96.729041 96.728018 0 1.701758 0.045025 3.39226 0.132006 5.071505v533.785166a98.051153 98.051153 0 0 0-0.132006 5.071506c0 53.4217 43.307342 96.728018 96.729041 96.728018v0.001023h305.595047zM86.723665 204.056466c0-33.037441 26.782993-59.81941 59.819411-59.819411 0.044002 0 0.086981 0.00307 0.130983 0.00307v-0.068561h105.968473V94.874811h0.032746a22.807449 22.807449 0 0 1-0.032746-1.215688c0-12.779048 10.360975-23.140023 23.140023-23.140023s23.140023 10.360975 23.140023 23.140023c0 0.408299-0.010233 0.812505-0.031722 1.215688h0.031722v49.297776h280.508696V94.874811h0.032745a22.807449 22.807449 0 0 1-0.032745-1.215688c0-12.779048 10.361999-23.140023 23.140023-23.140023 12.780071 0 23.141046 10.360975 23.141046 23.140023 0 0.408299-0.011256 0.812505-0.032746 1.215688h0.032746v49.297776h106.10048v0.065492c33.035394 0 59.818387 26.780947 59.818387 59.81941h0.130983V283.080264H86.723665v-79.023798z" fill="" p-id="14109"></path></svg><span>2024-08-05</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path>
    <polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline>
    <line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line>
    <line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line>
    <polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline>
</svg><span>2921å­—</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <circle cx="12" cy="12" r="9"></circle>
    <polyline points="12 7 12 12 15 15"></polyline>
</svg><span>14åˆ†é’Ÿ</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <circle cx="12" cy="7" r="4"></circle>
    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
</svg><span>helium</span></span>
      <span class="x-post-meta-item">
        &nbsp;<svg t="1720840393161" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18680" width="200" height="200"><path d="M995.125144 559.61812l-415.998603-415.998602A52.986489 52.986489 0 0 0 541.413335 127.99957H338.847348c-3.166656-26.559911-9.286635-51.046495-17.999939-71.333094C299.734146 7.333309 271.154242 0 256.00096 0c-13.939953 0-40.439864 6.339979-61.259794 48.806503-10.473298 21.366595-17.946606 48.966502-21.573261 79.193067H53.334974a53.393154 53.393154 0 0 0-53.333154 53.333154v360.078791a52.986489 52.986489 0 0 0 15.619948 37.713206l415.998602 415.998603a53.333154 53.333154 0 0 0 75.426413 0l26.286579-26.293245 26.286578 26.293245a53.426487 53.426487 0 0 0 16.719944 11.333295 21.333262 21.333262 0 0 0 36.079879 11.293295l382.705381-382.705381a53.399821 53.399821 0 0 0 0-75.426413z m-762.070774-491.998347C241.494342 50.373164 250.667645 42.666523 256.00096 42.666523c5.99998 0 16.573278 9.639968 25.646581 30.806564 6.493312 15.159949 11.333295 33.999886 14.146619 54.526483H216.16776c3.206656-23.419921 9.013303-44.359851 16.88661-60.41313z m243.819181 897.330319a10.666631 10.666631 0 0 1-15.079949 0l-415.998603-415.998603A10.573298 10.573298 0 0 1 42.668343 541.411515V181.332724a10.666631 10.666631 0 0 1 10.666631-10.666631h245.332509c0 47.853173-10.373298 92.15969-27.066575 115.632945-5.926647 8.326639-16.566611 14.186619-22.306592 16.113279C204.041135 314.752276 170.667913 356.218803 170.667913 405.331972c0 58.813136 47.853173 106.666308 106.666309 106.666308s106.666308-47.853173 106.666308-106.666308c0-47.086508-30.666564-87.139707-73.079754-101.246327C330.060711 272.705751 341.334007 223.692582 341.334007 170.666093h72.079758a10.573298 10.573298 0 0 1 7.539974 3.126656l415.998603 415.998603a10.666631 10.666631 0 0 1 0 15.079949zM341.334007 405.331972a63.999785 63.999785 0 1 1-63.999785-63.999785 64.073118 64.073118 0 0 1 63.999785 63.999785z m263.539114 559.61812a10.666631 10.666631 0 0 1-15.079949 0L563.499927 938.663513l303.625647-303.61898a53.399821 53.399821 0 0 0 0-75.426413L478.16688 170.666093h63.246455a10.573298 10.573298 0 0 1 7.539974 3.126656l415.998603 415.998603c0.239999 0.239999 0.466665 0.486665 0.666664 0.746664l0.086667 0.106666a10.666631 10.666631 0 0 1 0 13.373289l-0.086667 0.106666c-0.213333 0.259999-0.439999 0.506665-0.666664 0.746664z" fill="#5C5C66" p-id="18681"></path></svg>
        <ul class="post-tags-meta" style="display: inline-block;font-size: 14px;">
            <a href="https://heliu.site/tags/golang/" target="_blank" rel="noopener">Golang</a>
            <a href="https://heliu.site/tags/%E5%87%BD%E6%95%B0/" target="_blank" rel="noopener">å‡½æ•°</a>
        </ul>
      </span>
      
      <span id="busuanzi_container_page_pv" class="x-post-meta-item">
        &nbsp;<svg t="1720844685710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27237" width="200" height="200"><path d="M739.754667 574.08c-121.386667 45.610667-208.469333 169.813333-208.64 316.16 0 33.408 4.693333 65.493333 13.141333 95.914667H94.122667c-26.453333-43.52-41.685333-91.946667-41.685334-143.189334 0-185.173333 192.896-335.104 430.805334-335.104 96.256 0 184.832 24.746667 256.512 66.218667z m-280.490667-114.986667a214.869333 214.869333 0 0 1-214.869333-215.04A215.04 215.04 0 0 1 459.264 28.842667a215.04 215.04 0 0 1 215.04 215.210666 215.04 215.04 0 0 1-215.04 215.04zM974.506667 641.28c9.856 0 17.834667 7.466667 17.834666 16.64v59.989333c-0.341333 8.789333-7.850667 15.786667-17.28 16.085334-9.856 0.341333-18.176-6.826667-18.517333-16.085334v-20.053333l-99.114667 91.093333-0.256 0.256a18.474667 18.474667 0 0 1-14.848 4.352h-0.768a18.176 18.176 0 0 1-9.344-4.608l-0.938666-0.981333-85.930667-80.042667-123.562667 115.072a18.773333 18.773333 0 0 1-25.216 0 15.786667 15.786667 0 0 1 0-23.466666l136.149334-126.848 0.725333-0.597334a18.645333 18.645333 0 0 1 24.362667 0.512l87.253333 81.237334 86.058667-79.232h-21.248c-9.386667-0.298667-16.938667-7.338667-17.28-16.085334-0.341333-9.173333 7.381333-16.896 17.28-17.237333h64.64z m-367.146667 240h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v72.192a16.042667 16.042667 0 0 1-16.042667 16.042666h-48.128a16.042667 16.042667 0 0 1-16.042667-16.042666v-72.192c0-8.874667 7.210667-16.042667 16.042667-16.042667z m110.805333-106.666667h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v178.858667a16.042667 16.042667 0 0 1-16.042667 16.042666h-48.128a16.042667 16.042667 0 0 1-16.042666-16.042666v-178.858667c0-8.874667 7.168-16.042667 16.042666-16.042667z m106.538667 80h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v99.413333a16.042667 16.042667 0 0 1-16.042667 16.042667H824.746667a16.042667 16.042667 0 0 1-16.042667-16.042667v-99.413333c0-8.874667 7.168-16.042667 16.042667-16.042667z m110.165333-80h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v179.413333a16.042667 16.042667 0 0 1-16.042667 16.042667h-48.128a16.042667 16.042667 0 0 1-16.042666-16.042667v-179.413333c0-8.874667 7.210667-16.042667 16.042666-16.042667z" fill="#999999" p-id="27238"></path></svg>
        <span id="busuanzi_value_page_pv"></span>
      </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">ç›®å½•</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e5%86%85%e5%ad%98%e5%af%b9%e9%bd%90" aria-label="å†…å­˜å¯¹é½">å†…å­˜å¯¹é½</a></li>
                    <li>
                        <a href="#%e9%80%83%e9%80%b8%e5%88%86%e6%9e%90" aria-label="é€ƒé€¸åˆ†æ">é€ƒé€¸åˆ†æ</a><ul>
                            
                    <li>
                        <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e9%80%83%e9%80%b8%e5%88%86%e6%9e%90" aria-label="ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ">ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ</a><ul>
                            
                    <li>
                        <a href="#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f%e5%9c%b0%e5%9d%80%e4%bd%9c%e4%b8%ba%e8%bf%94%e5%9b%9e%e5%80%bc1" aria-label="å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(1)">å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(1)</a></li>
                    <li>
                        <a href="#%e5%b1%80%e9%83%a8%e5%8f%98%e9%87%8f%e5%9c%b0%e5%9d%80%e4%bd%9c%e4%b8%ba%e8%bf%94%e5%9b%9e%e5%80%bc2" aria-label="å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(2)">å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(2)</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%b8%8d%e9%80%83%e9%80%b8%e5%88%86%e6%9e%90" aria-label="ä¸é€ƒé€¸åˆ†æ">ä¸é€ƒé€¸åˆ†æ</a></li>
                    <li>
                        <a href="#%e4%b8%8d%e9%80%83%e9%80%b8%e5%88%a4%e6%96%ad" aria-label="ä¸é€ƒé€¸åˆ¤æ–­">ä¸é€ƒé€¸åˆ¤æ–­</a><ul>
                            
                    <li>
                        <a href="#%e5%8c%85%e7%ba%a7%e5%88%ab%e6%8c%87%e9%92%881" aria-label="åŒ…çº§åˆ«æŒ‡é’ˆ(1)">åŒ…çº§åˆ«æŒ‡é’ˆ(1)</a></li>
                    <li>
                        <a href="#%e5%8c%85%e7%ba%a7%e5%88%ab%e6%8c%87%e9%92%882" aria-label="åŒ…çº§åˆ«æŒ‡é’ˆ(2)">åŒ…çº§åˆ«æŒ‡é’ˆ(2)</a></li>
                    <li>
                        <a href="#%e5%9c%a8%e5%87%bd%e6%95%b0%e9%97%b4%e4%bc%a0%e9%80%92" aria-label="åœ¨å‡½æ•°é—´ä¼ é€’">åœ¨å‡½æ•°é—´ä¼ é€’</a></li>
                    <li>
                        <a href="#linkname-%e6%9c%ba%e5%88%b6" aria-label="linkname æœºåˆ¶">linkname æœºåˆ¶</a></li></ul>
                    </li></ul>
                    </li>
                    <li>
                        <a href="#%e5%87%bd%e6%95%b0%e7%a4%ba%e4%be%8b" aria-label="å‡½æ•°ç¤ºä¾‹">å‡½æ•°ç¤ºä¾‹</a><ul>
                            
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b%e4%b8%80" aria-label="ç¤ºä¾‹ä¸€">ç¤ºä¾‹ä¸€</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e7%bc%96%e8%af%91%e6%8c%87%e4%bb%a4" aria-label="ç¼–è¯‘æŒ‡ä»¤">ç¼–è¯‘æŒ‡ä»¤</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h2 id="å†…å­˜å¯¹é½">å†…å­˜å¯¹é½<a hidden class="anchor" aria-hidden="true" href="#å†…å­˜å¯¹é½">#</a></h2>
<ol>
<li>åœ¨<code>C</code>è¯­è¨€å‡½æ•°è°ƒç”¨ä¸­ï¼Œé€šè¿‡æ ˆä¼ é€’çš„å‚æ•°éœ€è¦<strong>å¯¹é½</strong>åˆ°å¹³å°çš„ä½å®½ã€‚</li>
<li>å‡å¦‚é€šè¿‡æ ˆä¼ é€’4ä¸ª<code>char</code>ç±»å‹çš„å‚æ•°ï¼Œ<code>GCC</code>ç”Ÿæˆçš„ 32 ä½ç¨‹åºéœ€è¦ 16 å­—èŠ‚ç©ºé—´ï¼Œ64 ä½ç¨‹åºéœ€è¦ 32 å­—èŠ‚æ ˆç©ºé—´ã€‚</li>
<li>å¦‚æœä¼ é€’å¤§é‡å‚æ•°ï¼Œåˆ™è¿™ç§å¯¹é½æ–¹å¼ä¼šå­˜åœ¨å¾ˆå¤§çš„æ ˆç©ºé—´æµªè´¹ã€‚</li>
<li><code>Go</code>è¯­è¨€å‡½æ•°æ ˆå¸§ä¸­è¿”å›å€¼å’Œå‚æ•°çš„å¯¹é½æ–¹å¼ä¸ <code>struct</code> ç±»ä¼¼ï¼Œå¯¹äºæœ‰è¿”å›å€¼å’Œå‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥æŠŠæ‰€æœ‰è¿”å›å€¼å’Œæ‰€æœ‰å‚æ•°ç­‰ä»·æˆä¸¤ä¸ª <code>struct</code>ï¼š
<ul>
<li>ä¸€ä¸ªã€è¿”å›å€¼ <code>struct</code>ã€‘ å’Œä¸€ä¸ªã€å‚æ•° <code>struct</code>ã€‘ã€‚</li>
</ul>
</li>
<li>å› ä¸º<strong>å†…å­˜å¯¹é½</strong>æ–¹å¼æ›´åŠ ç´§å‡‘ï¼Œæ‰€ä»¥åœ¨æ”¯æŒå¤§é‡å‚æ•°å’Œè¿”å›å€¼æ—¶èƒ½å¤Ÿåšåˆ°è¾ƒé«˜çš„æ ˆç©ºé—´åˆ©ç”¨ç‡ã€‚</li>
<li>é€šè¿‡å¦‚ä¸‹ç¤ºä¾‹å¯ä»¥éªŒè¯å‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„å¯¹é½æ–¹å¼ä¸ <code>struct</code> æˆå‘˜çš„å¯¹é½æ–¹å¼æ˜¯ä¸€è‡´çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š
<ul>
<li>ä»¥ä¸Šçš„æè¿°éƒ½æ˜¯åœ¨å‡½æ•°é€šè¿‡<strong>æ ˆ</strong>ä¼ é€’å‚æ•°å’Œè¿”å›å€¼çš„åŸºç¡€ä¸Šçš„ã€‚åœ¨go1.18åç‰ˆæœ¬ä¸­é‡‡ç”¨äº†å¯„å­˜å™¨ä¼ å‚ã€‚</li>
</ul>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">args</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">a</span> <span class="kt">int8</span>    <span class="c1">// 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">b</span> <span class="kt">int64</span> <span class="c1">// 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">c</span> <span class="kt">int32</span> <span class="c1">// 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">d</span> <span class="kt">int16</span> <span class="c1">// 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">f1</span><span class="p">(</span><span class="nx">a</span> <span class="nx">args</span><span class="p">)</span> <span class="p">(</span><span class="nx">r</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">d</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">f2</span><span class="p">(</span><span class="nx">aa</span> <span class="kt">int8</span><span class="p">,</span> <span class="nx">ab</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">ac</span> <span class="kt">int32</span><span class="p">,</span> <span class="nx">ad</span> <span class="kt">int16</span><span class="p">)</span> <span class="p">(</span><span class="nx">ra</span> <span class="kt">int8</span><span class="p">,</span> <span class="nx">rb</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">rc</span> <span class="kt">int32</span><span class="p">,</span> <span class="nx">rd</span> <span class="kt">int16</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">println</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">rd</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">rc</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">rb</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ra</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ad</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ac</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">ab</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">aa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">f1</span><span class="p">(</span><span class="nx">args</span><span class="p">{})</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 0xc000034744     r.d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034740     r.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034738     r.b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034730     r.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc00003476c     a.d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034768     a.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034760     a.b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034758     a.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="nf">f2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 0xc00003473a     rd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc00003473c     rc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034740     rb
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034739     ra
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc00003476c     ad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034768     ac
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034760     ab
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 0xc000034758     aa
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

<p><details >
  <summary markdown="span">æ±‡ç¼–ä»£ç </summary>
  <blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.main</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">main</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4551e0</span>        <span class="mi">493</span><span class="no">b6610</span>            <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551e4</span>        <span class="mi">7657</span>                <span class="no">JBE</span> <span class="mi">0x45523d</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551e6</span>        <span class="mi">4883</span><span class="no">ec38</span>            <span class="no">SUBQ</span> <span class="no">$0x38</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551ea</span>        <span class="mi">48896</span><span class="no">c2430</span>          <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551ef</span>        <span class="mi">488</span><span class="no">d6c2430</span>          <span class="no">LEAQ</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">    <span class="no">f1</span><span class="p">(</span><span class="no">args</span><span class="err">{}</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4551f4</span>        <span class="no">c644241800</span>          <span class="no">MOVB</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x4551f9</span>        <span class="mi">48</span><span class="no">c744242000000000</span>  <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455202</span>        <span class="no">c744242800000000</span>    <span class="no">MOVL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x28</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45520a</span>        <span class="mi">66</span><span class="no">c744242c0000</span>      <span class="no">MOVW</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x2c</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455211</span>        <span class="mi">0</span><span class="no">fb6442418</span>          <span class="no">MOVZX</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>     <span class="c1"># a.a AX    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455216</span>        <span class="mi">488</span><span class="no">b5c2420</span>          <span class="no">MOVQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BX</span>      <span class="c1"># a.b BX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45521b</span>        <span class="mi">8</span><span class="no">b4c2428</span>            <span class="no">MOVL</span> <span class="mi">0x28</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">CX</span>      <span class="c1"># a.c CX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45521f</span>        <span class="mi">31</span><span class="no">ff</span>                <span class="no">XORL</span> <span class="no">DI</span><span class="p">,</span> <span class="no">DI</span>            <span class="c1"># a.d DI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455221</span>        <span class="no">e83a000000</span>          <span class="no">CALL</span> <span class="no">main.f1</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">    <span class="no">f2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455226</span>        <span class="mi">31</span><span class="no">c0</span>                <span class="no">XORL</span> <span class="no">AX</span><span class="p">,</span> <span class="no">AX</span>        <span class="c1"># aa    AX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455228</span>        <span class="mi">31</span><span class="no">db</span>                <span class="no">XORL</span> <span class="no">BX</span><span class="p">,</span> <span class="no">BX</span>        <span class="c1"># ab    BX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45522a</span>        <span class="mi">31</span><span class="no">c9</span>                <span class="no">XORL</span> <span class="no">CX</span><span class="p">,</span> <span class="no">CX</span>        <span class="c1"># ac    CX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45522c</span>        <span class="mi">31</span><span class="no">ff</span>                <span class="no">XORL</span> <span class="no">DI</span><span class="p">,</span> <span class="no">DI</span>        <span class="c1"># ad    DI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45522e</span>        <span class="no">e8ad010000</span>          <span class="no">CALL</span> <span class="no">main.f2</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455233</span>        <span class="mi">488</span><span class="no">b6c2430</span>          <span class="no">MOVQ</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455238</span>        <span class="mi">4883</span><span class="no">c438</span>            <span class="no">ADDQ</span> <span class="no">$0x38</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45523c</span>        <span class="no">c3</span>                  <span class="no">RET</span>            
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">main</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45523d</span>        <span class="mi">0</span><span class="no">f1f00</span>              <span class="no">NOPL</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl"><span class="mi">0x455240</span>          <span class="no">e81bcdffff</span>          <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455245</span>        <span class="no">eb99</span>                <span class="no">JMP</span> <span class="no">main.main</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.f1</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">f1</span><span class="p">(</span><span class="no">a</span> <span class="no">args</span><span class="p">)</span> <span class="p">(</span><span class="no">r</span> <span class="no">args</span><span class="p">)</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4551e0</span>        <span class="mi">493</span><span class="no">b6610</span>            <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551e4</span>        <span class="mi">0</span><span class="no">f8642010000</span>        <span class="no">JBE</span> <span class="mi">0x45532c</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551ea</span>        <span class="mi">4883</span><span class="no">ec68</span>            <span class="no">SUBQ</span> <span class="no">$0x68</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551ee</span>        <span class="mi">48896</span><span class="no">c2460</span>          <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x60</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4551f3</span>        <span class="mi">488</span><span class="no">d6c2460</span>          <span class="no">LEAQ</span> <span class="mi">0x60</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="c1"># å‚æ•°åˆ†é…æ ˆå¤§å°ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x4551f8</span>        <span class="mi">88442470</span>            <span class="no">MOVB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0x70</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x4551fc</span>        <span class="mi">48895</span><span class="no">c2478</span>          <span class="no">MOVQ</span> <span class="no">BX</span><span class="p">,</span> <span class="mi">0x78</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455201</span>        <span class="mi">898</span><span class="no">c2480000000</span>      <span class="no">MOVL</span> <span class="no">CX</span><span class="p">,</span> <span class="mi">0x80</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455208</span>        <span class="mi">6689</span><span class="no">bc2484000000</span>    <span class="no">MOVW</span> <span class="no">DI</span><span class="p">,</span> <span class="mi">0x84</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a.d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># è¿”å›å€¼åˆ†é…æ ˆå¤§å°ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455210</span>        <span class="no">c644240800</span>          <span class="no">MOVB</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>   <span class="c1"># r.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455215</span>        <span class="mi">48</span><span class="no">c744241000000000</span>  <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>  <span class="c1"># r.b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45521e</span>        <span class="no">c744241800000000</span>    <span class="no">MOVL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>  <span class="c1"># r.c
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455226</span>        <span class="mi">66</span><span class="no">c744241c0000</span>      <span class="no">MOVW</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x1c</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>  <span class="c1"># r.d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">println</span><span class="p">(</span><span class="err">&amp;</span><span class="no">r.d</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">r.c</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">r.b</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">r.a</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">a.d</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">a.c</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">a.b</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">a.a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="na">...</span> <span class="no">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.f2</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">f2</span><span class="p">(</span><span class="no">aa</span> <span class="no">int8</span><span class="p">,</span> <span class="no">ab</span> <span class="no">int64</span><span class="p">,</span> <span class="no">ac</span> <span class="no">int32</span><span class="p">,</span> <span class="no">ad</span> <span class="no">int16</span><span class="p">)</span> <span class="p">(</span><span class="no">ra</span> <span class="no">int8</span><span class="p">,</span> <span class="no">rb</span> <span class="no">int64</span><span class="p">,</span> <span class="no">rc</span> <span class="no">int32</span><span class="p">,</span> <span class="no">rd</span> <span class="no">int16</span><span class="p">)</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455360</span>        <span class="mi">493</span><span class="no">b6610</span>            <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455364</span>        <span class="mi">0</span><span class="no">f8631010000</span>        <span class="no">JBE</span> <span class="mi">0x45549b</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45536a</span>        <span class="mi">4883</span><span class="no">ec60</span>            <span class="no">SUBQ</span> <span class="no">$0x60</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45536e</span>        <span class="mi">48896</span><span class="no">c2458</span>          <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x58</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455373</span>        <span class="mi">488</span><span class="no">d6c2458</span>          <span class="no">LEAQ</span> <span class="mi">0x58</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="c1"># å‚æ•°ä¼ å‚ï¼Œä½¿ç”¨å¯„å­˜å™¨ï¼Œä½†æ˜¯å‚æ•°ç©ºé—´è¿˜æ˜¯æ²¡æœ‰ä¼˜åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455378</span>        <span class="mi">88442468</span>            <span class="no">MOVB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0x68</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># aa
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45537c</span>        <span class="mi">48895</span><span class="no">c2470</span>          <span class="no">MOVQ</span> <span class="no">BX</span><span class="p">,</span> <span class="mi">0x70</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># ab
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455381</span>        <span class="mi">894</span><span class="no">c2478</span>            <span class="no">MOVL</span> <span class="no">CX</span><span class="p">,</span> <span class="mi">0x78</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># ac
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455385</span>        <span class="mi">66897</span><span class="no">c247c</span>          <span class="no">MOVW</span> <span class="no">DI</span><span class="p">,</span> <span class="mi">0x7c</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># ad
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># è¿”å›å€¼åˆ†é…æ ˆå¤§å°ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45538a</span>        <span class="no">c644240900</span>          <span class="no">MOVB</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x9</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>   <span class="c1"># ra
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45538f</span>        <span class="mi">48</span><span class="no">c744241000000000</span>  <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>  <span class="c1"># rb
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455398</span>        <span class="no">c744240c00000000</span>    <span class="no">MOVL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0xc</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>   <span class="c1"># rc
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x4553a0</span>        <span class="mi">66</span><span class="no">c744240a0000</span>      <span class="no">MOVW</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0xa</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>   <span class="c1"># rd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">println</span><span class="p">(</span><span class="err">&amp;</span><span class="no">rd</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">rc</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">rb</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">ra</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">ad</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">ac</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">ab</span><span class="p">,</span> <span class="err">&amp;</span><span class="no">aa</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="na">...</span> <span class="no">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>

</details></p>

<h2 id="é€ƒé€¸åˆ†æ">é€ƒé€¸åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#é€ƒé€¸åˆ†æ">#</a></h2>
<h3 id="ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ">ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ä»€ä¹ˆæ˜¯é€ƒé€¸åˆ†æ">#</a></h3>
<h4 id="å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼1">å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(1)<a hidden class="anchor" aria-hidden="true" href="#å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼1">#</a></h4>
<ol>
<li>åœ¨è§£é‡Šé€ƒé€¸åˆ†æä¹‹å‰ï¼Œå…ˆæ¥æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•°æŠŠè‡ªå·²æ ˆå¸§ä¸ŠæŸä¸ªå±€éƒ¨å˜é‡çš„åœ°å€ä½œä¸ºè¿”å›å€¼è¿”å›ã€‚</li>
<li>ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">println</span><span class="p">(</span><span class="o">*</span><span class="nf">newInt</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">newInt</span><span class="p">()</span> <span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å‰é¢å¯¹å‡½æ•°æ ˆå¸ƒå±€çš„è®²è§£ <code>newInt()</code> å‡½æ•°çš„å±€éƒ¨å˜é‡aåº”è¯¥åˆ†é…åœ¨å‡½æ•°æ ˆçš„ locals åŒºé—´ã€‚</li>
<li>åœ¨<code>newInt()</code>å‡½æ•°è¿”å›åï¼Œå®ƒçš„æ ˆéšå³é”€æ¯ï¼Œè¿”å›çš„å˜é‡açš„åœ°å€å°±ä¼šå˜æˆä¸€ä¸ª<strong>æ‚¬æŒ‚æŒ‡é’ˆ</strong>ï¼Œcaller ä¸­å¯¹è¯¥åœ°å€è¿›è¡Œçš„æ‰€æœ‰è¯»å†™éƒ½æ˜¯ä¸åˆæ³•çš„ï¼Œä¼šé€ æˆç¨‹åºé€»è¾‘é”™è¯¯ç”šè‡³å´©æºƒã€‚</li>
<li>äº‹å®æ˜¯è¿™æ ·çš„å—ï¼Ÿä¸Šè¿°åˆ†ææœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå³å˜é‡ a è¢«åˆ†é…åœ¨æ ˆä¸Šã€‚å‡å¦‚ç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æµ‹åˆ°è¿™ç§æ¨¡å¼ï¼Œè€Œè‡ªåŠ¨æŠŠå˜é‡ a æ”¹ä¸ºå †åˆ†é…ï¼Œå°±ä¸å­˜åœ¨ä¸Šè¿°é—®é¢˜äº†ã€‚</li>
<li>åç¼–è¯‘ <code>newInt()</code> å‡½æ•°ï¼Œçœ‹ä¸€ä¸‹ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š
<ol>
<li>é‡ç‚¹å…³æ³¨ä¸Šè¿°æ±‡ç¼–ä»£ç ä¸­ <code>runtime.newobject()</code> å‡½æ•°è°ƒç”¨ï¼Œè¯¥å‡½æ•°æ˜¯ <code>Go</code> è¯­è¨€å†…ç½®å‡½æ•° <code>new()</code> çš„å…·ä½“å®ç°ï¼Œç”¨æ¥åœ¨è¿è¡Œé˜¶æ®µåˆ†é…å•ä¸ªå¯¹è±¡ã€‚</li>
<li><code>CALL</code> æŒ‡ä»¤ <code>AX</code> å¯„å­˜å™¨å°±æ˜¯ <code>*int</code> ç±»å‹ï¼Œä¹Ÿæ˜¯è¿”å›çš„å€¼ã€‚</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.newInt</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">newInt</span><span class="p">()</span> <span class="p">*</span><span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455240</span>        <span class="mi">493</span><span class="no">b6610</span>            <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>     <span class="c1"># æ ˆå¢é•¿åˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455244</span>        <span class="mi">7643</span>                <span class="no">JBE</span> <span class="mi">0x455289</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455246</span>        <span class="mi">4883</span><span class="no">ec28</span>            <span class="no">SUBQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524a</span>        <span class="mi">48896</span><span class="no">c2420</span>          <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524f</span>        <span class="mi">488</span><span class="no">d6c2420</span>          <span class="no">LEAQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455254</span>        <span class="mi">48</span><span class="no">c744241000000000</span>  <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># *int ä¸´æ—¶è¿”å›å€¼ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">var</span> <span class="no">a</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45525d</span>        <span class="mi">488</span><span class="no">d05bc4a0000</span>      <span class="no">LEAQ</span> <span class="mi">0x4abc</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>    <span class="c1"># type.int å…ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># func newobject(typ *_type) unsafe.Pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># è¿™é‡Œè°ƒç”¨ newobject å‡½æ•°è¿›è¡Œäº†å †åˆ†é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455264</span>        <span class="no">e8d75cfbff</span>          <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>  <span class="c1"># AX=*int ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455269</span>        <span class="mi">4889442418</span>          <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526e</span>        <span class="mi">48</span><span class="no">c70000000000</span>      <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>     <span class="c1"># *a=0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">return</span> <span class="err">&amp;</span><span class="no">a</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455275</span>        <span class="mi">488</span><span class="no">b442418</span>          <span class="no">MOVQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527a</span>        <span class="mi">4889442410</span>          <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># è¿”å›å€¼ AX
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45527f</span>        <span class="mi">488</span><span class="no">b6c2420</span>          <span class="no">MOVQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455284</span>        <span class="mi">4883</span><span class="no">c428</span>            <span class="no">ADDQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455288</span>        <span class="no">c3</span>                  <span class="no">RET</span>            
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">newInt</span><span class="p">()</span> <span class="p">*</span><span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455289</span>        <span class="no">e8d2ccffff</span>          <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45528e</span>        <span class="no">ebb0</span>                <span class="no">JMP</span> <span class="no">main.newInt</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼2">å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼(2)<a hidden class="anchor" aria-hidden="true" href="#å±€éƒ¨å˜é‡åœ°å€ä½œä¸ºè¿”å›å€¼2">#</a></h4>
<ol>
<li>å¦‚æœæŠŠ <code>newInt()</code> å‡½æ•°ä¸­çš„å–åœ°å€è¿ç®—æ”¹æˆä½¿ç”¨å†…ç½®å‡½æ•° <code>new()</code>ï¼Œæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">newInt</span><span class="p">()</span> <span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ç›¸å…³æ±‡ç¼–ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">go</span> <span class="no">build</span> <span class="p">-</span><span class="no">gcflags</span><span class="err">=&#34;</span><span class="p">-</span><span class="no">N</span> <span class="p">-</span><span class="no">l</span><span class="err">&#34;</span> <span class="p">-</span><span class="no">o</span> <span class="p">.</span><span class="err">/</span><span class="no">h1</span> <span class="no">myzx.cn</span><span class="err">/</span><span class="no">helium</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">go</span> <span class="no">tool</span> <span class="no">objdump</span> <span class="p">-</span><span class="no">S</span> <span class="p">-</span><span class="no">s</span> <span class="err">&#39;^</span><span class="no">main.newInt$</span><span class="err">&#39;</span> <span class="p">.</span><span class="err">/</span><span class="no">h1</span> 
</span></span><span class="line"><span class="cl"><span class="no">TEXT</span> <span class="no">main.newInt</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">newInt</span><span class="p">()</span> <span class="p">*</span><span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455240</span>        <span class="mi">493</span><span class="no">b6610</span>              <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455244</span>        <span class="mi">7637</span>                  <span class="no">JBE</span> <span class="mi">0x45527d</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455246</span>        <span class="mi">4883</span><span class="no">ec28</span>              <span class="no">SUBQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524a</span>        <span class="mi">48896</span><span class="no">c2420</span>            <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524f</span>        <span class="mi">488</span><span class="no">d6c2420</span>            <span class="no">LEAQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455254</span>        <span class="mi">48</span><span class="no">c744241000000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># *int è¿”å›å€¼ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">return</span> <span class="no">new</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># func newobject(typ *_type) unsafe.Pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45525d</span>        <span class="mi">488</span><span class="no">d05bc4a0000</span>        <span class="no">LEAQ</span> <span class="mi">0x4abc</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>    <span class="c1"># type.int å…ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455264</span>        <span class="no">e8d75cfbff</span>            <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    <span class="c1"># AX=*int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455269</span>        <span class="mi">4889442418</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526e</span>        <span class="mi">4889442410</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455273</span>        <span class="mi">488</span><span class="no">b6c2420</span>            <span class="no">MOVQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455278</span>        <span class="mi">4883</span><span class="no">c428</span>              <span class="no">ADDQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527c</span>        <span class="no">c3</span>                    <span class="no">RET</span>                
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">newInt</span><span class="p">()</span> <span class="p">*</span><span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45527d</span>        <span class="mi">0</span><span class="no">f1f00</span>                <span class="no">NOPL</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455280</span>        <span class="no">e8dbccffff</span>            <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455285</span>        <span class="no">ebb9</span>                  <span class="no">JMP</span> <span class="no">main.newInt</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å½“å‡½æ•°å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡å‡½æ•°æ ˆçš„ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œç¼–è¯‘å™¨æŠŠè¯¥å±€éƒ¨å˜é‡ç”±<strong>æ ˆ</strong>åˆ†é…æ”¹ä¸º<strong>å †</strong>åˆ†é…ï¼Œå³å˜é‡ä»æ ˆä¸Šé€ƒé€¸åˆ°å †ä¸Šã€‚</li>
</ol>
<h3 id="ä¸é€ƒé€¸åˆ†æ">ä¸é€ƒé€¸åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#ä¸é€ƒé€¸åˆ†æ">#</a></h3>
<p>åªè¦ä½¿ç”¨äº†new()å‡½æ•°å°±ä¼šé€ æˆå †åˆ†é…?</p>
<ol>
<li>å‰é¢é€ƒé€¸åˆ†æä»£ç ç¤ºä¾‹ä¸­å°†å‡½æ•°çš„æŸä¸ªå±€éƒ¨å˜é‡çš„åœ°å€ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œæˆ–è€…é€šè¿‡å†…ç½®å‡½æ•° <code>new()</code> åŠ¨æ€åˆ†é…å˜é‡å¹¶è¿”å›å…¶åœ°å€ã€‚</li>
<li>å…¶ä¸­å†…ç½®å‡½æ•°<code>new()</code>æœ‰ç€éå¸¸æ˜æ˜¾çš„å †åˆ†é…çš„å«ä¹‰ï¼Œ<strong>æ˜¯ä¸æ˜¯</strong>åªè¦ä½¿ç”¨äº†<code>new()</code>å‡½æ•°å°±ä¼šé€ æˆå †åˆ†é…å‘¢ï¼Ÿ</li>
<li>è¿›ä¸€æ­¥çŒœæƒ³ï¼Œå¦‚æœå¯¹å±€éƒ¨å˜é‡è¿›è¡Œå–åœ°å€æ“ä½œä¼šè¢«è½¬æ¢ä¸º<code>new()</code>å‡½æ•°è°ƒç”¨ï¼Œé‚£å°±ä¸ä¼šè¿›è¡Œæ‰€è°“çš„é€ƒé€¸åˆ†æäº†ã€‚</li>
<li>å…ˆéªŒè¯<code>new()</code>å‡½æ•°ä¸å †åˆ†é…æ˜¯å¦æœ‰å¿…ç„¶å…³ç³»ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">New</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>åç¼–è¯‘<code>new()</code>å‡½æ•°ï¼Œå¾—åˆ°çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š
<ol>
<li>å³ä¾¿ä»£ç ä¸­ä½¿ç”¨äº†<code>new()</code>å‡½æ•°ï¼Œåªè¦<strong>å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ²¡æœ‰è¶…è¿‡è¿‡å½“å‰å‡½æ•°æ ˆçš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œç¼–è¯‘å™¨å°±<strong>ä¸ä¼šè¿›è¡Œå †åˆ†é…</strong>ã€‚</li>
<li>äº‹å®ä¸Šï¼Œåªè¦ä»£ç é€»è¾‘å…è®¸ï¼Œ<strong>ç¼–è¯‘å™¨æ€»æ˜¯å€¾å‘äºæŠŠå˜é‡åˆ†é…åœ¨æ ˆä¸Š</strong>ï¼Œå› ä¸ºæ¯”é…åœ¨å †ä¸Šæ›´é«˜æ•ˆã€‚</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.New</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">New</span><span class="p">()</span> <span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455240</span>        <span class="mi">4883</span><span class="no">ec20</span>            <span class="no">SUBQ</span> <span class="no">$0x20</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455244</span>        <span class="mi">48896</span><span class="no">c2418</span>          <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455249</span>        <span class="mi">488</span><span class="no">d6c2418</span>          <span class="no">LEAQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524e</span>        <span class="mi">48</span><span class="no">c7042400000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>   <span class="c1"># è¿”å›åœ°å€ int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">p</span> <span class="p">:</span><span class="err">=</span> <span class="no">new</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># new å‡½æ•°ç›´æ¥æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455256</span>        <span class="mi">48</span><span class="no">c744240800000000</span>  <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span> <span class="c1"># 0x8(SP) ç”¨ä½œintç±»å‹å­˜å‚¨ 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45525f</span>        <span class="mi">488</span><span class="no">d4c2408</span>          <span class="no">LEAQ</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">CX</span>   <span class="c1"># CX=0x8(SP); ä¹Ÿå°±æ˜¯ *int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455264</span>        <span class="mi">48894</span><span class="no">c2410</span>          <span class="no">MOVQ</span> <span class="no">CX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>  <span class="c1"># 0x10(SP); *int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">return</span> <span class="p">*</span><span class="no">p</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455269</span>        <span class="mi">8401</span>                <span class="no">TESTB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">CX</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526b</span>        <span class="mi">488</span><span class="no">b442408</span>          <span class="no">MOVQ</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455270</span>        <span class="mi">48890424</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455274</span>        <span class="mi">488</span><span class="no">b6c2418</span>          <span class="no">MOVQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455279</span>        <span class="mi">4883</span><span class="no">c420</span>            <span class="no">ADDQ</span> <span class="no">$0x20</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527d</span>        <span class="no">c3</span>                  <span class="no">RET</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>è¿™ä¹Ÿå°±æ˜¯æœ¬èŠ‚æ‰€è°“çš„ä¸é€ƒé€¸åˆ†æï¼Œæˆ–è€…è¯´æœªé€ƒé€¸åˆ†æï¼Œè¿™ç§è¯´æ³•å¹¶ä¸ä¸¥è°¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†çªå‡º<strong>ç¼–è¯‘å™¨å€¾å‘äºè®©å˜é‡ä¸é€ƒé€¸</strong>ã€‚</li>
</ol>
<h3 id="ä¸é€ƒé€¸åˆ¤æ–­">ä¸é€ƒé€¸åˆ¤æ–­<a hidden class="anchor" aria-hidden="true" href="#ä¸é€ƒé€¸åˆ¤æ–­">#</a></h3>
<h4 id="åŒ…çº§åˆ«æŒ‡é’ˆ1">åŒ…çº§åˆ«æŒ‡é’ˆ(1)<a hidden class="anchor" aria-hidden="true" href="#åŒ…çº§åˆ«æŒ‡é’ˆ1">#</a></h4>
<ol>
<li>æœ¬èŠ‚ä¸»è¦æ¢ç´¢ç¼–è¯‘å™¨è¿›è¡Œé€ƒé€¸åˆ†ææ—¶<strong>è¿½è¸ªçš„èŒƒå›´</strong>ï¼Œä»¥åŠåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å°±è®¤ä¸ºå˜é‡é€ƒé€¸äº†æˆ–è€…ç¡®å®šå˜é‡æ²¡æœ‰é€ƒé€¸ã€‚</li>
<li>å‰é¢ç ”ç©¶å˜é‡é€ƒé€¸æ‰€æœ‰çš„æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡è®©å‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œä½¿å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸè¶…è¿‡å¯¹åº”å‡½æ•°æ ˆå¸§çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>æŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥çŒœæƒ³ï¼Œå¦‚æœ<strong>æŠŠå±€éƒ¨å˜é‡çš„åœ°å€èµ‹å€¼ç»™åŒ…çº§åˆ«çš„æŒ‡é’ˆå˜é‡</strong>ï¼Œåº”è¯¥ä¹Ÿä¼šé€ æˆå˜é‡é€ƒé€¸ã€‚</li>
<li>å‡†å¤‡ä¸€ä¸ªç¤ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">pt</span> <span class="o">*</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">setNew</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pt</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">a</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>åç¼–è¯‘ <code>setNew()</code> å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.setNew</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">setNew</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455220</span>        <span class="mi">493</span><span class="no">b6610</span>              <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>          <span class="c1"># æ ˆå¢é•¿åˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455224</span>        <span class="mi">765</span><span class="no">d</span>                  <span class="no">JBE</span> <span class="mi">0x455283</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455226</span>        <span class="mi">4883</span><span class="no">ec20</span>              <span class="no">SUBQ</span> <span class="no">$0x20</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45522a</span>        <span class="mi">48896</span><span class="no">c2418</span>            <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45522f</span>        <span class="mi">488</span><span class="no">d6c2418</span>            <span class="no">LEAQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">    <span class="no">var</span> <span class="no">a</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455234</span>        <span class="mi">488</span><span class="no">d05e54a0000</span>        <span class="no">LEAQ</span> <span class="mi">0x4ae5</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>         <span class="c1"># type.int å…ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45523b</span>        <span class="mi">0</span><span class="no">f1f440000</span>            <span class="no">NOPL</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)(</span><span class="no">AX</span><span class="p">*</span><span class="mi">1</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="c1"># func newobject(typ *_type) unsafe.Pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># è¿™é‡Œç›´æ¥è°ƒç”¨äº† newobject å †åˆ†é…äº† int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455240</span>        <span class="no">e8fb5cfbff</span>            <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>  <span class="c1"># *int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455245</span>        <span class="mi">4889442410</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524a</span>        <span class="mi">48</span><span class="no">c70000000000</span>        <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>            <span class="c1"># a = 0    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">pt</span> <span class="err">=</span> <span class="err">&amp;</span><span class="no">a</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455251</span>        <span class="mi">488</span><span class="no">b4c2410</span>            <span class="no">MOVQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">CX</span>           <span class="c1"># CX=0x10(SP)=*int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># åˆ¤æ–­æ˜¯å¦å¼€å¯å†™å±éšœï¼Œå› ä¸ºå¯èƒ½åœ¨GCé˜¶æ®µï¼Œå˜é‡çš„èµ‹å€¼éœ€è¦å†™å±éšœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455256</span>        <span class="mi">833</span><span class="no">d0320090000</span>        <span class="no">CMPL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="no">runtime.writeBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45525d</span>        <span class="mi">7403</span>                  <span class="no">JE</span> <span class="mi">0x455262</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45525f</span>        <span class="mi">90</span>                    <span class="no">NOPL</span>                    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455260</span>        <span class="no">eb09</span>                  <span class="no">JMP</span> <span class="mi">0x45526b</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455262</span>        <span class="mi">48890</span><span class="no">db7320600</span>        <span class="no">MOVQ</span> <span class="no">CX</span><span class="p">,</span> <span class="no">main.pt</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>        <span class="c1"># ç»™å…¨å±€å˜é‡ pt èµ‹å€¼    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455269</span>        <span class="no">eb0e</span>                  <span class="no">JMP</span> <span class="mi">0x455279</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526b</span>        <span class="mi">488</span><span class="no">d3dae320600</span>        <span class="no">LEAQ</span> <span class="no">main.pt</span><span class="p">(</span><span class="no">SB</span><span class="p">),</span> <span class="no">DI</span>            
</span></span><span class="line"><span class="cl">  <span class="c1"># å†™å±éšœå¼€å¯çš„æ—¶å€™è°ƒç”¨å†™å±éšœç›¸å…³å‡½æ•°ï¼Œè®°å½•æŒ‡é’ˆçš„å˜æ›´ï¼Œå·²å¸®åŠ©GC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455272</span>        <span class="no">e8a9d0ffff</span>            <span class="no">CALL</span> <span class="no">runtime.gcWriteBarrierCX</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455277</span>        <span class="no">eb00</span>                  <span class="no">JMP</span> <span class="mi">0x455279</span>                
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455279</span>        <span class="mi">488</span><span class="no">b6c2418</span>            <span class="no">MOVQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527e</span>        <span class="mi">4883</span><span class="no">c420</span>              <span class="no">ADDQ</span> <span class="no">$0x20</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455282</span>        <span class="no">c3</span>                    <span class="no">RET</span>            
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">setNew</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455283</span>        <span class="no">e8d8ccffff</span>            <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455288</span>        <span class="no">eb96</span>                  <span class="no">JMP</span> <span class="no">main.setNew</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="6">
<li>é€šè¿‡ <code>runtime.newobject()</code> å‡½æ•°è°ƒç”¨å°±èƒ½ç¡®å®šï¼Œå˜é‡aé€ƒé€¸åˆ°äº†å †ä¸Šï¼ŒéªŒè¯äº†ä¸Šè¿°çŒœæƒ³ã€‚</li>
</ol>
<h4 id="åŒ…çº§åˆ«æŒ‡é’ˆ2">åŒ…çº§åˆ«æŒ‡é’ˆ(2)<a hidden class="anchor" aria-hidden="true" href="#åŒ…çº§åˆ«æŒ‡é’ˆ2">#</a></h4>
<ol>
<li>è¿›ä¸€æ­¥è¿˜å¯ä»¥éªŒè¯é€ƒé€¸åˆ†æçš„ä¾èµ–ä¼ é€’æ€§ï¼Œå‡†å¤‡ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">pp</span> <span class="o">**</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">dep</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">p</span> <span class="o">*</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">p</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">a</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pp</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åç¼–è¯‘ <code>dep()</code> å‡½æ•°ï¼š
<ol>
<li>å¯ä»¥å‘ç°ï¼Œå˜é‡ p å’Œ a éƒ½é€ƒé€¸äº†ã€‚</li>
<li>p çš„åœ°å€è¢«èµ‹å€¼ç»™åŒ…çº§åˆ«çš„æŒ‡é’ˆå˜é‡ ppï¼Œè€Œ a çš„åœ°å€åˆè¢«èµ‹å€¼ç»™äº† pï¼Œå› ä¸º p é€ƒé€¸é€ æˆ a ä¹Ÿé€ƒé€¸äº†ã€‚</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.dep</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">dep</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455220</span>        <span class="mi">493</span><span class="no">b6610</span>              <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>          <span class="c1"># æ ˆå¢é•¿åˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455224</span>        <span class="mi">0</span><span class="no">f86b0000000</span>          <span class="no">JBE</span> <span class="mi">0x4552da</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45522a</span>        <span class="mi">4883</span><span class="no">ec28</span>              <span class="no">SUBQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45522e</span>        <span class="mi">48896</span><span class="no">c2420</span>            <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455233</span>        <span class="mi">488</span><span class="no">d6c2420</span>            <span class="no">LEAQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">    <span class="no">var</span> <span class="no">a</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455238</span>        <span class="mi">488</span><span class="no">d05e14a0000</span>        <span class="no">LEAQ</span> <span class="mi">0x4ae1</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>         <span class="c1"># type.int å…ƒç±»å‹;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45523f</span>        <span class="mi">90</span>            <span class="no">NOPL</span>        
</span></span><span class="line"><span class="cl">  <span class="c1"># func newobject(typ *_type) unsafe.Pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455240</span>        <span class="no">e8fb5cfbff</span>            <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>  <span class="c1"># å †åˆ†é…äº† a å˜é‡; AX *int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455245</span>        <span class="mi">4889442418</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>           <span class="c1"># 0x18(SP); æ˜¯açš„å†…å­˜ç©ºé—´ï¼ŒæŒ‡å‘å †åˆ†é…æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45524a</span>        <span class="mi">48</span><span class="no">c70000000000</span>        <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>            <span class="c1"># åˆå§‹åŒ– 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">var</span> <span class="no">p</span> <span class="p">*</span><span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455251</span>        <span class="mi">488</span><span class="no">d0508320000</span>        <span class="no">LEAQ</span> <span class="mi">0x3208</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>         <span class="c1"># type *int å…ƒç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1"># func newobject(typ *_type) unsafe.Pointer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455258</span>        <span class="no">e8e35cfbff</span>            <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>  <span class="c1"># **int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45525d</span>        <span class="mi">4889442410</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455262</span>        <span class="mi">833</span><span class="no">df71f090000</span>        <span class="no">CMPL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="no">runtime.writeBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455269</span>        <span class="mi">7402</span>                  <span class="no">JE</span> <span class="mi">0x45526d</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526b</span>        <span class="no">eb09</span>                  <span class="no">JMP</span> <span class="mi">0x455276</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526d</span>        <span class="mi">48</span><span class="no">c70000000000</span>        <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455274</span>        <span class="no">eb11</span>                  <span class="no">JMP</span> <span class="mi">0x455287</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455276</span>        <span class="mi">4889</span><span class="no">c7</span>                <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="no">DI</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455279</span>        <span class="mi">31</span><span class="no">c0</span>                  <span class="no">XORL</span> <span class="no">AX</span><span class="p">,</span> <span class="no">AX</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527b</span>        <span class="mi">0</span><span class="no">f1f440000</span>            <span class="no">NOPL</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)(</span><span class="no">AX</span><span class="p">*</span><span class="mi">1</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455280</span>        <span class="no">e89bcfffff</span>            <span class="no">CALL</span> <span class="no">runtime.gcWriteBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455285</span>        <span class="no">eb00</span>                  <span class="no">JMP</span> <span class="mi">0x455287</span>                
</span></span><span class="line"><span class="cl">    <span class="no">p</span> <span class="err">=</span> <span class="err">&amp;</span><span class="no">a</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455287</span>        <span class="mi">488</span><span class="no">b7c2410</span>            <span class="no">MOVQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">DI</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45528c</span>        <span class="mi">488</span><span class="no">b442418</span>            <span class="no">MOVQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455291</span>        <span class="mi">833</span><span class="no">dc81f090000</span>        <span class="no">CMPL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="no">runtime.writeBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455298</span>        <span class="mi">7402</span>                  <span class="no">JE</span> <span class="mi">0x45529c</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45529a</span>        <span class="no">eb06</span>                  <span class="no">JMP</span> <span class="mi">0x4552a2</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45529c</span>        <span class="mi">488907</span>                <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">DI</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45529f</span>        <span class="mi">90</span>                    <span class="no">NOPL</span>                    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a0</span>        <span class="no">eb07</span>                  <span class="no">JMP</span> <span class="mi">0x4552a9</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a2</span>        <span class="no">e879cfffff</span>            <span class="no">CALL</span> <span class="no">runtime.gcWriteBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a7</span>        <span class="no">eb00</span>                  <span class="no">JMP</span> <span class="mi">0x4552a9</span>                
</span></span><span class="line"><span class="cl">    <span class="no">pp</span> <span class="err">=</span> <span class="err">&amp;</span><span class="no">p</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4552a9</span>        <span class="mi">488</span><span class="no">b442410</span>            <span class="no">MOVQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552ae</span>        <span class="mi">833</span><span class="no">dab1f090000</span>        <span class="no">CMPL</span> <span class="no">$0x0</span><span class="p">,</span> <span class="no">runtime.writeBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b5</span>        <span class="mi">7402</span>                  <span class="no">JE</span> <span class="mi">0x4552b9</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b7</span>        <span class="no">eb09</span>                  <span class="no">JMP</span> <span class="mi">0x4552c2</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b9</span>        <span class="mi">48890560320600</span>        <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="no">main.pp</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552c0</span>        <span class="no">eb0e</span>                  <span class="no">JMP</span> <span class="mi">0x4552d0</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552c2</span>        <span class="mi">488</span><span class="no">d3d57320600</span>        <span class="no">LEAQ</span> <span class="no">main.pp</span><span class="p">(</span><span class="no">SB</span><span class="p">),</span> <span class="no">DI</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552c9</span>        <span class="no">e852cfffff</span>            <span class="no">CALL</span> <span class="no">runtime.gcWriteBarrier</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552ce</span>        <span class="no">eb00</span>                  <span class="no">JMP</span> <span class="mi">0x4552d0</span>                
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4552d0</span>        <span class="mi">488</span><span class="no">b6c2420</span>            <span class="no">MOVQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552d5</span>        <span class="mi">4883</span><span class="no">c428</span>              <span class="no">ADDQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552d9</span>        <span class="no">c3</span>                    <span class="no">RET</span>            
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">dep</span><span class="p">()</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4552da</span>        <span class="no">e881ccffff</span>            <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552df</span>        <span class="mi">90</span>                    <span class="no">NOPL</span>                    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552e0</span>        <span class="no">e93bffffff</span>            <span class="no">JMP</span> <span class="no">main.dep</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>å‡å¦‚æŸä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªè¿”å›å€¼ï¼Œç±»å‹éƒ½æ˜¯æ•´å‹æŒ‡é’ˆï¼Œå‡½æ•°åªæ˜¯ç®€å•åœ°æŠŠå‚æ•°ä½œä¸ºè¿”å›å€¼ã€‚</li>
</ol>
<h4 id="åœ¨å‡½æ•°é—´ä¼ é€’">åœ¨å‡½æ•°é—´ä¼ é€’<a hidden class="anchor" aria-hidden="true" href="#åœ¨å‡½æ•°é—´ä¼ é€’">#</a></h4>
<ol>
<li>å°±åƒä¸‹é¢çš„ <code>gom.RetArg()</code> å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">gom</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">RetArg</span><span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">p</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åœ¨å¦ä¸€ä¸ªåŒ…ä¸­ <code>arg()</code> å‡½æ•°è°ƒç”¨äº† <code>inner.RetArg()</code> å‡½æ•°å°†å±€éƒ¨å˜é‡ a çš„åœ°å€ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›äº†ä¸€ä¸ª int ç±»å‹çš„è¿”å›å€¼ã€‚</li>
<li>ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">arg</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="nx">gom</span><span class="p">.</span><span class="nf">RetArg</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>åœ¨ arg() å‡½æ•°ä¸­å¹¶æ²¡æœ‰æŠŠå˜é‡ a çš„åœ°å€ä½œä¸ºè¿”å›å€¼ï¼Œä¹Ÿä¸å­˜åœ¨åˆ°æŸä¸ªåŒ…çº§åˆ«æŒ‡é’ˆå˜é‡çš„ä¾èµ–é“¾è·¯ï¼Œæ‰€ä»¥å˜é‡aæ˜¯å¦ä¼šé€ƒé€¸çš„å…³é”®å°±åœ¨äº<code>inner.RetArg()</code>å‡½æ•°ã€‚</li>
<li><code>inner. RetArg()</code>å‡½æ•°åªæ˜¯æŠŠä¼ è¿‡å»çš„æŒ‡é’ˆåˆä¼ äº†å›æ¥ï¼Œè€Œä¸”ä½œä¸ºè¢«è°ƒç”¨è€…æ¥è®²ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯å®Œå…¨åŒ…å«åœ¨<code>arg()</code>å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸä»¥å†…çš„ï¼Œæ‰€ä»¥ä¸åº”è¯¥é€ æˆå˜é‡ a é€ƒé€¸ã€‚</li>
<li>äº‹å®åˆ°åº•å¦‚ä½•å‘¢? è¿˜è¦é€šè¿‡åç¼–è¯‘éªŒè¯ï¼ŒèŠ‚é€‰éƒ¨åˆ†å…³é”®æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š
<ol>
<li>å˜é‡aç¡®å®æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œä¹Ÿå°±è¯´æ˜<strong>ç¼–è¯‘å™¨å‚è€ƒäº†inner.RetArg()å‡½æ•°çš„å…·ä½“å®ç°</strong>ï¼ŒåŸºäºä»£ç é€»è¾‘åˆ¤å®šå˜é‡ a æ²¡æœ‰é€ƒé€¸ã€‚</li>
<li>è™½ç„¶ä»£ç ä¸­é€šè¿‡**<code>noinline</code><strong>é˜»æ­¢äº†å†…è”ä¼˜åŒ–ï¼Œä½†æ˜¯</strong>æ²¡èƒ½é˜»æ­¢ç¼–è¯‘å™¨å‚è€ƒå‡½æ•°å®ç°**ã€‚</li>
<li>å‡å¦‚é€šè¿‡æŸç§æ–¹å¼èƒ½å¤Ÿé˜»æ­¢ç¼–è¯‘å™¨å‚è€ƒå‡½æ•°å®ç°ï¼Œåˆä¼šæœ‰ä»€ä¹ˆæ ·çš„ç»“æœå‘¢?</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.arg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">arg</span><span class="p">()</span> <span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455240</span>        <span class="mi">493</span><span class="no">b6610</span>              <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    <span class="c1"># æ ˆå¢é•¿åˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455244</span>        <span class="mi">7643</span>                  <span class="no">JBE</span> <span class="mi">0x455289</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455246</span>        <span class="mi">4883</span><span class="no">ec28</span>              <span class="no">SUBQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524a</span>        <span class="mi">48896</span><span class="no">c2420</span>            <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524f</span>        <span class="mi">488</span><span class="no">d6c2420</span>            <span class="no">LEAQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455254</span>        <span class="mi">48</span><span class="no">c744240800000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># return int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">var</span> <span class="no">a</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45525d</span>        <span class="mi">48</span><span class="no">c744241000000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">    <span class="no">return</span> <span class="p">*</span><span class="no">gom.RetArg</span><span class="p">(</span><span class="err">&amp;</span><span class="no">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å¯ä»¥çœ‹å‡ºè¿™é‡Œè°ƒç”¨gom.RetArgå‡½æ•°æ—¶å‚æ•°ç›´æ¥æ˜¯åœ¨æ ˆä¸Šåˆ†é…çš„ï¼Œå¹¶æ²¡æœ‰å †åˆ†é…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455266</span>        <span class="mi">488</span><span class="no">d442410</span>            <span class="no">LEAQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45526b</span>        <span class="no">e870ffffff</span>            <span class="no">CALL</span> <span class="no">example.com</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">gom.RetArg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455270</span>        <span class="mi">4889442418</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455275</span>        <span class="mi">8400</span>                  <span class="no">TESTB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455277</span>        <span class="mi">488</span><span class="no">b00</span>                <span class="no">MOVQ</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">),</span> <span class="no">AX</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527a</span>        <span class="mi">4889442408</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45527f</span>        <span class="mi">488</span><span class="no">b6c2420</span>            <span class="no">MOVQ</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455284</span>        <span class="mi">4883</span><span class="no">c428</span>              <span class="no">ADDQ</span> <span class="no">$0x28</span><span class="p">,</span> <span class="no">SP</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x455288</span>        <span class="no">c3</span>                    <span class="no">RET</span>                    
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">arg</span><span class="p">()</span> <span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455289</span>        <span class="no">e8d2ccffff</span>            <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45528e</span>        <span class="no">ebb0</span>                  <span class="no">JMP</span> <span class="no">main.arg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="linkname-æœºåˆ¶">linkname æœºåˆ¶<a hidden class="anchor" aria-hidden="true" href="#linkname-æœºåˆ¶">#</a></h4>
<ol>
<li>å¯ä»¥ä½¿ç”¨ <code>linkname</code> æœºåˆ¶ï¼Œè¿åŒä¿®æ”¹åçš„ <code>arg()</code> å‡½æ•°çš„ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;example.com/helium/gom&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="s">&#34;unsafe&#34;</span> <span class="c1">// ä½¿ç”¨äº† go:linkname å¿…é¡»è¦å¼•å…¥ unsafe åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">arg</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:linkname retArg example.com/helium/gom.RetArg
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">retArg</span><span class="p">(</span><span class="nx">p</span> <span class="o">*</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//go:noinline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">arg</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">a</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">b</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="nx">gom</span><span class="p">.</span><span class="nf">RetArg</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">a</span><span class="p">)</span> <span class="o">+</span> <span class="nf">retArg</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>å†æ¬¡åç¼–è¯‘ <code>arg()</code> å‡½æ•°ï¼ŒèŠ‚é€‰å˜é‡ a å’Œ b åˆ†é…ç›¸å…³çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š
<ol>
<li>å˜é‡ a ä¾æ—§æ˜¯æ ˆåˆ†é…ï¼Œå˜é‡ b å·²ç»é€ƒé€¸äº†ã€‚</li>
<li>åœ¨ä¸Šè¿°ä»£ç ä¸­çš„ <code>retArg()</code> å‡½æ•°åªæ˜¯ä¸ªå‡½æ•°å£°æ˜æ²¡æœ‰ç»™å‡ºå…·ä½“å®ç°ï¼Œé€šè¿‡ <code>linkname</code> æœºåˆ¶è®©é“¾æ¥å™¨åœ¨é“¾æ¥é˜¶æ®µé“¾æ¥åˆ° <code>inner.RetArg()</code> å‡½æ•°ã€‚</li>
<li><code>retArg()</code> å‡½æ•°åªæœ‰å£°æ˜æ²¡æœ‰å®ç°ï¼Œè€Œä¸”ç¼–è¯‘å™¨ä¸ä¼šè·Ÿè¸ª <code>linkname</code>ï¼Œæ‰€ä»¥æ— æ³•æ ¹æ®ä»£ç é€»è¾‘åˆ¤å®šå˜é‡ b åˆ°åº•æœ‰æ²¡æœ‰é€ƒé€¸ã€‚</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.arg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">workspace</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">main.go</span>
</span></span><span class="line"><span class="cl"><span class="nf">func</span> <span class="no">arg</span><span class="p">()</span> <span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455240</span>        <span class="mi">493</span><span class="no">b6610</span>              <span class="no">CMPQ</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">SP</span>    <span class="c1"># æ ˆå¢é•¿åˆ¤æ–­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455244</span>        <span class="mi">7677</span>                  <span class="no">JBE</span> <span class="mi">0x4552bd</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x455246</span>        <span class="mi">4883</span><span class="no">ec40</span>              <span class="no">SUBQ</span> <span class="no">$0x40</span><span class="p">,</span> <span class="no">SP</span>        
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524a</span>        <span class="mi">48896</span><span class="no">c2438</span>            <span class="no">MOVQ</span> <span class="no">BP</span><span class="p">,</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x45524f</span>        <span class="mi">488</span><span class="no">d6c2438</span>            <span class="no">LEAQ</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455254</span>        <span class="mi">48</span><span class="no">c744241000000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># return int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">var</span> <span class="no">a</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45525d</span>        <span class="mi">48</span><span class="no">c744241800000000</span>    <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>    <span class="c1"># a,0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">var</span> <span class="no">b</span> <span class="no">int</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x455266</span>        <span class="mi">488</span><span class="no">d05b34a0000</span>        <span class="no">LEAQ</span> <span class="mi">0x4ab3</span><span class="p">(</span><span class="no">IP</span><span class="p">),</span> <span class="no">AX</span>    <span class="c1"># type.int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x45526d</span>        <span class="no">e8ce5cfbff</span>            <span class="no">CALL</span> <span class="no">runtime.newobject</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    <span class="c1"># *int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455272</span>        <span class="mi">4889442430</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span> <span class="c1"># å˜é‡bï¼Œå †åˆ†é…äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">0</span><span class="nf">x455277</span>        <span class="mi">48</span><span class="no">c70000000000</span>        <span class="no">MOVQ</span> <span class="no">$0x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">    <span class="no">return</span> <span class="p">*</span><span class="no">gom.RetArg</span><span class="p">(</span><span class="err">&amp;</span><span class="no">a</span><span class="p">)</span> <span class="err">+</span> <span class="p">*</span><span class="no">retArg</span><span class="p">(</span><span class="err">&amp;</span><span class="no">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x45527e</span>        <span class="mi">488</span><span class="no">d442418</span>            <span class="no">LEAQ</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455283</span>        <span class="no">e858ffffff</span>            <span class="no">CALL</span> <span class="no">example.com</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">gom.RetArg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455288</span>        <span class="mi">4889442428</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x28</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45528d</span>        <span class="mi">488</span><span class="no">b442430</span>            <span class="no">MOVQ</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x455292</span>        <span class="no">e849ffffff</span>            <span class="no">CALL</span> <span class="no">example.com</span><span class="err">/</span><span class="no">helium</span><span class="err">/</span><span class="no">gom.RetArg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x455297</span>        <span class="mi">4889442420</span>            <span class="no">MOVQ</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x45529c</span>        <span class="mi">488</span><span class="no">b4c2428</span>            <span class="no">MOVQ</span> <span class="mi">0x28</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">CX</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a1</span>        <span class="mi">8401</span>                  <span class="no">TESTB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">CX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a3</span>        <span class="mi">8400</span>                  <span class="no">TESTB</span> <span class="no">AL</span><span class="p">,</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a5</span>        <span class="mi">488</span><span class="no">b09</span>                <span class="no">MOVQ</span> <span class="mi">0</span><span class="p">(</span><span class="no">CX</span><span class="p">),</span> <span class="no">CX</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552a8</span>        <span class="mi">480308</span>                <span class="no">ADDQ</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">),</span> <span class="no">CX</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552ab</span>        <span class="mi">48894</span><span class="no">c2410</span>            <span class="no">MOVQ</span> <span class="no">CX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">SP</span><span class="p">)</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b0</span>        <span class="mi">4889</span><span class="no">c8</span>                <span class="no">MOVQ</span> <span class="no">CX</span><span class="p">,</span> <span class="no">AX</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b3</span>        <span class="mi">488</span><span class="no">b6c2438</span>            <span class="no">MOVQ</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">SP</span><span class="p">),</span> <span class="no">BP</span>            
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552b8</span>        <span class="mi">4883</span><span class="no">c440</span>              <span class="no">ADDQ</span> <span class="no">$0x40</span><span class="p">,</span> <span class="no">SP</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552bc</span>        <span class="no">c3</span>                    <span class="no">RET</span>                    
</span></span><span class="line"><span class="cl"><span class="no">func</span> <span class="no">arg</span><span class="p">()</span> <span class="no">int</span> <span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">0</span><span class="nf">x4552bd</span>        <span class="mi">0</span><span class="no">f1f00</span>                <span class="no">NOPL</span> <span class="mi">0</span><span class="p">(</span><span class="no">AX</span><span class="p">)</span>                
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552c0</span>        <span class="no">e89bccffff</span>            <span class="no">CALL</span> <span class="no">runtime.morestack_noctxt.abi0</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>    
</span></span><span class="line"><span class="cl">  <span class="mi">0x4552c5</span>        <span class="no">e976ffffff</span>            <span class="no">JMP</span> <span class="no">main.arg</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æŠŠé€»è¾‘ä¸Šæ²¡æœ‰é€ƒé€¸çš„å˜é‡åˆ†é…åˆ°å †ä¸Šä¸ä¼šé€ æˆé”™è¯¯ï¼Œåªæ˜¯æ•ˆç‡ä½ä¸€äº›ã€‚</li>
<li>ä½†æ˜¯æŠŠé€»è¾‘ä¸Šé€ƒé€¸äº†çš„å˜é‡åˆ†é…åˆ°æ ˆä¸Šå°±ä¼šé€ æˆæ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ã€‚</li>
<li>å› æ­¤ç¼–è¯‘å™¨åªæœ‰åœ¨èƒ½å¤Ÿç¡®å®šå˜é‡æ²¡æœ‰é€ƒé€¸çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†å…¶åˆ†é…åˆ°æ ˆä¸Šï¼Œåœ¨èƒ½å¤Ÿç¡®å®šå˜é‡å·²ç»é€ƒé€¸æˆ–æ— æ³•ç¡®å®šåˆ°åº•æœ‰æ²¡æœ‰é€ƒé€¸çš„æƒ…å†µä¸‹ï¼Œéƒ½è¦æŒ‰ç…§å·²ç»é€ƒé€¸æ¥å¤„ç†ã€‚</li>
<li>è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨ä¸Šè¿°ä»£ç ä¸­çš„å˜é‡ b é€»è¾‘ä¸Šæ²¡é€ƒé€¸å´è¢«åˆ†é…åœ¨äº†å †ä¸Šã€‚</li>
</ol>
<h2 id="å‡½æ•°ç¤ºä¾‹">å‡½æ•°ç¤ºä¾‹<a hidden class="anchor" aria-hidden="true" href="#å‡½æ•°ç¤ºä¾‹">#</a></h2>
<h3 id="ç¤ºä¾‹ä¸€">ç¤ºä¾‹ä¸€<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ä¸€">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// sum è®¡ç®—a, bçš„å¹³æ–¹å’Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">sum</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">a2</span> <span class="o">:=</span> <span class="nx">a</span> <span class="o">*</span> <span class="nx">a</span>
</span></span><span class="line"><span class="cl">    <span class="nx">b2</span> <span class="o">:=</span> <span class="nx">b</span> <span class="o">*</span> <span class="nx">b</span>
</span></span><span class="line"><span class="cl">    <span class="nx">c</span> <span class="o">:=</span> <span class="nx">a2</span> <span class="o">+</span> <span class="nx">b2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">c</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li><code>main.main</code>æ±‡ç¼–ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.main</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">g</span><span class="err">/</span><span class="no">hello1</span><span class="err">/</span><span class="no">hello.go</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># åˆ¤æ–­æ ˆæ˜¯å¦æº¢å‡º 0x10(R14)æŒ‡å‘g.stackguard0ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4a0</span>    <span class="mi">493</span><span class="no">b6610</span>      <span class="no">cmp</span> <span class="no">rsp</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">r14</span><span class="err">+</span><span class="mi">0x10</span><span class="p">]</span>          <span class="no">cmp</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">R14</span><span class="p">),</span> <span class="no">rsp</span>    
</span></span><span class="line"><span class="cl">    <span class="c1"># è·³è½¬åˆ°0x45b4cfå¤„è®¾ç½®æ ˆä¿¡æ¯ï¼Œåœ¨é‡æ–°è°ƒmain.mainå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4a4</span>    <span class="mi">7629</span>          <span class="no">jbe</span> <span class="mi">0x45b4cf</span>                           <span class="no">jbe</span> <span class="mi">0x45b4cf</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºå½“å‰æ ˆé¢„åˆ†é…å‚æ•°ç©ºé—´ï¼Œç¬¬ä¸€ä¸ª8Bå­˜å‚¨runtime.mainçš„rbpï¼Œç¬¬äºŒä¸ª8Bå­˜å‚¨main.sunçš„å‚æ•°bä¸º1ï¼Œç¬¬ä¸‰ä¸ª8Bå­˜å‚¨main.sunçš„å‚æ•°aä¸º2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4a6</span>    <span class="mi">4883</span><span class="no">ec18</span>      <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x18</span>                          <span class="no">sub</span> <span class="mi">0x18</span><span class="p">,</span> <span class="no">rsp</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># æŠŠruntime.mainçš„æ ˆrbpå­˜å…¥0x10(rsp)å¤„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4aa</span>    <span class="mi">48896</span><span class="no">c2410</span>    <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="p">],</span> <span class="no">rbp</span>          <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä»æ–°è®¾ç½®å½“å‰main.mainçš„æ ˆrbpå€¼ä¸º0x10(rsp)å¤„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4af</span>    <span class="mi">488</span><span class="no">d6c2410</span>    <span class="no">lea</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="p">]</span>                <span class="no">lea</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">rbp</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºmain.sumå‡†å¤‡ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾å…¥å¯„å­˜å™¨AXä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">4</span>    <span class="err">0</span><span class="nf">x45b4b4</span>    <span class="no">b801000000</span>    <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x1</span>                           <span class="no">mov</span> <span class="mi">0x1</span><span class="p">,</span> <span class="no">AX</span>            
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºmain.sumå‡†å¤‡ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ”¾å…¥å¯„å­˜å™¨BXä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">4</span>    <span class="err">0</span><span class="nf">x45b4b9</span>    <span class="no">bb02000000</span>    <span class="no">mov</span> <span class="no">ebx</span><span class="p">,</span> <span class="mi">0x2</span>                           <span class="no">mov</span> <span class="mi">0x2</span><span class="p">,</span> <span class="no">BX</span>                
</span></span><span class="line"><span class="cl">    <span class="no">hello.go</span><span class="p">:</span><span class="mi">4</span>    <span class="mi">0x45b4be</span>    <span class="mi">6690</span>          <span class="no">data16</span> <span class="no">nop</span>
</span></span><span class="line"><span class="cl">    <span class="nl">hello.go:</span><span class="err">4</span>    <span class="err">0</span><span class="nf">x45b4c0</span>    <span class="no">e81b000000</span>    <span class="no">call</span> <span class="no">$main.sum</span>                         <span class="no">call</span> <span class="no">$main.sum</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æŠŠruntime.mainçš„æ ˆrbpå€¼ä»0x10(rsp)å¤„æ”¾å…¥rbpå¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">5</span>    <span class="err">0</span><span class="nf">x45b4c5</span>    <span class="mi">488</span><span class="no">b6c2410</span>    <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="p">]</span>          <span class="no">mov</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">rbp</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># rspå¯„å­˜å™¨æ¢å¤è°ƒç”¨main.mainä¹‹å‰æƒ…å†µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">5</span>    <span class="err">0</span><span class="nf">x45b4ca</span>    <span class="mi">4883</span><span class="no">c418</span>      <span class="no">add</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x18</span>                          <span class="no">add</span> <span class="mi">0x18</span><span class="p">,</span> <span class="no">rsp</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿”å›ï¼Œrsp-8å¼¹å‡ºè¿”å›åœ°å€ç»™ripè¿”å›çš„runtime.mainç»§ç»­æ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">5</span>    <span class="err">0</span><span class="nf">x45b4ce</span>    <span class="no">c3</span>            <span class="no">ret</span>                                    <span class="no">ret</span>
</span></span><span class="line"><span class="cl">    <span class="nl">hello.go:</span><span class="err">3</span>    <span class="err">0</span><span class="nf">x45b4cf</span>    <span class="no">e88ccdffff</span>    <span class="no">call</span> <span class="no">$runtime.morestack_noctxt</span>         <span class="no">call</span> <span class="no">$runtime.morestack_noctxt</span>
</span></span><span class="line"><span class="cl">    <span class="err">.:0</span>           <span class="err">0</span><span class="nf">x45b4d4</span>    <span class="no">ebca</span>          <span class="no">jmp</span> <span class="no">$main.main</span>                         <span class="no">jmp</span> <span class="no">$main.main</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><code>main.sum</code>æ±‡ç¼–ï¼š</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">TEXT</span> <span class="no">main.sum</span><span class="p">(</span><span class="no">SB</span><span class="p">)</span> <span class="err">/</span><span class="no">mnt</span><span class="err">/</span><span class="no">hgfs</span><span class="err">/</span><span class="no">g</span><span class="err">/</span><span class="no">hello1</span><span class="err">/</span><span class="no">hello.go</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºmain.sumæ ˆé¢„åˆ†é…0x28ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4e0</span>    <span class="mi">4883</span><span class="no">ec28</span>          <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x28</span>                        <span class="no">sub</span> <span class="mi">0x28</span><span class="p">,</span> <span class="no">rsp</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æŠŠmain.mainçš„rbpå­˜å‚¨åˆ°0x20(rsp)ä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4e4</span>    <span class="mi">48896</span><span class="no">c2420</span>        <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x20</span><span class="p">],</span> <span class="no">rbp</span>        <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä»æ–°è®¾ç½®main.sumçš„rbpå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4e9</span>    <span class="mi">488</span><span class="no">d6c2420</span>        <span class="no">lea</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x20</span><span class="p">]</span>              <span class="no">lea</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æŠŠä¼ é€’çš„ç¬¬ä¸€ä¸ªå‚æ•°å…¥æ ˆï¼Œæ³¨æ„çœ‹è¿™é‡Œå‚å‚æ•°æ ˆåˆ†é…åœ¨main.mainçš„æ ˆä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4ee</span>    <span class="mi">4889442430</span>        <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x30</span><span class="p">],</span> <span class="no">rax</span>        <span class="no">mov</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>    <span class="c1"># a = 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># æŠŠä¼ é€’çš„ç¬¬äºŒä¸ªå‚æ•°å…¥æ ˆï¼Œæ³¨æ„çœ‹è¿™é‡Œå‚å‚æ•°æ ˆåˆ†é…åœ¨main.mainçš„æ ˆä¸Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4f3</span>    <span class="mi">48895</span><span class="no">c2438</span>        <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x38</span><span class="p">],</span> <span class="no">rbx</span>        <span class="no">mov</span> <span class="no">BX</span><span class="p">,</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>    <span class="c1"># b = 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># åˆå§‹åŒ–rspçš„ç¬¬ä¸€ä¸ª8å­—èŠ‚å—ï¼Œè¿”å›å€¼ç©ºé—´åˆå§‹åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">8</span>    <span class="err">0</span><span class="nf">x45b4f8</span>    <span class="mi">48</span><span class="no">c7042400000000</span>  <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="p">],</span> <span class="mi">0x0</span>             <span class="no">mov</span> <span class="mi">0x0</span><span class="p">,</span> <span class="p">(</span><span class="no">rsp</span><span class="p">)</span>       <span class="c1"># return
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡açš„å€¼æ”¾å…¥å¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">9</span>    <span class="err">0</span><span class="nf">x45b500</span>    <span class="mi">488</span><span class="no">b4c2430</span>        <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x30</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">CX</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡açš„å€¼æ”¾å…¥å¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">9</span>    <span class="err">0</span><span class="nf">x45b505</span>    <span class="mi">488</span><span class="no">b542430</span>        <span class="no">mov</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x30</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x30</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">DX</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¹˜æ³•è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨DXä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">9</span>    <span class="err">0</span><span class="nf">x45b50a</span>    <span class="mi">480</span><span class="no">fafd1</span>          <span class="no">imul</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">rcx</span>                        <span class="no">imul</span> <span class="no">CX</span><span class="p">,</span> <span class="no">DX</span>          <span class="c1"># a*a        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># 0X18(rsp)çš„åœ°å€ä¸ºå˜é‡a2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">9</span>    <span class="err">0</span><span class="nf">x45b50e</span>    <span class="mi">4889542418</span>        <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x18</span><span class="p">],</span> <span class="no">rdx</span>        <span class="no">mov</span> <span class="no">DX</span><span class="p">,</span> <span class="mi">0X18</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>    <span class="c1"># a2=a*a    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡bçš„å€¼æ”¾å…¥å¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">10</span>    <span class="err">0</span><span class="nf">x45b513</span>    <span class="mi">488</span><span class="no">b4c2438</span>       <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x38</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">CX</span>    
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸ºä¹˜æ³•è¿ç®—åšå‡†å¤‡ï¼ŒæŠŠå˜é‡bçš„å€¼æ”¾å…¥å¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">10</span>    <span class="err">0</span><span class="nf">x45b518</span>    <span class="mi">488</span><span class="no">b542438</span>       <span class="no">mov</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x38</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x38</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">DX</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¹˜æ³•è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨DXä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">10</span>    <span class="err">0</span><span class="nf">x45b51d</span>    <span class="mi">480</span><span class="no">fafd1</span>         <span class="no">imul</span> <span class="no">rdx</span><span class="p">,</span> <span class="no">rcx</span>                        <span class="no">imul</span> <span class="no">CX</span><span class="p">,</span> <span class="no">DX</span>  <span class="c1"># b*b        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># 0X10(rsp)çš„åœ°å€ä¸ºå˜é‡b2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">10</span>    <span class="err">0</span><span class="nf">x45b521</span>    <span class="mi">4889542410</span>       <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x10</span><span class="p">],</span> <span class="no">rdx</span>        <span class="no">mov</span> <span class="no">DX</span><span class="p">,</span> <span class="mi">0x10</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>    <span class="c1"># b2 = b*b    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># æŠŠa2å€¼æ”¾å…¥CXå¯„å­˜å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">11</span>    <span class="err">0</span><span class="nf">x45b526</span>    <span class="mi">488</span><span class="no">b4c2418</span>       <span class="no">mov</span> <span class="no">rcx</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x18</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x18</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">CX</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># è®¡ç®— a2 + b2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">11</span>    <span class="err">0</span><span class="nf">x45b52b</span>    <span class="mi">488</span><span class="no">d0411</span>         <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rcx</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">]</span>             <span class="no">lea</span> <span class="p">(</span><span class="no">CX</span><span class="err">+</span><span class="no">DX</span><span class="p">*</span><span class="mi">1</span><span class="p">),</span> <span class="no">AX</span>    <span class="c1"># a2+b2    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># a2 + b2 å€¼å­˜å…¥0x8(rsp)æ˜¯å˜é‡çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">11</span>    <span class="err">0</span><span class="nf">x45b52f</span>    <span class="mi">4889442408</span>       <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x8</span><span class="p">],</span> <span class="no">rax</span>         <span class="no">mov</span> <span class="no">AX</span><span class="p">,</span> <span class="mi">0x8</span><span class="p">(</span><span class="no">rsp</span><span class="p">)</span>     <span class="c1"># c = a2+b2    
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># a2 + b2 å€¼å­˜å…¥(rsp) è¯¥å€¼æ˜¯è¿”å›å€¼ç©ºé—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">13</span>    <span class="err">0</span><span class="nf">x45b534</span>    <span class="mi">48890424</span>         <span class="no">mov</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="p">],</span> <span class="no">rax</span>             <span class="no">mov</span> <span class="no">AX</span><span class="p">,</span> <span class="p">(</span><span class="no">rsp</span><span class="p">)</span>        <span class="c1"># return        
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># å¼¹å‡ºmain.mainçš„rbp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nl">hello.go:</span><span class="err">13</span>    <span class="err">0</span><span class="nf">x45b538</span>    <span class="mi">488</span><span class="no">b6c2420</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">qword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">0x20</span><span class="p">]</span>        <span class="no">mov</span> <span class="mi">0x20</span><span class="p">(</span><span class="no">rsp</span><span class="p">),</span> <span class="no">rbp</span>        
</span></span><span class="line"><span class="cl">    <span class="c1"># ä½¿rspæŒ‡å‘main.mainçš„æ ˆrspä½ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="err">.:0</span>            <span class="err">0</span><span class="nf">x45b53d</span>    <span class="mi">4883</span><span class="no">c428</span>         <span class="no">add</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x28</span>                        <span class="no">add</span> <span class="mi">0x28</span><span class="p">,</span> <span class="no">rsp</span>            
</span></span><span class="line"><span class="cl">    <span class="c1"># å¼¹å‡ºmain.mainçš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="err">.:0</span>            <span class="err">0</span><span class="nf">x45b541</span>    <span class="no">c3</span>               <span class="no">ret</span>                                  <span class="no">ret</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>æ ˆåˆ†å¸ƒæƒ…å†µï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">// æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç åœ¨14è¡Œæ—¶ä¹Ÿå°±æ˜¯main.sumå‡½æ•°è¿”å›å‰çš„æ ˆå¸ƒå±€æƒ…å†µ
</span></span><span class="line"><span class="cl">//
</span></span><span class="line"><span class="cl">//                            æ ˆåº•
</span></span><span class="line"><span class="cl">//                ----------------------------    é«˜åœ°å€
</span></span><span class="line"><span class="cl">//               | b
</span></span><span class="line"><span class="cl">//                ----------------------------
</span></span><span class="line"><span class="cl">//               | a                                            runtime.mainå‡½æ•°æ ˆå¸§
</span></span><span class="line"><span class="cl">//                ----------------------------
</span></span><span class="line"><span class="cl">//               |   è¿”å›åˆ°runtime.mainçš„åœ°å€        +0x48
</span></span><span class="line"><span class="cl">// -----------&gt; ---------------------------- &lt;-------------------------------------
</span></span><span class="line"><span class="cl">//               |   è°ƒç”¨å‡½æ•°runtime.mainçš„rbp       +0x40                
</span></span><span class="line"><span class="cl">//                ----------------------------                          
</span></span><span class="line"><span class="cl">//               |   main.sumçš„ç¬¬äºŒä¸ªå‚æ•° 0x2        +0x38                
</span></span><span class="line"><span class="cl">//                ----------------------------                main.mainå‡½æ•°æ ˆå¸§
</span></span><span class="line"><span class="cl">//               |   main.sumçš„ç¬¬ä¸€ä¸ªå‚æ•° 0x1        +0x30                
</span></span><span class="line"><span class="cl">//                 ----------------------------                         
</span></span><span class="line"><span class="cl">//               |   è¿”å›åˆ°main.mainçš„åœ°å€           +0x28                
</span></span><span class="line"><span class="cl">// -----------&gt; ---------------------------- &lt;-------------------------------------
</span></span><span class="line"><span class="cl">//               |   è°ƒç”¨å‡½æ•°main.mainçš„rbp          +0x20               
</span></span><span class="line"><span class="cl">//                 ----------------------------                        
</span></span><span class="line"><span class="cl">//               |   å˜é‡a2   0x1                   +0x18               
</span></span><span class="line"><span class="cl">//                 ----------------------------                        
</span></span><span class="line"><span class="cl">//               |   å˜é‡b2   0x4                   +0x10        main.sumå‡½æ•°æ ˆå¸§
</span></span><span class="line"><span class="cl">//                 ----------------------------                        
</span></span><span class="line"><span class="cl">//               |   å˜é‡c   0x5                    +0x8                
</span></span><span class="line"><span class="cl">//                 ----------------------------                        
</span></span><span class="line"><span class="cl">//               |   main.sumçš„è¿”å›å€¼åœ°å€ 0x5        +0x0                
</span></span><span class="line"><span class="cl">// -----------&gt; ---------------------------- &lt;-------------------------------------
</span></span></code></pre></div><h2 id="ç¼–è¯‘æŒ‡ä»¤">ç¼–è¯‘æŒ‡ä»¤<a hidden class="anchor" aria-hidden="true" href="#ç¼–è¯‘æŒ‡ä»¤">#</a></h2>
<ol>
<li>ç¼–è¯‘æŒ‡ä»¤ï¼šgo build -gcflags=&quot;-N -l&quot; slice1.goã€‚</li>
<li>æŸ¥çœ‹å…·ä½“æ–¹æ³•çš„æ±‡ç¼–æŒ‡ä»¤ï¼šgo tool objdump -S -s &lsquo;^main.main$&rsquo; slice1ã€‚</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://heliu.site/tags/golang/">Golang</a></li>
      <li><a href="https://heliu.site/tags/%E5%87%BD%E6%95%B0/">å‡½æ•°</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://heliu.site/posts/golang/func/stack/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>å‡½æ•°è°ƒç”¨æ ˆ</span>
  </a>
  <a class="next" href="https://heliu.site/posts/golang/func/value/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Function Value</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
    </span>
    <span id="busuanzi_container_site_uv">
        æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
    </span>
    </div>
        <span>Copyright Â© 2024 èœ€ICPå¤‡2024091074å· <a href="#">heliu's blog</a>. All rights reserved</span>  
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Done';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>

<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>数据类型 | Helium</title>
<meta name="keywords" content="pgsql">
<meta name="description" content="💥本文章所有相关PostgreSQL 14版本。">
<meta name="author" content="helium">
<link rel="canonical" href="https://heliu.site/posts/postgresql/datatype/">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://heliu.site/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://heliu.site/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://heliu.site/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://heliu.site/apple-touch-icon.png">
<link rel="mask-icon" href="https://heliu.site/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://heliu.site/posts/postgresql/datatype/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jetbrains-mono@1.0.6/css/jetbrains-mono-nl.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.1.0/style.css" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.6.0/style.css" />
    <style>
        body {
            font-family: "LXGW WenKai Lite", sans-serif;
            font-family: "LXGW WenKai Screen", sans-serif;
        }
    </style>
</head>
</html>

  

<meta property="og:title" content="数据类型" />
<meta property="og:description" content="💥本文章所有相关PostgreSQL 14版本。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://heliu.site/posts/postgresql/datatype/" />
<meta property="og:image" content="https://heliu.site/favicon-32x32.png" />
<meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-09-23T00:00:00+00:00" /><meta property="og:site_name" content="Helium" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://heliu.site/favicon-32x32.png" />
<meta name="twitter:title" content="数据类型"/>
<meta name="twitter:description" content="💥本文章所有相关PostgreSQL 14版本。"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Article",
      "item": "https://heliu.site/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "PostgreSQL",
      "item": "https://heliu.site/posts/postgresql/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "数据类型",
      "item": "https://heliu.site/posts/postgresql/datatype/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "数据类型",
  "name": "数据类型",
  "description": "💥本文章所有相关PostgreSQL 14版本。",
  "keywords": [
    "pgsql"
  ],
  "articleBody": " 官网中文文档：http://www.postgres.cn/docs/14/datatype.html 数字类型 数字类型由2、4或8字节的整数以及4或8字节的浮点数和可选精度小数组成。 名字 存储尺寸 描述 范围 smallint 2字节 小范围整数 -32768 to +32767 integer 4字节 整数的典型选择 -2147483648 to +2147483647 bigint 8字节 大范围整数 -9223372036854775808 to +9223372036854775807 decimal 可变 用户指定精度，精确 最高小数点前131072位，以及小数点后16383位 numeric 可变 用户指定精度，精确 最高小数点前131072位，以及小数点后16383位 real 4字节 可变精度，不精确 6位十进制精度 double precision 8字节 可变精度，不精确 15位十进制精度 smallserial 2字节 自动增加的小整数 1到32767 serial 4字节 自动增加的整数 1到2147483647 bigserial 8字节 自动增长的大整数 1到9223372036854775807 整数类型 smallint、integer、bigint 整数类型。(postgreSQL不支持无符号整型) SQL只声明了整数类型integer（或int）、smallint和bigint。类型int2、int4和int8都是扩展，也在许多其它SQL数据库系统中使用。 -- INT 是 INTEGER 的同义词，您可以使用 INT 代替 INTEGER。 CREATE TABLE my_schema.t01 ( s_id smallint NOT NULL, i_id integer NOT NULL, b_id bigint ); INSERT INTO t01 VALUES (1,12,211); smallint、integer、bigint SMALLINT需要 2 个字节的存储大小，可以存储 (-32,767, 32,767) 范围内的任何整数。 您可以使用SMALLINT类型来存储诸如人的年龄、书籍的页数等内容。 CREATE TABLE books ( book_id SERIAL PRIMARY KEY, title VARCHAR (255) NOT NULL, pages SMALLINT NOT NULL CHECK (pages \u003e 0) ); INTEGER是整数类型中最常见的选择，因为它提供了存储大小、范围和性能之间的最佳平衡。 INTEGER类型需要 4 字节存储大小，可以存储 (-2,147,483,648, 2,147,483,647) 范围内的数字。 您可以将INTEGER类型用于存储相当大的整数（例如城市甚至国家的人口）的列，如下例所示： CREATE TABLE cities ( city_id serial PRIMARY KEY, city_name VARCHAR (255) NOT NULL, population INT NOT NULL CHECK (population \u003e= 0) -- 注意，INT是INTEGER的同义词 ); 如果你想存储超出INTEGER类型范围的整数，你可以使用BIGINT类型。 BIGINT类型需要 8 字节存储大小，可以存储 (-9,223,372,036,854,775,808, +9,223,372,036,854,775,807) 范围内的任何数字。 使用BIGINT类型不仅会消耗大量存储空间，还会降低数据库的性能，因此，您应该要有充分的理由才使用它。 任意精度数字 类型numeric可以存储非常多位的数字。我们特别建议将它用于货币金额和其它要求计算准确的数量。 numeric值的计算在可能的情况下会得到准确的结果，例如加法、减法、乘法。不过，numeric类型上的算术运算比整数类型或者下一节描述的浮点数类型要慢很多。 在随后的内容里，我们使用了下述术语：一个numeric的precision（精度）是整个数中有效位的总数，也就是小数点两边的位数。 numeric的scale（小数位数）是小数部分的数字位数，也就是小数点右边的部分。因此数字 23.5141 的精度为6而小数位数为4。可以认为整数的小数位数为零。 numeric列的最大精度和最大小数位数都是可以配置的。要声明一个类型为numeric的列，你可以用下面的语法： precision：可选的。它是允许存储的数字的总位数，含小数部分的位数。 scale：可选的。小数部分的位数。 例如，数字 1234.567 具有 precision 7 和 scale 3 。 注意，DECIMAL 和 NUMERIC 是等价的。 # 精度必须为正数，小数位数可以为零或者正数。 NUMERIC(precision, scale) # 选择小数位数为0。 NUMERIC(precision) # 在没有指定任何精度或小数位数的情况下，创建一个“无约束的数值”列，其中可以存储任意长度的数值，直到被实现所限制。 NUMERIC NUMERIC 适用于存储含有大量数字的数值。它的小数点前最多 131072 位数字，小数点后最多 16383 位数字。 除了普通的数值之外，浮点类型还有几个特殊值： 'Infinity': 无穷大。 '-Infinity': 负无穷大。 'NaN': 非数字。 在SQL命令中将这些值作为常量写入时，必须在其周围加引号，例如UPDATE table SET x = ‘-Infinity’。输入时，以不区分大小写的方式识别这些字符串。无穷大值也可以拼写为inf和-inf。 CREATE TABLE test_numeric ( numeric_5_2 NUMERIC(5,2), numeric_i NUMERIC ); -- 插入一条数据 INSERT INTO test_numeric (numeric_5_2) VALUES (1234.456) RETURNING numeric_5_2; -- 这里，因为数字 1234.234 超出了 NUMERIC(5,2) 的范围，因此 PostgreSQL 给出了一个错误。 /* Output ERROR: numeric field overflow DETAIL: A field with precision 5, scale 2 must round to an absolute value less than 10^3. */ INSERT INTO test_numeric (numeric_5_2) VALUES (234.456) RETURNING numeric_5_2; -- 这里，由于 NUMERIC(5,2) 允许的小数位为 2，因此 234.456 被四舍五入为 234.46。 /* Output numeric_5_2 ------------- 234.46 (1 row) */ PostgreSQL 14 开始支持 Infinity 与 -Infinity。 您不能向一个有限范围的 NUMERIC 写入 Infinity 与 -Infinity， 否则 PostgreSQL 将给出一个错误。比如： INSERT INTO test_numeric (numeric_5_2) VALUES ('Infinity') RETURNING numeric_5_2; /* Output ERROR: numeric field overflow DETAIL: A field with precision 5, scale 2 cannot hold an infinite value. */ INSERT INTO test_numeric (numeric_i) VALUES ('Infinity') RETURNING numeric_i; /* numeric_i ----------- Infinity (1 row) */ INSERT INTO test_numeric (numeric_i) VALUES ('-Infinity') RETURNING numeric_i; /* numeric_i ----------- -Infinity (1 row) */ INSERT INTO test_numeric (numeric_5_2) VALUES ('NaN') RETURNING numeric_5_2; /* numeric_5_2 ------------- NaN (1 row) */ 浮点类型 数据类型real和double precision是不精确的、变精度的数字类型。 使用浮点类型需要注意： 如果你要求准确的存储和计算（例如计算货币金额），应使用numeric类型。 如果你想用这些类型做任何重要的复杂计算，尤其是那些你对范围情况（无穷、下溢）严重依赖的事情，那你应该仔细评诂你的实现。 用两个浮点数值进行等值比较不可能总是按照期望地进行。 real类型的范围是 1E-37 to 1E+37，精度至少是 6 位小数。double precision类型的范围是 1E-307 to 1E+308，精度至少是 15 位数字。 太大或者太小的值都会导致错误。如果输入数字的精度太高，那么可能发生四舍五入。太接近零的数字，如果不能体现出与零的区别就会导致下溢错误。 除了普通的数字值之外，浮点类型还有几个特殊值： Infinity -Infinity NaN 如果在 SQL 命令里把这些数值当作常量写，你必须在它们周围放上单引号，例如UPDATE table SET x = ‘-Infinity’。在输入时，这些字符串是以大小写不敏感的方式识别的。无穷大值也可以拼写为inf和-inf。 CREATE TABLE f01 ( f_01 REAL, d_01 DOUBLE PRECISION ); INSERT INTO f01(f_01, d_01) VALUES (12.212, 333.21212321); real real数据类型允许您在数据库中存储单精度浮点数。 real 类型的值占用4个字节的存储空间。其有效范围从1E-37到1E+37。 通常，您会使用real数据类型，来存储具有相对较大范围的浮点数，而且精度没那么重要，或者当您担心存储空间时也可以考虑使用。 但是，如果需要更高的精度，可以使用 double precision 数据类型。 CREATE TABLE weathers( id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, location VARCHAR(255) NOT NULL, wind_speed_mps REAL NOT NULL, temperature_celsius REAL NOT NULL, recorded_at TIMESTAMP NOT NULL ); INSERT INTO weathers (location, wind_speed_mps, temperature_celsius, recorded_at) VALUES ('New York', 5.2, 15.3, '2024-04-19 09:00:00'), ('New York', 4.8, 14.9, '2024-04-19 10:00:00'), ('New York', 6.0, 16.5, '2024-04-19 11:00:00'), ('New York', 5.5, 15.8, '2024-04-19 12:00:00'), ('New York', 4.3, 14.2, '2024-04-19 13:00:00'), ('New York', 5.9, 16.1, '2024-04-19 14:00:00'), ('New York', 6.8, 17.3, '2024-04-19 15:00:00'), ('New York', 5.1, 15.6, '2024-04-19 16:00:00'), ('New York', 4.7, 14.8, '2024-04-19 17:00:00'), ('New York', 5.3, 15.9, '2024-04-19 18:00:00'); SELECT AVG(wind_speed_mps) wind_speed, AVG(temperature_celsius) temperature_celsius FROM weathers WHERE location = 'New York' AND DATE(recorded_at) = '2024-04-19'; /* wind_speed | temperature_celsius -------------------+--------------------- 5.360000038146973 | 15.639999961853027 (1 row) */ double precision 在 PostgreSQL 中，double precision是一种不精确的、可变精度的数值类型。 不精确意味着 PostgreSQL 无法将某些值精确地转换为内部格式，只能将它们存储为近似值。因此，存储和查询的值可能会出现细微的差异。 如果应用程序需要精确的存储和计算，建议改用 numeric 类型。 CREATE TABLE temperatures ( id SERIAL PRIMARY KEY, location TEXT NOT NULL, temperature DOUBLE PRECISION ); INSERT INTO temperatures (location, temperature) VALUES ('Lab Room 1', 23.5), ('Server Room 1', 21.8), ('Server Room 2', 24.3) RETURNING *; /* id | location | temperature ----+---------------+------------- 1 | Lab Room 1 | 23.5 2 | Server Room 1 | 21.8 3 | Server Room 2 | 24.3 (3 rows) */ SELECT AVG(temperature) FROM temperatures; /* avg ------ 23.2 */ 存储不精确的数值。 CREATE TABLE t(c double precision); INSERT INTO t(c) VALUES(0.1), (0.1), (0.1) RETURNING *; SELECT SUM(c) FROM t; -- 输出表示0.1、0.1和0.1的和不是0.3，而是0.30000000000000004。 -- 这表明 PostgreSQL 不能使用double precision类型来存储确切的数字0.1。 /* sum --------------------- 0.30000000000000004 (1 row) */ 插入过小的数字。 INSERT INTO t(c) VALUES (1E-400); -- 原因是这个数字太小，非常接近于零。 -- 由于 double precision 类型的限制，PostgreSQL 无法存储它。 /* ERROR: \"0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001\" is out of range for type double precision */ 序列类型 smallserial、serial和bigserial类型不是真正的类型，它们只是为了创建唯一标识符列而存在的方便符号（类似其它一些数据库中支持的AUTO_INCREMENT属性）。 CREATE TABLE tablename ( colname SERIAL ); -- 等价于以下语句： CREATE SEQUENCE tablename_colname_seq AS integer; CREATE TABLE tablename ( colname integer NOT NULL DEFAULT nextval('tablename_colname_seq') ); ALTER SEQUENCE tablename_colname_seq OWNED BY tablename.colname; 因此，我们就创建了一个整数列并且把它的缺省值安排为从一个序列发生器取值。 应用了一个NOT NULL约束以确保空值不会被插入（在大多数情况下你可能还希望附加一个UNIQUE或者PRIMARY KEY约束避免意外地插入重复的值，但这个不是自动发生的）。 最后，该序列被标记为“属于”该列，这样当列或表被删除时该序列也会被删除。 CREATE TABLE t02 ( id SERIAL, a varchar(11) NOT NULL ); INSERT INTO t02(a) VALUES ('asdasd'); INSERT INTO t02(a) VALUES ('asdasd01'); 货币类型 money类型存储固定小数精度的货币数字。可接受的输入格式很多，包括整数和浮点数文字，以及常用的货币格式，如’$1,000.00’。 名字 存储尺寸 描述 范围 money 8 bytes 货币额 -92233720368547758.08到+92233720368547758.07 由于这种数据类型的输出是区域敏感的，因此将money数据装入到一个具有不同lc_monetary设置的数据库是不起作用的。为了避免这种问题，在恢复一个转储到一个新数据库中之前，应确保新数据库的lc_monetary设置和被转储数据库的相同或者具有等效值。 数据类型numeric、int和bigint的值可以被造型成money。从数据类型real和double precision的转换可以通过先造型成numeric来实现，例如： 但是，我们不推荐这样做。浮点数不应该被用来处理货币，因为浮点数可能会有圆整错误。 postgres=\u003e SELECT '12.34'::float8::numeric::money; money -------- $12.34 (1 row) 一个money值可以在不损失精度的情况下被造型成numeric。转换到其他类型可能会丢失精度，并且必须采用两个阶段完成： 一个money值被一个整数值除的除法结果会被截去分数部分。 postgres=\u003e SELECT '52093.89'::money::numeric::float8; float8 ---------- 52093.89 (1 row) 使用示例。 CREATE TABLE financials ( id SERIAL PRIMARY KEY, amount money ); INSERT INTO financials (amount) VALUES ('12345.67'), -- 正常金额 ('-12345.67'), -- 负金额 ('9999999999999999.99'); -- 接近最大值 -- 查询所有记录 SELECT * FROM financials; /* Output： id | amount ----+--------------------------- 1 | $12,345.67 2 | -$12,345.67 3 | $9,999,999,999,999,999.99 (3 rows) */ -- 查询金额总和 SELECT SUM(amount) FROM financials; /* Output： sum --------------------------- $9,999,999,999,999,999.99 (1 row) */ 注意：默认的货币符号为$，货币符号由lc_monetary设置决定。 postgres=\u003e show lc_monetary; lc_monetary ------------- C (1 row) 修改货币符号。 修改 postgresql.conf 配置文件参数 lc_monetary。 或者 ALTER 修改，或set lc_monetary='zh_CN.UTF-8'。 可能 PostgreSQL 不支持 zh_CN.UTF-8 区域，通过sql查看支持区域。 SELECT * FROM pg_catalog.pg_collation; 布尔类型 名字 存储字节 描述 boolean 1字节 状态为真或假 PostgreSQL 对布尔值的处理非常灵活，true, 'true', 't', 'yes', 'y', '1'都被视为真，false, 'false', 'f', 'no', 'n', '0'都被视为假。注意，这里所有的值不区分大小写。除了 true 和 false，其他的都是字符类型。 PostgreSQL 布尔类型允许 NULL 值。BOOLEAN 可以简写为 BOOL。 请注意，在 SQL 标准中，一个布尔值只接受 TRUE，FALSE，和 NULL（表示未知unknown）。前导或尾随空格并不重要，并且除true和false之外的所有常量值都必须用单引号引起来。 -- 设置默认值 is_ok BOOL DEFAULT 't' CREATE TABLE test_boolean ( v VARCHAR NOT NULL, b BOOLEAN NOT NULL ); INSERT INTO test_boolean (v, b) VALUES (TRUE, TRUE), (FALSE, FALSE), ('t', 't'), ('f', 'f'), ('T', 'T'), ('F', 'F'), ('1', '1'), ('0', '0'), ('y', 'y'), ('n', 'n'), ('Y', 'Y'), ('N', 'N'), ('yes', 'yes'), ('no', 'no'), ('YES', 'YES'), ('NO', 'NO') RETURNING *; /* Output： v | b --------+--- true | t false | f t | t f | f T | t F | f 1 | t 0 | f y | t n | f Y | t N | f yes | t no | f YES | t NO | f (16 rows) */ SELECT * FROM test_boolean WHERE b = 'Y'; /* Output： v | b ------+--- true | t t | t T | t 1 | t y | t Y | t yes | t YES | t (8 rows) */ 操作符 常用的逻辑操作符有：AND、OR、NOT。 a b a AND b a OR b TRUE NULL NULL TRUE FALSE NULL FALSE NULL NULL NULL NULL NULL 常用比较符 IS。 expression IS TRUE; expression IS FALSE; expression IS UNKNOWN; 示例。 SELECT * FROM test_boolean WHERE b IS TRUE; SELECT * FROM test_boolean WHERE b; /* v | b ------+--- true | t t | t T | t 1 | t y | t Y | t yes | t YES | t (8 rows) */ SELECT * FROM test_boolean WHERE b IS FALSE; SELECT * FROM test_boolean WHERE NOT b; /* v | b -------+--- false | f f | f F | f 0 | f n | f N | f no | f NO | f (8 rows) */ SELECT * FROM test_boolean WHERE b IS UNKNOWN; SELECT * FROM test_boolean WHERE b IS NULL; /* v | b ---+--- (0 rows) */ SELECT (1\u003e2) IS UNKNOWN; /* ?column? ---------- f (1 row) */ SELECT NULL IS UNKNOWN; /* ?column? ---------- t (1 row) */ SELECT 'yes'::boolean; /* bool ------ t (1 row) */ UUID类型 这种标识符是一个128位的量，它由一个精心选择的算法产生，该算法能保证在已知空间中任何其他使用相同算法的人能够产生同一个标识符的可能性非常非常小。因此，对于分布式系统，这些标识符相比序列生成器而言提供了一种很好的唯一性保障，序列生成器只能在一个数据库中保证唯一。 一个UUID被写成一个小写十六进制位的序列，该序列被连字符分隔成多个组：首先是一个8位组，接下来是三个4位组，最后是一个12位组。总共的32位（十六进制位）表示了128个二进制位。一个标准形式的UUID类似于： a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11 PostgreSQL也接受另一种输入形式： 使用大写位、标准格式被花括号包围、忽略某些或者全部连字符、在任意4位组后面增加一个连字符。例如： A0EEBC99-9C0B-4EF8-BB6D-6BB9BD380A11 {a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11} a0eebc999c0b4ef8bb6d6bb9bd380a11 a0ee-bc99-9c0b-4ef8-bb6d-6bb9-bd38-0a11 {a0eebc99-9c0b4ef8-bb6d6bb9-bd380a11} 要在 PostgreSQL 中生成 UUID，请使用 gen_random_uuid() 函数，如下： -- gen_random_uuid() 根据随机数生成 uuid -- 如果想根据 MAC 地址生成 uuid，安装 uuid-ossp 模块 SELECT gen_random_uuid(); /* Output： gen_random_uuid -------------------------------------- 226199a2-b0c7-4ca6-a4f4-b4b31fba2a64 (1 row) */ CREATE TABLE fruits ( id UUID DEFAULT gen_random_uuid() PRIMARY KEY, name VARCHAR NOT NULL ); INSERT INTO fruits (name) VALUES ('Apple'), ('Peach'), ('Banana') RETURNING *; /* Output： id | name --------------------------------------+-------- c7f32415-d35e-4f57-8496-7978f422ff6a | Apple c82ab208-4520-424f-a225-131d7a91eadf | Peach 2c53ece8-440f-4374-8cb0-b7a5826a62f8 | Banana (3 rows) */ uuid-ossp 模块 PostgreSQL 允许您存储和比较 UUID 值，但它的核心不包含用于生成 UUID 值的函数。 相反，它依赖于提供特定算法来生成 UUID 的第三方模块。例如，uuid-ossp模块提供了一些方便的函数来实现生成 UUID 的标准算法。 要安装uuid-ossp模块，请使用如下 CREATE EXTENSION 语句： -- IF NOT EXISTS子句允许您避免重新安装模块 -- 操作账户需要相关权限 CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\"; uuid-ossp 模块函数参考 要根据计算机的 MAC 地址、当前时间戳和随机值的组合生成 UUID 值，请使用以下uuid_generate_v1()函数： postgres=# SELECT uuid_generate_v1(); uuid_generate_v1 -------------------------------------- 7f13869e-7bb3-11ef-9b7a-0242ac140002 (1 row) 如果您想仅根据随机数生成 UUID 值，可以使用uuid_generate_v4()函数。例如： postgres=# SELECT uuid_generate_v4(); uuid_generate_v4 -------------------------------------- dfde1e70-6afe-443e-9a06-40011a86ff17 (1 row) 使用示例。 CREATE TABLE contacts ( contact_id uuid DEFAULT uuid_generate_v4 (), first_name VARCHAR NOT NULL, last_name VARCHAR NOT NULL, email VARCHAR NOT NULL, phone VARCHAR, PRIMARY KEY (contact_id) ); INSERT INTO contacts ( first_name, last_name, email, phone ) VALUES ( 'AD', 'S2ith', '3j3ohi5th@example.com', '418-267-5432' ), ( 'KD', 'SC1h', '3ji.5th@example.com', '408-212-2673' ), ( 'EC', 'dsw32', 'a2x.sm@example.com', '408-243-2653' ); postgres=\u003e SELECT * FROM my_schema.contacts; contact_id | first_name | last_name | email | phone --------------------------------------+------------+-----------+-----------------------+-------------- 98fafd47-7319-4ba6-9ff4-dd8c8fe2aeb8 | AD | S2ith | 3j3ohi5th@example.com | 418-267-5432 5a83c3a8-42de-4f4a-84d0-7d00232fa250 | KD | SC1h | 3ji.5th@example.com | 408-212-2673 56546027-f971-4ee4-b251-1eb1af74fbff | EC | dsw32 | a2x.sm@example.com | 408-243-2653 (3 rows) 字符类型 字符类型以文本形式存储数据，PostgreSQL 提供了三种字符数据类型：CHAR，VARCHAR，和 TEXT。 ———————— 名字 ———————— 描述 character varying(n), varchar(n) 有限制的变长 character(n), char(n) 定长，空格填充 text 无限变长 下面说明了 PostgreSQL 中的三种字符类型的用法： CHAR(n) 存储固定长度的字符串，长度不足时，使用空白填充。 VARCHAR(n) 存储具有长度限制的可变长度文本。 VARCHAR 存储没有长度限制的可变长度文本。 它与 TEXT 完全相同。 TEXT 存储没有长度限制的可变长度文本。 CHAR(n) 和 VARCHAR(n) 最多可存储 n 字符。VARCHAR 与 TEXT 完全相同。 对于限制了长度的字符类型来说，如果写入的内容超过了限制的长度，PostgreSQL 采用如下的策略： 如果超出长度的部分只有空格，则多余的空格会被截断。 如果超出长度的部分不只是空格，则给出错误提示。 CREATE TABLE test_character_type ( char_1 CHAR(1), varchar_10 VARCHAR(10), txt TEXT ); CHAR CHAR 类型使用示例。 -- 因为该 char_1 列的数据类型是 CHAR(1)，我们试图在该列中插入一个包含 2 个字符的字符串: 'OK'。 INSERT INTO test_character_type (char_1) VALUES ('OK') RETURNING *; -- ERROR: value too long for type character(1) -- 使用下面的语句向表中插入一个新行超出 char_1 列长度的值，超出的部分为空格 INSERT INTO test_character_type (char_1) VALUES ('好 ') RETURNING *; -- 这里插入成功了。这是因为超出的部分是空格，PostgreSQL 自动截断了空格。 /* Output： char_1 | varchar_10 | txt --------+------------+----- 好 | (NULL) | (NULL) */ VARCHAR VARCHAR 类型使用示例。 -- 使用下面的语句向表中插入一个新行超出 varchar_10 列长度的值 INSERT INTO test_character_type (varchar_10) VALUES ('Hello World') RETURNING *; -- 这是因为该 varchar_10 列的数据类型是 VARCHAR(10)，我们试图在该列中插入一个包含 11 个字符的字符串: 'Hello World'。 -- ERROR: value too long for type character varying(10) -- 使用下面的语句向表中插入一个新行超出 varchar_10 列长度的值，超出的部分为空格 INSERT INTO test_character_type (varchar_10) VALUES ('HelloWor好d ') RETURNING *; -- 这里插入成功了。这是因为超出的部分是空格，PostgreSQL 自动截断了空格 /* Output： char_1 | varchar_10 | txt --------+-------------+----- (NULL) | HelloWor好d | (NULL) (1 row) */ TEXT 使用下面的语句向表中插入一个新行。 INSERT INTO test_character_type (txt) VALUES ('TEXT column can store 你好 a string of any length') RETURNING txt; /* Output： txt ---------------------------------------------- TEXT column can store 你好 a string of any length (1 row) */ 日期/时间类型 名字 存储尺寸 描述 最小值 最大值 解析度 timestamp [ (p) ] [ without time zone ] 8字节 包括日期和时间（无时区） 4713 BC 294276 AD 1微秒 timestamp [ (p) ] with time zone 8字节 包括日期和时间，有时区 4713 BC 294276 AD 1微秒 date 4字节 日期（没有一天中的时间） 4713 BC 5874897 AD 1日 time [ (p) ] [ without time zone ] 8字节 一天中的时间（无日期） 00:00:00 24:00:00 1微秒 time [ (p) ] with time zone 12字节 仅仅是一天中的时间（没有日期），带有时区 00:00:00+1459 24:00:00-1459 1微秒 interval [ fields ] [ (p) ] 16字节 时间间隔 -178000000年 178000000年 1微秒 DATE 创建一个新表，名称为 test_date。 这是一个整数类型的列，被定义为自增主键。每当有新记录插入到表中时，如果没有为 id 指定值，数据库会自动为它分配下一个可用的整数值。 这是一个日期类型的列，默认值是当前日期(CURRENT_DATE)，并且不允许为空。 CREATE TABLE test_date ( id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, date_value DATE NOT NULL DEFAULT CURRENT_DATE ); 要将数据插入 DATE 列，您必须确保数据采用 yyyy-mm-dd 格式。 INSERT INTO test_date (date_value) VALUES ('2022-08-29'), ('2022-08-30'), ('2022-08-31') RETURNING *; /* Output： id | date_value ----+------------ 1 | 2022-08-29 2 | 2022-08-30 3 | 2022-08-31 (3 rows) */ 要更新 DATE 数据，使用该 UPDATE 语句并传入一个 yyyy-mm-dd 格式的值。 UPDATE test_date SET date_value = '2022-09-01' WHERE id = 3 RETURNING *; /* Output： id | date_value ----+------------ 3 | 2022-09-01 (1 row) */ 查找日期为 2022-08-30，请使用以下语句： SELECT * FROM test_date WHERE date_value = '2022-08-30'; /* Output： id | date_value ----+------------ 2 | 2022-08-30 (1 row) */ 查找日期小于 2022-09-01 的所有的行，如下： SELECT * FROM test_date WHERE date_value \u003c '2022-09-01'; /* Output： id | date_value ----+------------ 1 | 2022-08-29 2 | 2022-08-30 (2 rows) */ PostgreSQL 提供了 TO_CHAR() 函数以按照指定格式输出日期值。 TO_CHAR() 函数接受两个参数。第一个参数是要格式化的日期值，第二个参数是格式。要以 yyyy/mm/dd 格式显示日期，请使用以下语句： SELECT id, to_char(date_value, 'yyyy/mm/dd') FROM test_date; /* Output： id | to_char ----+------------ 1 | 2022/08/29 2 | 2022/08/30 3 | 2022/09/01 (3 rows) */ 日期相关函数。 -- 获取当前日期，使用 current_date，结果的格式为：yyyy-mm-dd SELECT NOW()::date; SELECT current_date; /* Output： current_date -------------- 2023-09-24 */ -- 要以特定格式输出日期值，可以使用TO_CHAR()函数。 -- 该TO_CHAR()函数接受两个参数。第一个参数是要格式化的值，第二个参数是定义输出格式的模板。 SELECT TO_CHAR(NOW() :: DATE, 'dd/mm/yyyy'); /* to_char ------------ 23/06/2023 (1 row) */ SELECT TO_CHAR(NOW() :: DATE, 'Mon dd, yyyy'); /* to_char -------------- Sep 26, 2023 (1 row) */ -- 指定格式的日期字符串转为日期值，使用 to_date() 函数 SELECT to_date('2022-09-30', 'YYYY-MM-DD'); /* Output: to_date ------------ 2022-09-30 */ -- 获取两个日期之间的间隔 SELECT first_name, last_name, now() - hire_date as diff FROM employees; /* first_name | last_name | diff ------------+-----------+--------------------------- Shannon | Freeman | 4191 days 08:25:30.634458 Sheila | Wells | 4922 days 08:25:30.634458 Ethel | Webb | 5652 days 08:25:30.634458 (3 rows) */ -- 获取日期值中的年、月、日部分，使用 date_part() 函数 SELECT date_part('year', current_date) \"year\", date_part('month', current_date) \"month\", date_part('day', current_date) \"day\"; /* Output： year | month | day ------+-------+----- 2023 | 9 | 24 */ -- 计算年龄（年、月、日） -- 要计算相对于当前日期的年龄（以年、月和日为单位），请使用AGE()函数。 SELECT employee_id, first_name, last_name, AGE(birth_date) FROM employees; /* employee_id | first_name | last_name | age -------------+------------+-----------+------------------------- 1 | Shannon | Freeman | 36 years 5 mons 22 days 2 | Sheila | Wells | 38 years 4 mons 18 days 3 | Ethel | Webb | 41 years 5 mons 22 days (3 rows) */ -- 如果将日期值传递给AGE()函数，它将从当前日期中减去该日期值。如果将两个参数传递给AGE()函数，它将从第一个参数中减去第二个参数。 SELECT employee_id, first_name, last_name, age('2015-01-01',birth_date) FROM employees; /* employee_id | first_name | last_name | age -------------+------------+-----------+-------------------------- 1 | Shannon | Freeman | 35 years 2 | Sheila | Wells | 36 years 10 mons 24 days 3 | Ethel | Webb | 40 years (3 rows) */ -- 要从日期值获取年、季度、月、周、日，可以使用EXTRACT()函数。 SELECT employee_id, first_name, last_name, EXTRACT (YEAR FROM birth_date) AS YEAR, EXTRACT (MONTH FROM birth_date) AS MONTH, EXTRACT (DAY FROM birth_date) AS DAY FROM employees; /* employee_id | first_name | last_name | year | month | day -------------+------------+-----------+------+-------+----- 1 | Shannon | Freeman | 1980 | 1 | 1 2 | Sheila | Wells | 1978 | 2 | 5 3 | Ethel | Webb | 1975 | 1 | 1 (3 rows) */ TIMESTAMP PostgreSQL 时间戳类型用来存储日期和时间组合的数据类型。PostgreSQL 支持两种类型的时间戳数据类型，包括 TIMESTAMP 和 TIMESTAMPTZ： TIMESTAMP 全写为：TIMESTAMP WITHOUT TIME ZONE，用来存储没有时区的时间戳。 TIMESTAMPTZ 全写为：TIMESTAMP WITH TIME ZONE，用来存储带时区的时间戳。 TIMESTAMP 和 TIMESTAMPTZ 都使用 8 个字节来存储时间戳值。 在 PostgreSQL 内部，TIMESTAMPTZ 类型的值被存储为它对应的 UTC 值。当您从数据库中查询 TIMESTAMPTZ 值时，PostgreSQL 会将 UTC 值转换回数据库服务器、用户或当前数据库连接设置的时区的时间值。PostgreSQL 以 UTC 值存储timestamptz。 当您向timestamptz列中插入值时，PostgreSQL 会将该timestamptz值转换为 UTC 值并将该 UTC 值存储在表中。 当您从数据库查询timestamptz值时，PostgreSQL 会将 UTC 值转换回数据库服务器、用户或当前数据库连接设置的时区的时间值。 创建一个新表，名称为 test_timestamp。 id 列是标识每行的主键列，它是一个标识列。 该 timestamp_v 列是不带时区的时间戳类型，它不能为 null，并且默认为由 now() 函数产生的当前时间。 该 timestamptz_v 列是带时区的时间戳类型，它不能为 null，并且默认为由 now() 函数产生的当前时间。 CREATE TABLE test_timestamp ( id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, timestamp_v TIMESTAMP NOT NULL DEFAULT now(), timestamptz_v TIMESTAMPTZ NOT NULL DEFAULT now() ); INSERT INTO test_timestamp (timestamp_v, timestamptz_v) VALUES ('2022-08-30 10:10:10', '2022-08-30 10:10:10'), ('2022-08-30', '2022-08-30') RETURNING *; /* Output： id | timestamp_v | timestamptz_v ----+---------------------+------------------------ 1 | 2022-08-30 10:10:10 | 2022-08-30 10:10:10+08 2 | 2022-08-30 00:00:00 | 2022-08-30 00:00:00+08 (2 rows) */ 您不能为时间戳类型指定一个时间类型的值，PostgreSQL 将会给出一个错误。 INSERT INTO test_timestamp (timestamp_v, timestamptz_v) VALUES ('10:10:10', '10:10:10') RETURNING *; /* Output： ERROR: invalid input syntax for type timestamp: \"10:10:10\" LINE 2: VALUES ('10:10:10', '10:10:10') */ 要更新 TIMESTAMP 数据，使用该 UPDATE 语句并传入一个正确格式的值。 UPDATE test_timestamp SET timestamp_v = '2022-08-30 11:11:11', timestamptz_v = '2022-08-30 11:11:11' WHERE id = 1 RETURNING *; /* Output： id | timestamp_v | timestamptz_v ----+---------------------+------------------------ 1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08 (1 row) */ 查找日期为 2022-08-30 的所有的行，如下： SELECT * FROM test_timestamp WHERE to_char(timestamp_v, 'YYYY-MM-DD') = '2022-08-30'; /* Output： id | timestamp_v | timestamptz_v ----+---------------------+------------------------ 2 | 2022-08-30 00:00:00 | 2022-08-30 00:00:00+08 1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08 (2 rows) */ 查找日期大于 2022-08-30 的所有的行，如下： SELECT * FROM test_timestamp WHERE timestamp_v \u003e '2022-08-30'; /* Output： id | timestamp_v | timestamptz_v ----+---------------------+------------------------ 1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08 (1 row) */ 以 yyyy/mm/dd 格式显示时间，请使用以下语句： SELECT id, to_char(timestamp_v, 'YYYY/MM/DD HH24:MI:SS'), to_char(timestamptz_v, 'YYYY/MM/DD HH24:MI:SS TZH') FROM test_timestamp; /* Output： id | to_char | to_char ----+---------------------+------------------------- 2 | 2022/08/30 00:00:00 | 2022/08/30 00:00:00 +08 1 | 2022/08/30 11:11:11 | 2022/08/30 11:11:11 +08 (2 rows) */ 时间戳相关函数。 -- 获取当前时间戳，请使用 now() 或者 current_timestamp -- 除此之外，您还可以使用 transaction_timestamp(), statement_timestamp(), localimestamp(), 或 clock_timestamp() 获取当前的时间戳。 SELECT now(), current_timestamp; /* Output： now | current_timestamp -------------------------------+------------------------------- 2024-09-25 12:30:58.789316+08 | 2024-09-25 12:30:58.789316+08 (1 row) */ -- 使用 current_timestamp 指定时间戳的小数秒精度 SELECT current_timestamp, current_timestamp(2); /* Output： current_timestamp | current_timestamp -------------------------------+--------------------------- 2024-09-25 12:32:04.488063+08 | 2024-09-25 12:32:04.49+08 (1 row) */ -- 获取时间值中的年、月、日、时、分、秒的值，请使用 date_part() 函数 SELECT date_part('year', now()) \"year\", date_part('month', now()) \"month\", date_part('day', now()) \"day\", date_part('hour', now()) \"hour\", date_part('minute', now()) \"minute\", date_part('second', now()) \"second\"; /* Output： year | month | day | hour | minute | second ------+-------+-----+------+--------+----------- 2024 | 9 | 25 | 12 | 32 | 54.977147 (1 row) */ 更多参考：https://www.rockdata.net/zh-cn/tutorial/type-timestamp/ TIME PostgreSQL 支持 TIME 数据类型，以存储时间值。 PostgreSQL 存储 TIME 数据类型值使用 8 个字节。TIME 数据类型允许的范围是从 00:00:00 到 24:00:00。 TIME 数据类型采用以下格式存储：HH:MI:SS.ssssss HH 表示小时 MI 表示分钟 SS 表示秒 ssssss 表示小数秒 枚举类型 在 PostgreSQL 中，枚举类型是是一组有序的常量值的集合。比如，您可以使用枚举类型用作订单的状态值。 如果没有枚举类型，您可能使用整数 1, 2, 3 … 或者字符串表示，但是很容易带来错误，比如书写错误等。用了枚举类型之后，数据库可以保证不能输入错误的值。 枚举标签是大小写敏感的，因此’happy’与’HAPPY’是不同的。标签中的空格也是有意义的。 要使用枚举值，您需要使用 CREATE TYPE 语句创建一个自定义的枚举值。 name 是要创建的枚举类型的名称。 label 是枚举类型中的常量值。 shoping=\u003e \\h CREATE TYPE Command: CREATE TYPE Description: define a new data type Syntax: CREATE TYPE name AS ENUM ( [ 'label' [, ... ] ] ) URL: https://www.postgresql.org/docs/14/sql-createtype.html 创建一个表示星期的枚举类型。 CREATE TYPE my_week AS ENUM ( 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday' ); -- 创建一个销售表 CREATE TABLE week_day_sales ( id integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY, week_day my_week NOT NULL, sales integer NOT NULL ); -- 插入数据 INSERT INTO week_day_sales (week_day, sales) VALUES ('Monday', 110), ('Tuesday', 120), ('Wednesday', 130), ('Thursday', 140), ('Friday', 150), ('Saturday', 160), ('Sunday', 170), ('Monday', 210), ('Tuesday', 220), ('Wednesday', 230), ('Thursday', 240), ('Friday', 250), ('Saturday', 260), ('Sunday', 270); 向枚举列插入一个错误的值，PostgreSQL 将给出一个错误： INSERT INTO week_day_sales (week_day, sales) VALUES ('Error', 110); -- ERROR: invalid input value for enum my_week: \"Error\" -- LINE 2: VALUES ('Error', 110); 检索 week_day_sales 表的所有的行。 SELECT * FROM week_day_sales; /* Output： id | week_day | sales ----+-----------+------- 1 | Monday | 110 2 | Tuesday | 120 3 | Wednesday | 130 4 | Thursday | 140 5 | Friday | 150 6 | Saturday | 160 7 | Sunday | 170 8 | Monday | 210 9 | Tuesday | 220 10 | Wednesday | 230 11 | Thursday | 240 12 | Friday | 250 13 | Saturday | 260 14 | Sunday | 270 (14 rows) */ 按照枚举类型的值的顺序排序，请使用下面的语句。 SELECT * FROM week_day_sales ORDER BY week_day; /* Output： id | week_day | sales ----+-----------+------- 1 | Monday | 110 8 | Monday | 210 2 | Tuesday | 120 9 | Tuesday | 220 3 | Wednesday | 130 10 | Wednesday | 230 4 | Thursday | 140 11 | Thursday | 240 5 | Friday | 150 12 | Friday | 250 6 | Saturday | 160 13 | Saturday | 260 7 | Sunday | 170 14 | Sunday | 270 (14 rows) */ PostgreSQL 提供了几个用于枚举类型的函数： enum_first() 函数返回由参数指定的枚举类型的第一个枚举值。 enum_last() 函数返回由参数指定的枚举类型的最后一个枚举值。 enum_range() 函数返回由参数指定的枚举类型的所有枚举值，或者指定的范围内的枚举值。 网络地址类型 PostgreSQL提供用于存储 IPv4、IPv6 和 MAC 地址的数据类型。用这些数据类型存储网络地址比用纯文本类型好，因为这些类型提供输入错误检查以及特殊的操作符和函数。 INET：用于存储 IPv4 和 IPv6 网络地址，使用无类别域间路由（CIDR）表示法。它只存储网络地址和子网掩码，不存储主机部分。 CIDR：用于存储 IPv4 和 IPv6 主机地址以及网络地址。它既可以存储单个 IP 地址，也可以存储带有子网掩码的 IP 地址和网络。 MACADDR：用于存储媒体访问控制（MAC）地址，通常是 48 位的以太网地址。 MACADDR8：用于存储扩展的唯一标识符（EUI-64）格式的 MAC 地址，这通常用于 IPv6 的链路本地地址。（在 PostgreSQL 10 及以后版本中引入） 名字 存储尺寸 描述 cidr 7或19字节 IPv4和IPv6网络 inet 7或19字节 IPv4和IPv6主机以及网络 macaddr 6字节 MAC地址 macaddr8 8 bytes MAC地址（EUI-64格式） 在对inet或者cidr数据类型进行排序的时候，IPv4 地址将总是排在 IPv6 地址前面，包括那些封装或者是映射在 IPv6 地址里 的 IPv4 地址，例如 ::10.2.3.4 或者 ::ffff::10.4.3.2。 使用示例： -- 创建一个新表以演示网络类型 CREATE TABLE network_examples ( id SERIAL PRIMARY KEY, ipv4_cidr cidr, ipv6_cidr cidr, ipv4_inet inet, ipv6_inet inet, mac_address macaddr, mac_address_eui64 macaddr8 ); -- 插入示例数据 INSERT INTO network_examples ( ipv4_cidr, ipv6_cidr, ipv4_inet, ipv6_inet, mac_address, mac_address_eui64 ) VALUES ( '192.168.1.0/24', '2001:db8::/32', '192.168.1.5', '2001:db8::1', '08:00:2b:01:02:03', '00:1A:2B:3C:4D:5E:00:1A' ); -- 查询并显示插入的数据 SELECT * FROM network_examples; /* Output： id | ipv4_cidr | ipv6_cidr | ipv4_inet | ipv6_inet | mac_address | mac_address_eui64 ----+----------------+---------------+-------------+-------------+-------------------+------------------------- 1 | 192.168.1.0/24 | 2001:db8::/32 | 192.168.1.5 | 2001:db8::1 | 08:00:2b:01:02:03 | 00:1a:2b:3c:4d:5e:00:1a (1 row) */ 几何类型 几何数据类型表示二维的空间物体。 PostgreSQL 有一系列丰富的函数和操作符可用来进行各种几何操作， 如缩放、平移、旋转和计算相交等。 名字 存储尺寸 表示 描述 point 16字节 平面上的点 (x,y) line 32字节 无限长的线 {A,B,C} lseg 32字节 有限线段 ((x1,y1),(x2,y2)) box 32字节 矩形框 ((x1,y1),(x2,y2)) path 16+16n字节 封闭路径（类似于多边形） ((x1,y1),…) path 16+16n字节 开放路径 [(x1,y1),…] polygon 40+16n字节 多边形（类似于封闭路径） ((x1,y1),…) circle 24字节 圆 \u003c(x,y),r\u003e（中心点和半径） 点 点是几何类型的基本二维构造块。用下面的语法描述point类型的值：(x , y)，其中x和y分别是坐标，都是浮点数。 线 线由线性方程Ax + By + C = 0 表示，其中A和B都不为零。类型line 的值采用以下形式输入和输出：{A, B, C}。 另外，还可以用下列任一形式输入：其中(x1,y1)和(x2,y2)是线上不同的两点。 [ ( x1 , y1 ) , ( x2 , y2 ) ] 线段 线段用一对线段的端点来表示。lseg类型的值用下面的语法声明：其中(x1,y1)和(x2,y2)是线段的端点。 [ ( x1 , y1 ) , ( x2 , y2 ) ] 方框 方框用其对角的点对表示。box类型的值使用下面的语法指定：其中(x1,y1)和(x2,y2)是方框的对角点。 ( ( x1 , y1 ) , ( x2 , y2 ) ) 在输入时可以提供任意两个对角，但是值将根据需要被按顺序记录为右上角和左下角。 路径 路径由一系列连接的点组成。路径可能是开放的，也就是认为列表中第一个点和最后一个点没有被连接起来；也可能是封闭的，这时认为第一个和最后一个点被连接起来。 path类型的值用下面的语法声明： [ ( x1 , y1 ) , ... , ( xn , yn ) ] 其中的点是组成路径的线段的端点。方括弧（[]）表示一个开放的路径，圆括弧（()）表示一个封闭的路径。如第三种到第五种语法所示，当最外面的圆括号被忽略时，路径将被假定为封闭。 多边形 多边形由一系列点代表（多边形的顶点）。多边形和封闭路径很像，但是存储方式不一样而且有自己的一套支持例程。 polygon类型的值用下列语法声明：其中的点是组成多边形边界的线段的端点。 ( ( x1 , y1 ) , ... , ( xn , yn ) ) 圆 圆由一个圆心和一个半径代表。circle类型的值用下面的语法指定：其中(x,y)是圆心，而r是圆的半径。 \u003c ( x , y ) , r \u003e 示例 创建 geometric_types 表： CREATE TABLE geometric_types ( id SERIAL PRIMARY KEY, point_value point, line_value line, lseg_value lseg, box_value box, closed_path_value path, open_path_value path, polygon_value polygon, circle_value circle ); INSERT INTO geometric_types ( point_value, line_value, lseg_value, box_value, closed_path_value, open_path_value, polygon_value, circle_value ) VALUES ( '(10, 20)', -- 点 '{2,1,1}', -- 无限长的线 '[(0,0),(10,10)]', -- 有限线段 '((0,0),(10,10))', -- 矩形框 '((0,0),(10,0),(10,10),(0,10),(0,0))', -- 封闭路径 '[(0,0),(10,10)]', -- 开放路径 '((0,0),(10,0),(10,10),(0,10),(0,0))', -- 多边形 '\u003c(5,5),10\u003e' -- 圆 ); 查询数据： SELECT * FROM geometric_types; /* id | point_value | line_value | lseg_value | box_value | closed_path_value | open_path_value | polygon_value | circle_value ----+-------------+------------+-----------------+---------------+-------------------------------------+-----------------+-------------------------------------+-------------- 1 | (10,20) | {2,1,1} | [(0,0),(10,10)] | (10,10),(0,0) | ((0,0),(10,0),(10,10),(0,10),(0,0)) | [(0,0),(10,10)] | ((0,0),(10,0),(10,10),(0,10),(0,0)) | \u003c(5,5),10\u003e (1 row) */ 位串类型 位串就是一串 1 和 0 的串。它们可以用于存储和可视化位掩码。我们有两种类型的 SQL 位类型：bit(n) 和 bit varying(n)，其中n是一个正整数。 bit类型的数据必须准确匹配长度n; 试图存储短些或者长一些的位串都是错误的。bit varying数据是最长n的变长类型，更长的串会被拒绝。写一个没有长度的bit等效于 bit(1)，没有长度的bit varying意味着没有长度限制。 使用示例： CREATE TABLE test ( a BIT(3), -- 固定位数 3 bit b BIT VARYING(5) -- 边长位数，最大 5 bit ); INSERT INTO test VALUES (B'101', B'00'); -- ERROR: bit string length 2 does not match type bit(3) -- B'10' 有问题 INSERT INTO test VALUES (B'10', B'101'); INSERT INTO test VALUES (B'10'::bit(3), B'101'); SELECT * FROM test; /* Output： a | b -----+----- 101 | 00 100 | 101 (2 rows) */ 位串函数和运算符 位串运算符。 -- bit || bit → bit SELECT B'10001' || B'011'; -- 10001011 -- bit \u0026 bit → bit 按位 AND（输入的长度必须相等） SELECT B'10001' \u0026 B'01101'; -- 00001 -- bit | bit → bit 按位或（输入必须具有相同的长度） SELECT B'10001' | B'01101'; -- 11101 -- bit # bit → bit 按位异或（输入必须具有相同的长度） SELECT B'10001' # B'01101'; -- 11100 -- ~ bit → bit SELECT ~ B'10001'; -- 01110 -- bit \u003c\u003c integer → bit 按位左移（保留字符串长度） SELECT B'10001' \u003c\u003c 3; -- 01000 -- bit \u003e\u003e integer → bit 按位右移（保留字符串长度） SELECT B'10001' \u003e\u003e 2; -- 00100 位串函数。 -- bit_count ( bit ) → bigint 返回位串中设置的位数（也称为“popcount”） SELECT bit_count(B'10111'); -- 4 -- bit_length ( bit ) → integer 返回位串中的位数 SELECT bit_length(B'10111'); -- 5 -- length ( bit ) → integer 返回位串中的位数 SELECT length(B'10111'); -- 5 -- octet_length ( bit ) → integer 返回位串中的字节数 SELECT octet_length(B'1011111011'); -- 2 -- overlay ( bits bit PLACING newsubstring bit FROM start integer [ FOR count integer ] ) → bit -- 将 bits 中从第 start 位开始并扩展到 count 位的子字符串替换为 newsubstring。 -- 如果省略 count，则默认为 newsubstring 的长度。 SELECT overlay(B'01010101010101010' placing B'11111' from 2 for 3); -- 0111110101010101010 -- 01 010101010101010 -- 0111110101010101010 -- position ( substring bit IN bits bit ) → integer -- 返回 bits 内指定 substring 的第一个起始索引，如果不存在则返回零 SELECT position(B'010' in B'000001101011'); -- 8 -- 000001101011 -- 010 -- substring ( bits bit [ FROM start integer ] [ FOR count integer ] ) → bit -- 提取 bits 的子字符串，如果指定，则从第 start 位开始，并在 count 位之后停止（如果指定）。 -- 至少提供 start 和 count 之一。 SELECT substring(B'110010111111' from 3 for 2); -- 00 -- 110010111111 -- 00 -- get_bit ( bits bit , n integer ) → integer -- 从位串中提取 n 第位；第一个（最左边）位是位 0(下标从0开始)。 SELECT get_bit(B'101010101010101010', 6); -- 1 -- 101010101010101010 -- 1 -- set_bit ( bits bit , n integer , newvalue integer ) → bit -- 将位串中的 n 第 1 位设置为 newvalue ；第一个（最左边）位是位 0 SELECT set_bit(B'', 7, 0); -- 101010001010101010 -- 101010101010101010 -- 101010001010101010 类型转换。 SELECT 44::bit(10); -- 0000101100 SELECT 44::bit(3); -- 100 SELECT cast(-44 as bit(12)); -- 111111010100 SELECT '1110'::bit(4)::integer; -- 14 JSON JSON 是一种通用的、轻量级的数据传输格式，它可以表示复杂的、结构化的数据，但同时也易于阅读和编写。 PostgreSQL 从 9.2 版本开始支持原生 JSON 数据类型，并且提供了许多用于操作 JSON 数据的函数和运算符。 JSON 对象是一个键值对的组合。键是字符串类型的文本，值可以是上面定义的几种类型的任何一种。 对象、数组、字符串、数字、true、false、null PostgreSQL 支持两种 JSON 类型：JSON 和 JSONB。他们的处理效率不同。JSON 按文本保存输入数据，保留原始数据中的空格，重复键。JSONB 则按照二进制保存输入数据，他会删除没必要的空格以及重复的键。使用时不用再次解析。两者对重复键的处理都是保留最后一个键值对。效率的差别：json类型存储快，使用慢，jsonb类型存储稍慢，使用较快。但在操作上，二者是没有区别的。 要将一个字符串的 JSON 文本转为 JSON 类型的值，您可以使用如下两种方法： 使用 JSON() 构造函数将 JSON 文本转为 JSON 类型的值：json('[1, 2, 3]') 使用类型转换将 JSON 文本转为 JSON 类型的值：'{\"a\": [1, 2, 3]}'::json PostgreSQL 提供了几个用于 JSON 数据的操作符，如下：(json和jsonb都适用) -\u003e: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为 JSON 类型的值。 -»: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为文本。 #\u003e: 获取指定路径的值，返回值为 JSON 类型的值。 #»: 获取指定路径的值，返回值为文本。 JSON 使用示例：JSON 类型 CREATE TABLE my_schema.login_logs ( id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, detail JSON NOT NULL ); INSERT INTO my_schema.login_logs (detail) VALUES ('{ \"name\": \"Tom\", \"address\": {\"ip\": \"192.168.1.23\",\"country\": \"US\"}}'), ('{ \"name\": \"Tim\", \"address\": {\"ip\": \"192.168.1.24\",\"country\": \"US\"}}'), ('{ \"name\": \"Jim\", \"address\": {\"ip\": \"192.168.1.25\",\"country\": \"UK\"}}'); 查询JSON数据。 postgres=\u003e SELECT * FROM my_schema.login_logs; id | detail ----+--------------------------------------------------------------------- 1 | { \"name\": \"Tom\", \"address\": {\"ip\": \"192.168.1.23\",\"country\": \"US\"}} 2 | { \"name\": \"Tim\", \"address\": {\"ip\": \"192.168.1.24\",\"country\": \"US\"}} 3 | { \"name\": \"Jim\", \"address\": {\"ip\": \"192.168.1.25\",\"country\": \"UK\"}} (3 rows) 如果您想显示 JSON 对象内部的字段，请使用 -\u003e 和 -» 操作符。-\u003e 返回的值是 JSON 类型，-» 返回的值是文本类型。 postgres=\u003e SELECT detail -\u003e 'name' AS name_json, detail -\u003e\u003e 'name' AS name_text FROM login_logs; name_json | name_text -----------+----------- \"Tom\" | Tom \"Tim\" | Tim \"Jim\" | Jim (3 rows) 获取所有登陆用的国家和 IP，请使用下面的语句： postgres=\u003e SELECT detail -\u003e 'address' -\u003e\u003e 'country' as country, detail -\u003e 'address' -\u003e\u003e 'ip' as ip FROM login_logs; country | ip ---------+-------------- US | 192.168.1.23 US | 192.168.1.24 UK | 192.168.1.25 (3 rows) 您可以在 WHERE 子句中使用 JSON 运算符来过滤返回的行。 postgres=\u003e SELECT detail -\u003e\u003e 'name' AS name, detail -\u003e 'address' -\u003e\u003e 'country' AS country FROM login_logs WHERE detail -\u003e 'address' -\u003e\u003e 'country' = 'US'; name | country ------+--------- Tom | US Tim | US (2 rows) JSONB 使用示例：JSONB create table if not exists name_age ( info jsonb ); INSERT INTO name_age VALUES ('{\"id\":1,\"name\":\"张三\", \"age\":12}'); -- 在json查询结果里插入新的key值gender SELECT info||'{\"gender\":\"男\"}'::jsonb from name_age where (info-\u003e\u003e'id')::int4 = 1; /* ?column? ------------------------------------------------------ {\"id\": 1, \"age\": 12, \"name\": \"张三\", \"gender\": \"男\"} (1 row) */ Postgres里的查询需要用到查询符。比如说，我们要查询id为1的数据，语句如下： @\u003e 这个查询符，表明info当前这条记录里的顶层json中有没有id为1的key-value对；有的话则满足条件。 SELECT info from name_age WHERE info @\u003e '{\"id\":1}'::jsonb; /* info -------------------------------------- {\"id\": 1, \"age\": 12, \"name\": \"张三\"} (1 row) */ 查询 age\u003e16 的记录，并且只显示 name。 SELECT info -\u003e 'name' FROM name_age WHERE (info -\u003e 'age')::int4 \u003e 10; /* ?column? ---------- \"张三\" (1 row) */ 将 age 从 12 改为 22 ，SQL语句： SELECT info ||'{\"age\":22}'::jsonb from name_age where (info-\u003e\u003e'id')::int4 = 1; /* ?column? -------------------------------------- {\"id\": 1, \"age\": 22, \"name\": \"张三\"} (1 row) */ 删除age这个key，直接用操作符 - 即可。 SELECT info - 'age' FROM name_age WHERE (info -\u003e 'age')::int4 \u003e 10; /* ?column? --------------------------- {\"id\": 1, \"name\": \"张三\"} (1 row) */ ",
  "wordCount" : "4270",
  "inLanguage": "zh",
  "image": "https://heliu.site/favicon-32x32.png","datePublished": "2024-09-23T00:00:00Z",
  "dateModified": "2024-09-23T00:00:00Z",
  "author":[{
    "@type": "Person",
    "name": "helium"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://heliu.site/posts/postgresql/datatype/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Helium",
    "logo": {
      "@type": "ImageObject",
      "url": "https://heliu.site/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://heliu.site/" accesskey="h" title="Blog (Alt + H)">
                <img src="https://heliu.site/helium.png" alt="" aria-label="logo"
                    height="35">Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://heliu.site/" title="主页">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/posts" title="文章">
                    <span>Article</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/archives" title="时间轴">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/tags/" title="标签">
                    <span>Tag</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/search/" title="搜索 (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://heliu.site/support" title="打赏">
                    <span>🫶Help</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">


<article class="post" autonumbering>
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://heliu.site/">主页</a>&nbsp;»&nbsp;<a href="https://heliu.site/posts/">Article</a>&nbsp;»&nbsp;<a href="https://heliu.site/posts/postgresql/">PostgreSQL</a></div>
    <h1 class="post-title entry-hint-parent">
      数据类型
    </h1>
    <div class="post-description">
      💥本文章所有相关PostgreSQL 14版本。
    </div>
    <div class="post-meta">










<span class="x-post-meta-item"><svg t="1720837714681" class="icon" viewBox="0 0 1084 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7520" width="200" height="200"><path d="M123.47509 1023.984942a123.565437 123.565437 0 0 1-123.505206-123.32451V243.863302A123.565437 123.565437 0 0 1 123.47509 120.568908h171.630374V26.06529a26.050232 26.050232 0 0 1 52.070349 0v94.503618h377.592848V26.06529a26.050232 26.050232 0 0 1 52.100464 0v94.503618h183.797189A123.565437 123.565437 0 0 1 1084.171519 243.863302v656.79713A123.565437 123.565437 0 0 1 960.666314 1023.984942H123.47509z m-71.404741-123.32451A71.434857 71.434857 0 0 0 123.47509 971.974825h837.191224a71.434857 71.434857 0 0 0 71.404741-71.314393V442.326922l-946.361273-3.824716a25.598494 25.598494 0 0 1-5.84248-0.692665l-27.796953-6.444798v469.295689zM123.47509 172.579025a71.434857 71.434857 0 0 0-71.404741 71.284277v149.736133l27.796953-6.444797a26.080348 26.080348 0 0 1 5.902712-0.662549l946.301041 3.824716V243.863302a71.404741 71.404741 0 0 0-71.404741-71.284277h-180.183284l-6.173754 12.859479a26.200812 26.200812 0 0 1-23.490383 14.786895 26.261043 26.261043 0 0 1-23.520499-14.786895l-6.173754-12.859479H350.819834l-6.173754 12.859479a26.200812 26.200812 0 0 1-23.490383 14.786895 26.230928 26.230928 0 0 1-23.520499-14.786895l-6.173755-12.859479H123.47509z m156.150814 578.827128a26.050232 26.050232 0 0 1-26.050232-25.990001c0-14.335157 11.68496-26.020116 26.050232-26.020116h521.697312c14.365273 0 26.050232 11.68496 26.050233 26.020116a26.050232 26.050232 0 0 1-26.050233 25.990001H279.625904z" fill="#3D3F42" p-id="7521"></path></svg><span>2024-09-23</span></span>&nbsp;<span class="x-post-meta-item"><svg t="1720839329181" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14106" width="200" height="200"><path d="M699.270662 190.485379c-0.411369 0-0.821715 0.011256-1.227967 0.032746H507.034407a23.041786 23.041786 0 0 0-1.221828-0.031723c-12.779048 0-23.140023 10.359952-23.140023 23.139 0 12.781094 10.360975 23.141046 23.140023 23.141046v0.032746h193.458083v-0.032746c12.780071 0 23.141046-10.359952 23.141047-23.141046 0-12.780071-10.360975-23.140023-23.141047-23.140023zM979.215516 724.005508c0-142.090159-115.186416-257.277598-257.277598-257.277598-72.245418 0-137.532353 29.777187-184.262654 77.725223l45.868677 31.474852c36.227086-33.873482 84.882226-54.617945 138.393977-54.617945 111.945605 0 202.696492 90.750887 202.696492 202.695468h-43.01263l70.331835 104.289228 70.331835-104.289228H979.215516z" fill="" p-id="14107"></path><path d="M748.885664 588.843132c0-14.881942-12.06785-26.945699-26.947746-26.945698-14.883989 0-26.947745 12.063757-26.947745 26.945698v135.164423c0 14.879895 12.063757 26.945699 26.947745 26.945699h107.786889c14.881942 0 26.945699-12.063757 26.945698-26.945699s-12.063757-26.945699-26.945698-26.945699h-80.839143V588.843132zM721.937918 926.702c-111.947651 0-202.696492-90.74884-202.696492-202.696492 0-0.144286 0.004093-0.285502 0.004094-0.429788h43.004443l-70.330812-104.289228-70.331835 104.289228h43.075051c0 0.144286-0.00307 0.285502-0.00307 0.429788 0 142.091182 115.187439 257.279644 257.278621 257.279645 72.241324 0 137.530306-29.77821 184.260607-77.727269l-45.86663-31.474852c-36.227086 33.873482-84.884272 54.618968-138.393977 54.618968zM694.633039 423.38066c-1.354857-11.487635-11.120268-20.400632-22.972201-20.400632H206.362486c-12.780071 0-23.140023 10.359952-23.140023 23.138999 0 12.781094 10.359952 23.141046 23.140023 23.141047H596.949252c30.209022-13.81668 63.104223-22.76754 97.683787-25.879414zM438.548616 623.143333H206.362486c-12.780071 0-23.140023 10.358929-23.140023 23.140023 0 12.780071 10.359952 23.140023 23.140023 23.140023h219.956598a298.463626 298.463626 0 0 1 12.229532-46.280046zM506.934123 513.062192H206.362486c-12.780071 0-23.140023 10.359952-23.140023 23.139 0 12.781094 10.359952 23.140023 23.140023 23.140023H469.936487a302.241672 302.241672 0 0 1 36.997636-46.279023z" fill="" p-id="14108"></path><path d="M442.765661 835.277778a298.531164 298.531164 0 0 1-14.365173-46.150087H146.542052v-0.065491c-33.036417 0-59.81941-26.78197-59.81941-59.819411V329.36031h704.907545v100.905154a298.561863 298.561863 0 0 1 46.150086 14.996552V194.619536h-0.162706c0-53.422723-43.307342-96.728018-96.730065-96.728018h-68.89409V84.418668c0-33.037441-26.782993-59.81941-59.81941-59.81941v-0.361227h-18.87079v0.032745c-33.038464 0-59.820434 26.78197-59.820433 59.819411 0 0.109494 0.008186 0.218988 0.008186 0.328481h-0.339738v13.47285H345.203648V84.418668c0-33.037441-26.782993-59.81941-59.819411-59.81941v-0.361227h-18.872836v0.032745c-33.036417 0-59.81941 26.78197-59.81941 59.819411 0 0.109494 0.007163 0.218988 0.008186 0.328481h-0.339737v13.47285h-69.189826c-53.4217 0-96.729042 43.306318-96.729041 96.728018 0 1.701758 0.045025 3.39226 0.132006 5.071505v533.785166a98.051153 98.051153 0 0 0-0.132006 5.071506c0 53.4217 43.307342 96.728018 96.729041 96.728018v0.001023h305.595047zM86.723665 204.056466c0-33.037441 26.782993-59.81941 59.819411-59.819411 0.044002 0 0.086981 0.00307 0.130983 0.00307v-0.068561h105.968473V94.874811h0.032746a22.807449 22.807449 0 0 1-0.032746-1.215688c0-12.779048 10.360975-23.140023 23.140023-23.140023s23.140023 10.360975 23.140023 23.140023c0 0.408299-0.010233 0.812505-0.031722 1.215688h0.031722v49.297776h280.508696V94.874811h0.032745a22.807449 22.807449 0 0 1-0.032745-1.215688c0-12.779048 10.361999-23.140023 23.140023-23.140023 12.780071 0 23.141046 10.360975 23.141046 23.140023 0 0.408299-0.011256 0.812505-0.032746 1.215688h0.032746v49.297776h106.10048v0.065492c33.035394 0 59.818387 26.780947 59.818387 59.81941h0.130983V283.080264H86.723665v-79.023798z" fill="" p-id="14109"></path></svg><span>2024-09-23</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;">
    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path>
    <polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline>
    <line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line>
    <line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line>
    <polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline>
</svg><span>4270字</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <circle cx="12" cy="12" r="9"></circle>
    <polyline points="12 7 12 12 15 15"></polyline>
</svg><span>21分钟</span></span>&nbsp;<span class="x-post-meta-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"
     stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
    <circle cx="12" cy="7" r="4"></circle>
    <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
</svg><span>helium</span></span>
      <span class="x-post-meta-item">
        &nbsp;<svg t="1720840393161" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="18680" width="200" height="200"><path d="M995.125144 559.61812l-415.998603-415.998602A52.986489 52.986489 0 0 0 541.413335 127.99957H338.847348c-3.166656-26.559911-9.286635-51.046495-17.999939-71.333094C299.734146 7.333309 271.154242 0 256.00096 0c-13.939953 0-40.439864 6.339979-61.259794 48.806503-10.473298 21.366595-17.946606 48.966502-21.573261 79.193067H53.334974a53.393154 53.393154 0 0 0-53.333154 53.333154v360.078791a52.986489 52.986489 0 0 0 15.619948 37.713206l415.998602 415.998603a53.333154 53.333154 0 0 0 75.426413 0l26.286579-26.293245 26.286578 26.293245a53.426487 53.426487 0 0 0 16.719944 11.333295 21.333262 21.333262 0 0 0 36.079879 11.293295l382.705381-382.705381a53.399821 53.399821 0 0 0 0-75.426413z m-762.070774-491.998347C241.494342 50.373164 250.667645 42.666523 256.00096 42.666523c5.99998 0 16.573278 9.639968 25.646581 30.806564 6.493312 15.159949 11.333295 33.999886 14.146619 54.526483H216.16776c3.206656-23.419921 9.013303-44.359851 16.88661-60.41313z m243.819181 897.330319a10.666631 10.666631 0 0 1-15.079949 0l-415.998603-415.998603A10.573298 10.573298 0 0 1 42.668343 541.411515V181.332724a10.666631 10.666631 0 0 1 10.666631-10.666631h245.332509c0 47.853173-10.373298 92.15969-27.066575 115.632945-5.926647 8.326639-16.566611 14.186619-22.306592 16.113279C204.041135 314.752276 170.667913 356.218803 170.667913 405.331972c0 58.813136 47.853173 106.666308 106.666309 106.666308s106.666308-47.853173 106.666308-106.666308c0-47.086508-30.666564-87.139707-73.079754-101.246327C330.060711 272.705751 341.334007 223.692582 341.334007 170.666093h72.079758a10.573298 10.573298 0 0 1 7.539974 3.126656l415.998603 415.998603a10.666631 10.666631 0 0 1 0 15.079949zM341.334007 405.331972a63.999785 63.999785 0 1 1-63.999785-63.999785 64.073118 64.073118 0 0 1 63.999785 63.999785z m263.539114 559.61812a10.666631 10.666631 0 0 1-15.079949 0L563.499927 938.663513l303.625647-303.61898a53.399821 53.399821 0 0 0 0-75.426413L478.16688 170.666093h63.246455a10.573298 10.573298 0 0 1 7.539974 3.126656l415.998603 415.998603c0.239999 0.239999 0.466665 0.486665 0.666664 0.746664l0.086667 0.106666a10.666631 10.666631 0 0 1 0 13.373289l-0.086667 0.106666c-0.213333 0.259999-0.439999 0.506665-0.666664 0.746664z" fill="#5C5C66" p-id="18681"></path></svg>
        <ul class="post-tags-meta" style="display: inline-block;font-size: 14px;">
            <a href="https://heliu.site/tags/pgsql/" target="_blank" rel="noopener">Pgsql</a>
        </ul>
      </span>
      
      <span id="busuanzi_container_page_pv" class="x-post-meta-item">
        &nbsp;<svg t="1720844685710" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27237" width="200" height="200"><path d="M739.754667 574.08c-121.386667 45.610667-208.469333 169.813333-208.64 316.16 0 33.408 4.693333 65.493333 13.141333 95.914667H94.122667c-26.453333-43.52-41.685333-91.946667-41.685334-143.189334 0-185.173333 192.896-335.104 430.805334-335.104 96.256 0 184.832 24.746667 256.512 66.218667z m-280.490667-114.986667a214.869333 214.869333 0 0 1-214.869333-215.04A215.04 215.04 0 0 1 459.264 28.842667a215.04 215.04 0 0 1 215.04 215.210666 215.04 215.04 0 0 1-215.04 215.04zM974.506667 641.28c9.856 0 17.834667 7.466667 17.834666 16.64v59.989333c-0.341333 8.789333-7.850667 15.786667-17.28 16.085334-9.856 0.341333-18.176-6.826667-18.517333-16.085334v-20.053333l-99.114667 91.093333-0.256 0.256a18.474667 18.474667 0 0 1-14.848 4.352h-0.768a18.176 18.176 0 0 1-9.344-4.608l-0.938666-0.981333-85.930667-80.042667-123.562667 115.072a18.773333 18.773333 0 0 1-25.216 0 15.786667 15.786667 0 0 1 0-23.466666l136.149334-126.848 0.725333-0.597334a18.645333 18.645333 0 0 1 24.362667 0.512l87.253333 81.237334 86.058667-79.232h-21.248c-9.386667-0.298667-16.938667-7.338667-17.28-16.085334-0.341333-9.173333 7.381333-16.896 17.28-17.237333h64.64z m-367.146667 240h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v72.192a16.042667 16.042667 0 0 1-16.042667 16.042666h-48.128a16.042667 16.042667 0 0 1-16.042667-16.042666v-72.192c0-8.874667 7.210667-16.042667 16.042667-16.042667z m110.805333-106.666667h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v178.858667a16.042667 16.042667 0 0 1-16.042667 16.042666h-48.128a16.042667 16.042667 0 0 1-16.042666-16.042666v-178.858667c0-8.874667 7.168-16.042667 16.042666-16.042667z m106.538667 80h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v99.413333a16.042667 16.042667 0 0 1-16.042667 16.042667H824.746667a16.042667 16.042667 0 0 1-16.042667-16.042667v-99.413333c0-8.874667 7.168-16.042667 16.042667-16.042667z m110.165333-80h48.128c8.874667 0 16.042667 7.168 16.042667 16.042667v179.413333a16.042667 16.042667 0 0 1-16.042667 16.042667h-48.128a16.042667 16.042667 0 0 1-16.042666-16.042667v-179.413333c0-8.874667 7.210667-16.042667 16.042666-16.042667z" fill="#999999" p-id="27238"></path></svg>
        <span id="busuanzi_value_page_pv"></span>
      </span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e6%95%b0%e5%ad%97%e7%b1%bb%e5%9e%8b" aria-label="数字类型">数字类型</a><ul>
                            
                    <li>
                        <a href="#%e6%95%b4%e6%95%b0%e7%b1%bb%e5%9e%8b" aria-label="整数类型">整数类型</a></li>
                    <li>
                        <a href="#%e4%bb%bb%e6%84%8f%e7%b2%be%e5%ba%a6%e6%95%b0%e5%ad%97" aria-label="任意精度数字">任意精度数字</a></li>
                    <li>
                        <a href="#%e6%b5%ae%e7%82%b9%e7%b1%bb%e5%9e%8b" aria-label="浮点类型">浮点类型</a></li>
                    <li>
                        <a href="#%e5%ba%8f%e5%88%97%e7%b1%bb%e5%9e%8b" aria-label="序列类型">序列类型</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e8%b4%a7%e5%b8%81%e7%b1%bb%e5%9e%8b" aria-label="货币类型">货币类型</a></li>
                    <li>
                        <a href="#%e5%b8%83%e5%b0%94%e7%b1%bb%e5%9e%8b" aria-label="布尔类型">布尔类型</a></li>
                    <li>
                        <a href="#uuid%e7%b1%bb%e5%9e%8b" aria-label="UUID类型">UUID类型</a></li>
                    <li>
                        <a href="#%e5%ad%97%e7%ac%a6%e7%b1%bb%e5%9e%8b" aria-label="字符类型">字符类型</a><ul>
                            
                    <li>
                        <a href="#char" aria-label="CHAR">CHAR</a></li>
                    <li>
                        <a href="#varchar" aria-label="VARCHAR">VARCHAR</a></li>
                    <li>
                        <a href="#text" aria-label="TEXT">TEXT</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%97%a5%e6%9c%9f%e6%97%b6%e9%97%b4%e7%b1%bb%e5%9e%8b" aria-label="日期/时间类型">日期/时间类型</a><ul>
                            
                    <li>
                        <a href="#date" aria-label="DATE">DATE</a></li>
                    <li>
                        <a href="#timestamp" aria-label="TIMESTAMP">TIMESTAMP</a></li>
                    <li>
                        <a href="#time" aria-label="TIME">TIME</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%9e%9a%e4%b8%be%e7%b1%bb%e5%9e%8b" aria-label="枚举类型">枚举类型</a></li>
                    <li>
                        <a href="#%e7%bd%91%e7%bb%9c%e5%9c%b0%e5%9d%80%e7%b1%bb%e5%9e%8b" aria-label="网络地址类型">网络地址类型</a></li>
                    <li>
                        <a href="#%e5%87%a0%e4%bd%95%e7%b1%bb%e5%9e%8b" aria-label="几何类型">几何类型</a><ul>
                            
                    <li>
                        <a href="#%e7%82%b9" aria-label="点">点</a></li>
                    <li>
                        <a href="#%e7%ba%bf" aria-label="线">线</a></li>
                    <li>
                        <a href="#%e7%ba%bf%e6%ae%b5" aria-label="线段">线段</a></li>
                    <li>
                        <a href="#%e6%96%b9%e6%a1%86" aria-label="方框">方框</a></li>
                    <li>
                        <a href="#%e8%b7%af%e5%be%84" aria-label="路径">路径</a></li>
                    <li>
                        <a href="#%e5%a4%9a%e8%be%b9%e5%bd%a2" aria-label="多边形">多边形</a></li>
                    <li>
                        <a href="#%e5%9c%86" aria-label="圆">圆</a></li>
                    <li>
                        <a href="#%e7%a4%ba%e4%be%8b" aria-label="示例">示例</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%bd%8d%e4%b8%b2%e7%b1%bb%e5%9e%8b" aria-label="位串类型">位串类型</a></li>
                    <li>
                        <a href="#json" aria-label="JSON">JSON</a><ul>
                            
                    <li>
                        <a href="#json-1" aria-label="JSON">JSON</a></li>
                    <li>
                        <a href="#jsonb" aria-label="JSONB">JSONB</a>
                    </li>
                </ul>
                </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><ul>
<li>官网中文文档：<a href="http://www.postgres.cn/docs/14/datatype.html" target="_blank" rel="noopener">http://www.postgres.cn/docs/14/datatype.html</a></li>
</ul>
<h2 id="数字类型">数字类型<a hidden class="anchor" aria-hidden="true" href="#数字类型">#</a></h2>
<ul>
<li>数字类型由2、4或8字节的整数以及4或8字节的浮点数和可选精度小数组成。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储尺寸</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">smallint</td>
<td style="text-align:center">2字节</td>
<td style="text-align:center">小范围整数</td>
<td style="text-align:center">-32768 to +32767</td>
</tr>
<tr>
<td style="text-align:center">integer</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">整数的典型选择</td>
<td style="text-align:center">-2147483648 to +2147483647</td>
</tr>
<tr>
<td style="text-align:center">bigint</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">大范围整数</td>
<td style="text-align:center">-9223372036854775808 to +9223372036854775807</td>
</tr>
<tr>
<td style="text-align:center">decimal</td>
<td style="text-align:center">可变</td>
<td style="text-align:center">用户指定精度，精确</td>
<td style="text-align:center">最高小数点前131072位，以及小数点后16383位</td>
</tr>
<tr>
<td style="text-align:center">numeric</td>
<td style="text-align:center">可变</td>
<td style="text-align:center">用户指定精度，精确</td>
<td style="text-align:center">最高小数点前131072位，以及小数点后16383位</td>
</tr>
<tr>
<td style="text-align:center">real</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">可变精度，不精确</td>
<td style="text-align:center">6位十进制精度</td>
</tr>
<tr>
<td style="text-align:center">double precision</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">可变精度，不精确</td>
<td style="text-align:center">15位十进制精度</td>
</tr>
<tr>
<td style="text-align:center">smallserial</td>
<td style="text-align:center">2字节</td>
<td style="text-align:center">自动增加的小整数</td>
<td style="text-align:center">1到32767</td>
</tr>
<tr>
<td style="text-align:center">serial</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">自动增加的整数</td>
<td style="text-align:center">1到2147483647</td>
</tr>
<tr>
<td style="text-align:center">bigserial</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">自动增长的大整数</td>
<td style="text-align:center">1到9223372036854775807</td>
</tr>
</tbody>
</table>
<h3 id="整数类型">整数类型<a hidden class="anchor" aria-hidden="true" href="#整数类型">#</a></h3>
<ol>
<li><code>smallint</code>、<code>integer</code>、<code>bigint</code> 整数类型。(postgreSQL<strong>不支持</strong>无符号整型)</li>
<li>SQL只声明了整数类型integer（或int）、smallint和bigint。类型int2、int4和int8都是扩展，也在许多其它SQL数据库系统中使用。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- INT 是 INTEGER 的同义词，您可以使用 INT 代替 INTEGER。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">my_schema</span><span class="p">.</span><span class="n">t01</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">s_id</span><span class="w"> </span><span class="nb">smallint</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">i_id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">b_id</span><span class="w"> </span><span class="nb">bigint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t01</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">211</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div>

<p><details >
  <summary markdown="span">smallint、integer、bigint</summary>
  <blockquote>
<ol>
<li>SMALLINT需要 2 个字节的存储大小，可以存储 (-32,767, 32,767) 范围内的任何整数。</li>
<li>您可以使用SMALLINT类型来存储诸如人的年龄、书籍的页数等内容。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">books</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">book_id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">pages</span><span class="w"> </span><span class="nb">SMALLINT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">pages</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="3">
<li>INTEGER是整数类型中最常见的选择，因为它提供了存储大小、范围和性能之间的最佳平衡。</li>
<li>INTEGER类型需要 4 字节存储大小，可以存储 (-2,147,483,648, 2,147,483,647) 范围内的数字。</li>
<li>您可以将INTEGER类型用于存储相当大的整数（例如城市甚至国家的人口）的列，如下例所示：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">cities</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">city_id</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">city_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">population</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="n">population</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 注意，INT是INTEGER的同义词
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="6">
<li>如果你想存储超出INTEGER类型范围的整数，你可以使用BIGINT类型。</li>
<li>BIGINT类型需要 8 字节存储大小，可以存储 (-9,223,372,036,854,775,808, +9,223,372,036,854,775,807) 范围内的任何数字。</li>
<li>使用BIGINT类型不仅会消耗大量存储空间，还会降低数据库的性能，因此，您应该要有充分的理由才使用它。</li>
</ol>
</blockquote>

</details></p>

<h3 id="任意精度数字">任意精度数字<a hidden class="anchor" aria-hidden="true" href="#任意精度数字">#</a></h3>
<ol>
<li>类型numeric可以存储非常多位的数字。我们特别建议将它用于货币金额和其它要求计算准确的数量。</li>
<li>numeric值的计算在可能的情况下会得到准确的结果，例如加法、减法、乘法。不过，numeric类型上的算术运算比整数类型或者下一节描述的浮点数类型要慢很多。</li>
<li>在随后的内容里，我们使用了下述术语：一个numeric的precision（精度）是整个数中有效位的总数，也就是小数点两边的位数。</li>
<li>numeric的scale（小数位数）是小数部分的数字位数，也就是小数点右边的部分。因此数字 23.5141 的精度为6而小数位数为4。可以认为整数的小数位数为零。</li>
<li>numeric列的最大精度和最大小数位数都是可以配置的。要声明一个类型为numeric的列，你可以用下面的语法：
<ul>
<li>precision：可选的。它是允许存储的数字的总位数，含小数部分的位数。</li>
<li>scale：可选的。小数部分的位数。</li>
<li>例如，数字 1234.567 具有 precision 7 和 scale 3 。</li>
<li>注意，DECIMAL 和 NUMERIC 是等价的。</li>
</ul>
</li>
</ol>
<pre tabindex="0"><code class="language-ensp" data-lang="ensp"># 精度必须为正数，小数位数可以为零或者正数。
NUMERIC(precision, scale)

# 选择小数位数为0。
NUMERIC(precision)

# 在没有指定任何精度或小数位数的情况下，创建一个“无约束的数值”列，其中可以存储任意长度的数值，直到被实现所限制。
NUMERIC
</code></pre><ol start="6">
<li>NUMERIC 适用于存储含有大量数字的数值。它的小数点前最多 131072 位数字，小数点后最多 16383 位数字。</li>
<li>除了普通的数值之外，浮点类型还有几个特殊值：
<ul>
<li><code>'Infinity'</code>: 无穷大。</li>
<li><code>'-Infinity'</code>: 负无穷大。</li>
<li><code>'NaN'</code>: 非数字。</li>
</ul>
</li>
<li>在SQL命令中将这些值作为常量写入时，必须在其周围加引号，例如UPDATE table SET x = &lsquo;-Infinity&rsquo;。输入时，以不区分大小写的方式识别这些字符串。无穷大值也可以拼写为inf和-inf。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">numeric_5_2</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">numeric_i</span><span class="w"> </span><span class="nb">NUMERIC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 插入一条数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_5_2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">1234</span><span class="p">.</span><span class="mi">456</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_5_2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 这里，因为数字 1234.234 超出了 NUMERIC(5,2) 的范围，因此 PostgreSQL 给出了一个错误。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/* Output
</span></span></span><span class="line"><span class="cl"><span class="cm">ERROR:  numeric field overflow
</span></span></span><span class="line"><span class="cl"><span class="cm">DETAIL:  A field with precision 5, scale 2 must round to an absolute value less than 10^3.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_5_2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="mi">234</span><span class="p">.</span><span class="mi">456</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_5_2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 这里，由于 NUMERIC(5,2) 允许的小数位为 2，因此 234.456 被四舍五入为 234.46。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/* Output
</span></span></span><span class="line"><span class="cl"><span class="cm"> numeric_5_2
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------
</span></span></span><span class="line"><span class="cl"><span class="cm">      234.46
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="9">
<li>PostgreSQL 14 开始支持 Infinity 与 -Infinity。 您不能向一个有限范围的 NUMERIC 写入 Infinity 与 -Infinity， 否则 PostgreSQL 将给出一个错误。比如：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_5_2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Infinity&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_5_2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output
</span></span></span><span class="line"><span class="cl"><span class="cm">ERROR:  numeric field overflow
</span></span></span><span class="line"><span class="cl"><span class="cm">DETAIL:  A field with precision 5, scale 2 cannot hold an infinite value.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Infinity&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> numeric_i
</span></span></span><span class="line"><span class="cl"><span class="cm">-----------
</span></span></span><span class="line"><span class="cl"><span class="cm">  Infinity
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_i</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;-Infinity&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> numeric_i
</span></span></span><span class="line"><span class="cl"><span class="cm">-----------
</span></span></span><span class="line"><span class="cl"><span class="cm"> -Infinity
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_numeric</span><span class="w"> </span><span class="p">(</span><span class="n">numeric_5_2</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">numeric_5_2</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> numeric_5_2
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------
</span></span></span><span class="line"><span class="cl"><span class="cm">         NaN
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h3 id="浮点类型">浮点类型<a hidden class="anchor" aria-hidden="true" href="#浮点类型">#</a></h3>
<ol>
<li>数据类型real和double precision是不精确的、变精度的数字类型。</li>
<li>使用浮点类型需要注意：
<ul>
<li>如果你要求准确的存储和计算（例如计算货币金额），应使用numeric类型。</li>
<li>如果你想用这些类型做任何重要的复杂计算，尤其是那些你对范围情况（无穷、下溢）严重依赖的事情，那你应该仔细评诂你的实现。</li>
<li>用两个浮点数值进行等值比较不可能总是按照期望地进行。</li>
</ul>
</li>
<li>real类型的范围是 1E-37 to 1E+37，精度至少是 6 位小数。double precision类型的范围是 1E-307 to 1E+308，精度至少是 15 位数字。</li>
<li>太大或者太小的值都会导致错误。如果输入数字的精度太高，那么可能发生四舍五入。太接近零的数字，如果不能体现出与零的区别就会导致下溢错误。</li>
<li>除了普通的数字值之外，浮点类型还有几个特殊值：
<ul>
<li>Infinity</li>
<li>-Infinity</li>
<li>NaN</li>
</ul>
</li>
<li>如果在 SQL 命令里把这些数值当作常量写，你必须在它们周围放上单引号，例如UPDATE table SET x = &lsquo;-Infinity&rsquo;。在输入时，这些字符串是以大小写不敏感的方式识别的。无穷大值也可以拼写为inf和-inf。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">f01</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">f_01</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">d_01</span><span class="w"> </span><span class="n">DOUBLE</span><span class="w"> </span><span class="k">PRECISION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">f01</span><span class="p">(</span><span class="n">f_01</span><span class="p">,</span><span class="w"> </span><span class="n">d_01</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="p">.</span><span class="mi">212</span><span class="p">,</span><span class="w"> </span><span class="mi">333</span><span class="p">.</span><span class="mi">21212321</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div>

<p><details >
  <summary markdown="span">real</summary>
  <blockquote>
<ol>
<li>real数据类型允许您在数据库中存储单精度浮点数。</li>
<li>real 类型的值占用4个字节的存储空间。其有效范围从1E-37到1E+37。</li>
<li>通常，您会使用real数据类型，来存储具有相对较大范围的浮点数，而且精度没那么重要，或者当您担心存储空间时也可以考虑使用。</li>
<li>但是，如果需要更高的精度，可以使用 double precision 数据类型。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">weathers</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">wind_speed_mps</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">temperature_celsius</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">recorded_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">weathers</span><span class="w"> </span><span class="p">(</span><span class="k">location</span><span class="p">,</span><span class="w"> </span><span class="n">wind_speed_mps</span><span class="p">,</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="p">,</span><span class="w"> </span><span class="n">recorded_at</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 09:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 10:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 11:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 12:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 13:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 14:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">17</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 15:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 16:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">14</span><span class="p">.</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 17:00:00&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2024-04-19 18:00:00&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">wind_speed_mps</span><span class="p">)</span><span class="w">       </span><span class="n">wind_speed</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature_celsius</span><span class="p">)</span><span class="w"> </span><span class="n">temperature_celsius</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">weathers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;New York&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="nb">DATE</span><span class="p">(</span><span class="n">recorded_at</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-04-19&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">    wind_speed     | temperature_celsius
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------------+---------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 5.360000038146973 |  15.639999961853027
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div></blockquote>

</details></p>



<p><details >
  <summary markdown="span">double precision</summary>
  <blockquote>
<ol>
<li>在 PostgreSQL 中，double precision是一种不精确的、可变精度的数值类型。</li>
<li>不精确意味着 PostgreSQL 无法将某些值精确地转换为内部格式，只能将它们存储为近似值。因此，存储和查询的值可能会出现细微的差异。</li>
<li>如果应用程序需要精确的存储和计算，建议改用 numeric 类型。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">temperatures</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">location</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">temperature</span><span class="w"> </span><span class="n">DOUBLE</span><span class="w"> </span><span class="k">PRECISION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">temperatures</span><span class="w"> </span><span class="p">(</span><span class="k">location</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;Lab Room 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">.</span><span class="mi">5</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;Server Room 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">.</span><span class="mi">8</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;Server Room 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |   location    | temperature
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------+-------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | Lab Room 1    |        23.5
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | Server Room 1 |        21.8
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | Server Room 2 |        24.3
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">AVG</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">temperatures</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> avg
</span></span></span><span class="line"><span class="cl"><span class="cm">------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 23.2
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="4">
<li>存储不精确的数值。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="k">c</span><span class="w"> </span><span class="n">double</span><span class="w"> </span><span class="k">precision</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="k">c</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="k">c</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 输出表示0.1、0.1和0.1的和不是0.3，而是0.30000000000000004。
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 这表明 PostgreSQL 不能使用double precision类型来存储确切的数字0.1。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">         sum
</span></span></span><span class="line"><span class="cl"><span class="cm">---------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 0.30000000000000004
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>插入过小的数字。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="k">c</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">400</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 原因是这个数字太小，非常接近于零。
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 由于 double precision 类型的限制，PostgreSQL 无法存储它。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">ERROR:  &#34;0.0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001&#34; is out of range for type double precision
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div></blockquote>

</details></p>

<h3 id="序列类型">序列类型<a hidden class="anchor" aria-hidden="true" href="#序列类型">#</a></h3>
<ol>
<li>smallserial、serial和bigserial类型不是真正的类型，它们只是为了创建唯一标识符列而存在的方便符号（类似其它一些数据库中支持的AUTO_INCREMENT属性）。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">colname</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 等价于以下语句：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">tablename_colname_seq</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">integer</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">tablename</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">colname</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;tablename_colname_seq&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ALTER</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="n">tablename_colname_seq</span><span class="w"> </span><span class="n">OWNED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">tablename</span><span class="p">.</span><span class="n">colname</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>因此，我们就创建了一个整数列并且把它的缺省值安排为从一个序列发生器取值。</li>
<li>应用了一个NOT NULL约束以确保空值不会被插入（在大多数情况下你可能还希望附加一个UNIQUE或者PRIMARY KEY约束避免意外地插入重复的值，但这个不是自动发生的）。</li>
<li>最后，该序列被标记为“属于”该列，这样当列或表被删除时该序列也会被删除。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">t02</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t02</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;asdasd&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">t02</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;asdasd01&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h2 id="货币类型">货币类型<a hidden class="anchor" aria-hidden="true" href="#货币类型">#</a></h2>
<ol>
<li>money类型存储固定小数精度的货币数字。可接受的输入格式很多，包括整数和浮点数文字，以及常用的货币格式，如&rsquo;$1,000.00&rsquo;。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储尺寸</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">money</td>
<td style="text-align:center">8 bytes</td>
<td style="text-align:center">货币额</td>
<td style="text-align:center">-92233720368547758.08到+92233720368547758.07</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>由于这种数据类型的输出是区域敏感的，因此将money数据装入到一个具有不同lc_monetary设置的数据库是不起作用的。为了避免这种问题，在恢复一个转储到一个新数据库中之前，应确保新数据库的lc_monetary设置和被转储数据库的相同或者具有等效值。</li>
<li>数据类型numeric、int和bigint的值可以被造型成money。从数据类型real和double precision的转换可以通过先造型成numeric来实现，例如：</li>
<li>但是，我们不推荐这样做。浮点数不应该被用来处理货币，因为浮点数可能会有圆整错误。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="n">postgres</span><span class="o">=&gt;</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;12.34&#39;</span><span class="p">::</span><span class="n">float8</span><span class="p">::</span><span class="nb">numeric</span><span class="p">::</span><span class="n">money</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="n">money</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">--------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w"> </span><span class="err">$</span><span class="mi">12</span><span class="p">.</span><span class="mi">34</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="k">row</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>一个money值可以在不损失精度的情况下被造型成numeric。转换到其他类型可能会丢失精度，并且必须采用两个阶段完成：
<ul>
<li>一个money值被一个整数值除的除法结果会被截去分数部分。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; SELECT &#39;52093.89&#39;::money::numeric::float8;
</span></span><span class="line"><span class="cl">  float8  
</span></span><span class="line"><span class="cl">----------
</span></span><span class="line"><span class="cl"> 52093.89
</span></span><span class="line"><span class="cl">(1 row)
</span></span></code></pre></div><ol start="6">
<li>使用示例。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">financials</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">amount</span><span class="w"> </span><span class="n">money</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">financials</span><span class="w"> </span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;12345.67&#39;</span><span class="p">),</span><span class="w">  </span><span class="c1">-- 正常金额
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(</span><span class="s1">&#39;-12345.67&#39;</span><span class="p">),</span><span class="w"> </span><span class="c1">-- 负金额
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(</span><span class="s1">&#39;9999999999999999.99&#39;</span><span class="p">);</span><span class="w">  </span><span class="c1">-- 接近最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 查询所有记录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">financials</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |          amount           
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 |                $12,345.67
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 |               -$12,345.67
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | $9,999,999,999,999,999.99
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 查询金额总和
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">financials</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">            sum            
</span></span></span><span class="line"><span class="cl"><span class="cm">---------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> $9,999,999,999,999,999.99
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="7">
<li>注意：默认的货币符号为<code>$</code>，货币符号由lc_monetary设置决定。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; show lc_monetary;
</span></span><span class="line"><span class="cl"> lc_monetary 
</span></span><span class="line"><span class="cl">-------------
</span></span><span class="line"><span class="cl"> C
</span></span><span class="line"><span class="cl">(1 row)
</span></span></code></pre></div><ol start="8">
<li>修改货币符号。
<ul>
<li>修改 postgresql.conf 配置文件参数 <code>lc_monetary</code>。</li>
<li>或者 ALTER 修改，或<code>set lc_monetary='zh_CN.UTF-8'</code>。</li>
</ul>
</li>
<li>可能 PostgreSQL 不支持 <code>zh_CN.UTF-8</code> 区域，通过sql查看支持区域。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">pg_collation</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><h2 id="布尔类型">布尔类型<a hidden class="anchor" aria-hidden="true" href="#布尔类型">#</a></h2>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储字节</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">boolean</td>
<td style="text-align:center">1字节</td>
<td style="text-align:center">状态为真或假</td>
</tr>
</tbody>
</table>
<ol>
<li>PostgreSQL 对布尔值的处理非常灵活，<code>true, 'true', 't', 'yes', 'y', '1'</code>都被视为真，<code>false, 'false', 'f', 'no', 'n', '0'</code>都被视为假。注意，这里所有的值不区分大小写。除了 true 和 false，其他的都是字符类型。</li>
<li>PostgreSQL 布尔类型允许 NULL 值。BOOLEAN 可以简写为 BOOL。</li>
<li>请注意，在 SQL 标准中，一个布尔值只接受 TRUE，FALSE，和 NULL（表示未知unknown）。前导或尾随空格并不重要，并且除true和false之外的所有常量值都必须用单引号引起来。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 设置默认值 is_ok BOOL DEFAULT &#39;t&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">v</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">b</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">TRUE</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="k">FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">FALSE</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;n&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;no&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;YES&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YES&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">   v   | b
</span></span></span><span class="line"><span class="cl"><span class="cm">--------+---
</span></span></span><span class="line"><span class="cl"><span class="cm"> true  | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> false | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> t     | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> f     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> T     | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> F     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> 1     | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> 0     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> y     | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> n     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> Y     | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> N     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> yes   | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> no    | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> YES   | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> NO    | f
</span></span></span><span class="line"><span class="cl"><span class="cm">(16 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Y&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">  v   | b
</span></span></span><span class="line"><span class="cl"><span class="cm">------+---
</span></span></span><span class="line"><span class="cl"><span class="cm"> true | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> t    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> T    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> 1    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> y    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> Y    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> yes  | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> YES  | t
</span></span></span><span class="line"><span class="cl"><span class="cm">(8 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div>

<p><details >
  <summary markdown="span">操作符</summary>
  <blockquote>
<ol>
<li>常用的逻辑操作符有：AND、OR、NOT。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">a AND b</th>
<th style="text-align:center">a OR b</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">TRUE</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">TRUE</td>
</tr>
<tr>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">FALSE</td>
<td style="text-align:center">NULL</td>
</tr>
<tr>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">NULL</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>常用比较符 IS。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">expression IS  TRUE;
</span></span><span class="line"><span class="cl">expression IS  FALSE;
</span></span><span class="line"><span class="cl">expression IS  UNKNOWN;
</span></span></code></pre></div><ol start="3">
<li>示例。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">TRUE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">  v   | b 
</span></span></span><span class="line"><span class="cl"><span class="cm">------+---
</span></span></span><span class="line"><span class="cl"><span class="cm"> true | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> t    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> T    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> 1    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> y    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> Y    | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> yes  | t
</span></span></span><span class="line"><span class="cl"><span class="cm"> YES  | t
</span></span></span><span class="line"><span class="cl"><span class="cm">(8 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">FALSE</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">   v   | b 
</span></span></span><span class="line"><span class="cl"><span class="cm">-------+---
</span></span></span><span class="line"><span class="cl"><span class="cm"> false | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> f     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> F     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> 0     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> n     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> N     | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> no    | f
</span></span></span><span class="line"><span class="cl"><span class="cm"> NO    | f
</span></span></span><span class="line"><span class="cl"><span class="cm">(8 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test_boolean</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> v | b 
</span></span></span><span class="line"><span class="cl"><span class="cm">---+---
</span></span></span><span class="line"><span class="cl"><span class="cm">(0 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> ?column? 
</span></span></span><span class="line"><span class="cl"><span class="cm">----------
</span></span></span><span class="line"><span class="cl"><span class="cm"> f
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">UNKNOWN</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> ?column? 
</span></span></span><span class="line"><span class="cl"><span class="cm">----------
</span></span></span><span class="line"><span class="cl"><span class="cm"> t
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="p">::</span><span class="nb">boolean</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> bool 
</span></span></span><span class="line"><span class="cl"><span class="cm">------
</span></span></span><span class="line"><span class="cl"><span class="cm"> t
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div></blockquote>

</details></p>

<h2 id="uuid类型">UUID类型<a hidden class="anchor" aria-hidden="true" href="#uuid类型">#</a></h2>
<ol>
<li>这种标识符是一个128位的量，它由一个精心选择的算法产生，该算法能保证在已知空间中任何其他使用相同算法的人能够产生同一个标识符的可能性非常非常小。因此，对于分布式系统，这些标识符相比序列生成器而言提供了一种很好的唯一性保障，序列生成器只能在一个数据库中保证唯一。</li>
<li>一个UUID被写成一个小写十六进制位的序列，该序列被连字符分隔成多个组：首先是一个8位组，接下来是三个4位组，最后是一个12位组。总共的32位（十六进制位）表示了128个二进制位。一个标准形式的UUID类似于：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11
</span></span></code></pre></div><ol start="3">
<li>PostgreSQL也接受另一种输入形式： 使用大写位、标准格式被花括号包围、忽略某些或者全部连字符、在任意4位组后面增加一个连字符。例如：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">A0EEBC99-9C0B-4EF8-BB6D-6BB9BD380A11
</span></span><span class="line"><span class="cl">{a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11}
</span></span><span class="line"><span class="cl">a0eebc999c0b4ef8bb6d6bb9bd380a11
</span></span><span class="line"><span class="cl">a0ee-bc99-9c0b-4ef8-bb6d-6bb9-bd38-0a11
</span></span><span class="line"><span class="cl">{a0eebc99-9c0b4ef8-bb6d6bb9-bd380a11}
</span></span></code></pre></div><ol start="4">
<li>要在 PostgreSQL 中生成 UUID，请使用 gen_random_uuid() 函数，如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- gen_random_uuid() 根据随机数生成 uuid
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 如果想根据 MAC 地址生成 uuid，安装 uuid-ossp 模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">           gen_random_uuid
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 226199a2-b0c7-4ca6-a4f4-b4b31fba2a64
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">fruits</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">()</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">fruits</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Apple&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Peach&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Banana&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">                  id                  |  name
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------------------------------+--------
</span></span></span><span class="line"><span class="cl"><span class="cm"> c7f32415-d35e-4f57-8496-7978f422ff6a | Apple
</span></span></span><span class="line"><span class="cl"><span class="cm"> c82ab208-4520-424f-a225-131d7a91eadf | Peach
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2c53ece8-440f-4374-8cb0-b7a5826a62f8 | Banana
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div>

<p><details >
  <summary markdown="span">uuid-ossp 模块</summary>
  <blockquote>
<ol>
<li>PostgreSQL 允许您存储和比较 UUID 值，但它的核心不包含用于生成 UUID 值的函数。</li>
<li>相反，它依赖于提供特定算法来生成 UUID 的第三方模块。例如，uuid-ossp模块提供了一些方便的函数来实现生成 UUID 的标准算法。</li>
<li>要安装uuid-ossp模块，请使用如下 <strong>CREATE EXTENSION</strong> 语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- IF NOT EXISTS子句允许您避免重新安装模块
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 操作账户需要相关权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">EXTENSION</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="s2">&#34;uuid-ossp&#34;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><ol start="4">
<li><a href="https://www.rockdata.net/zh-cn/docs/14/uuid-ossp.html" target="_blank" rel="noopener">uuid-ossp 模块函数参考</a></li>
<li>要根据计算机的 MAC 地址、当前时间戳和随机值的组合生成 UUID 值，请使用以下uuid_generate_v1()函数：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=# SELECT uuid_generate_v1();
</span></span><span class="line"><span class="cl">           uuid_generate_v1           
</span></span><span class="line"><span class="cl">--------------------------------------
</span></span><span class="line"><span class="cl"> 7f13869e-7bb3-11ef-9b7a-0242ac140002
</span></span><span class="line"><span class="cl">(1 row)
</span></span></code></pre></div><ol start="6">
<li>如果您想仅根据随机数生成 UUID 值，可以使用uuid_generate_v4()函数。例如：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=# SELECT uuid_generate_v4();
</span></span><span class="line"><span class="cl">           uuid_generate_v4           
</span></span><span class="line"><span class="cl">--------------------------------------
</span></span><span class="line"><span class="cl"> dfde1e70-6afe-443e-9a06-40011a86ff17
</span></span><span class="line"><span class="cl">(1 row)
</span></span></code></pre></div><ol start="7">
<li>使用示例。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">contacts</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">contact_id</span><span class="w"> </span><span class="n">uuid</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">uuid_generate_v4</span><span class="w"> </span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">contact_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">contacts</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">email</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">phone</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;AD&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;S2ith&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;3j3ohi5th@example.com&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;418-267-5432&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;KD&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;SC1h&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;3ji.5th@example.com&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;408-212-2673&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;EC&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;dsw32&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;a2x.sm@example.com&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;408-243-2653&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; SELECT * FROM my_schema.contacts;
</span></span><span class="line"><span class="cl">              contact_id              | first_name | last_name |         email         |    phone     
</span></span><span class="line"><span class="cl">--------------------------------------+------------+-----------+-----------------------+--------------
</span></span><span class="line"><span class="cl"> 98fafd47-7319-4ba6-9ff4-dd8c8fe2aeb8 | AD         | S2ith     | 3j3ohi5th@example.com | 418-267-5432
</span></span><span class="line"><span class="cl"> 5a83c3a8-42de-4f4a-84d0-7d00232fa250 | KD         | SC1h      | 3ji.5th@example.com   | 408-212-2673
</span></span><span class="line"><span class="cl"> 56546027-f971-4ee4-b251-1eb1af74fbff | EC         | dsw32     | a2x.sm@example.com    | 408-243-2653
</span></span><span class="line"><span class="cl">(3 rows)
</span></span></code></pre></div></blockquote>

</details></p>

<h2 id="字符类型">字符类型<a hidden class="anchor" aria-hidden="true" href="#字符类型">#</a></h2>
<ol>
<li>字符类型以文本形式存储数据，PostgreSQL 提供了三种字符数据类型：CHAR，VARCHAR，和 TEXT。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; 名字 &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">character varying(n), varchar(n)</td>
<td style="text-align:center">有限制的变长</td>
</tr>
<tr>
<td style="text-align:center">character(n), char(n)</td>
<td style="text-align:center">定长，空格填充</td>
</tr>
<tr>
<td style="text-align:center">text</td>
<td style="text-align:center">无限变长</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>下面说明了 PostgreSQL 中的三种字符类型的用法：
<ul>
<li><strong>CHAR(n)</strong> 存储固定长度的字符串，长度不足时，使用空白填充。</li>
<li><strong>VARCHAR(n)</strong> 存储具有长度限制的可变长度文本。</li>
<li><strong>VARCHAR</strong> 存储没有长度限制的可变长度文本。 它与 TEXT 完全相同。</li>
<li><strong>TEXT</strong> 存储没有长度限制的可变长度文本。</li>
</ul>
</li>
<li>CHAR(n) 和 VARCHAR(n) 最多可存储 n 字符。VARCHAR 与 TEXT 完全相同。</li>
<li>对于限制了长度的字符类型来说，如果写入的内容超过了限制的长度，PostgreSQL 采用如下的策略：
<ul>
<li>如果超出长度的部分只有空格，则多余的空格会被截断。</li>
<li>如果超出长度的部分不只是空格，则给出错误提示。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">char_1</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">varchar_10</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">txt</span><span class="w"> </span><span class="nb">TEXT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h3 id="char">CHAR<a hidden class="anchor" aria-hidden="true" href="#char">#</a></h3>
<ol>
<li>CHAR 类型使用示例。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 因为该 char_1 列的数据类型是 CHAR(1)，我们试图在该列中插入一个包含 2 个字符的字符串: &#39;OK&#39;。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="n">char_1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ERROR:  value too long for type character(1)
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 使用下面的语句向表中插入一个新行超出 char_1 列长度的值，超出的部分为空格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="n">char_1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;好    &#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 这里插入成功了。这是因为超出的部分是空格，PostgreSQL 自动截断了空格。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> char_1 | varchar_10 | txt
</span></span></span><span class="line"><span class="cl"><span class="cm">--------+------------+-----
</span></span></span><span class="line"><span class="cl"><span class="cm"> 好     | (NULL)     | (NULL)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h3 id="varchar">VARCHAR<a hidden class="anchor" aria-hidden="true" href="#varchar">#</a></h3>
<ol>
<li>VARCHAR 类型使用示例。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 使用下面的语句向表中插入一个新行超出 varchar_10 列长度的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="n">varchar_10</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 这是因为该 varchar_10 列的数据类型是 VARCHAR(10)，我们试图在该列中插入一个包含 11 个字符的字符串: &#39;Hello World&#39;。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ERROR:  value too long for type character varying(10)
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 使用下面的语句向表中插入一个新行超出 varchar_10 列长度的值，超出的部分为空格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="n">varchar_10</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;HelloWor好d    &#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 这里插入成功了。这是因为超出的部分是空格，PostgreSQL 自动截断了空格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> char_1 | varchar_10  | txt
</span></span></span><span class="line"><span class="cl"><span class="cm">--------+-------------+-----
</span></span></span><span class="line"><span class="cl"><span class="cm"> (NULL) | HelloWor好d | (NULL)
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h3 id="text">TEXT<a hidden class="anchor" aria-hidden="true" href="#text">#</a></h3>
<ol>
<li>使用下面的语句向表中插入一个新行。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_character_type</span><span class="w"> </span><span class="p">(</span><span class="n">txt</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;TEXT column can store 你好 a string of any length&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="n">txt</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">                     txt
</span></span></span><span class="line"><span class="cl"><span class="cm">----------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> TEXT column can store 你好 a string of any length
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h2 id="日期时间类型">日期/时间类型<a hidden class="anchor" aria-hidden="true" href="#日期时间类型">#</a></h2>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储尺寸</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">最小值</th>
<th style="text-align:center">最大值</th>
<th style="text-align:center">解析度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">timestamp [ (p) ] [ without time zone ]</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">包括日期和时间（无时区）</td>
<td style="text-align:center">4713 BC</td>
<td style="text-align:center">294276 AD</td>
<td style="text-align:center">1微秒</td>
</tr>
<tr>
<td style="text-align:center">timestamp [ (p) ] with time zone</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">包括日期和时间，有时区</td>
<td style="text-align:center">4713 BC</td>
<td style="text-align:center">294276 AD</td>
<td style="text-align:center">1微秒</td>
</tr>
<tr>
<td style="text-align:center">date</td>
<td style="text-align:center">4字节</td>
<td style="text-align:center">日期（没有一天中的时间）</td>
<td style="text-align:center">4713 BC</td>
<td style="text-align:center">5874897 AD</td>
<td style="text-align:center">1日</td>
</tr>
<tr>
<td style="text-align:center">time [ (p) ] [ without time zone ]</td>
<td style="text-align:center">8字节</td>
<td style="text-align:center">一天中的时间（无日期）</td>
<td style="text-align:center">00:00:00</td>
<td style="text-align:center">24:00:00</td>
<td style="text-align:center">1微秒</td>
</tr>
<tr>
<td style="text-align:center">time [ (p) ] with time zone</td>
<td style="text-align:center">12字节</td>
<td style="text-align:center">仅仅是一天中的时间（没有日期），带有时区</td>
<td style="text-align:center">00:00:00+1459</td>
<td style="text-align:center">24:00:00-1459</td>
<td style="text-align:center">1微秒</td>
</tr>
<tr>
<td style="text-align:center">interval [ fields ] [ (p) ]</td>
<td style="text-align:center">16字节</td>
<td style="text-align:center">时间间隔</td>
<td style="text-align:center">-178000000年</td>
<td style="text-align:center">178000000年</td>
<td style="text-align:center">1微秒</td>
</tr>
</tbody>
</table>
<h3 id="date">DATE<a hidden class="anchor" aria-hidden="true" href="#date">#</a></h3>
<ol>
<li>创建一个新表，名称为 test_date。
<ul>
<li>这是一个整数类型的列，被定义为自增主键。每当有新记录插入到表中时，如果没有为 id 指定值，数据库会自动为它分配下一个可用的整数值。</li>
<li>这是一个日期类型的列，默认值是当前日期(CURRENT_DATE)，并且不允许为空。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_date</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">date_value</span><span class="w"> </span><span class="nb">DATE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_DATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>要将数据插入 DATE 列，您必须确保数据采用 yyyy-mm-dd 格式。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test_date</span><span class="w"> </span><span class="p">(</span><span class="n">date_value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;2022-08-29&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;2022-08-31&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | date_value
</span></span></span><span class="line"><span class="cl"><span class="cm">----+------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-29
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022-08-30
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | 2022-08-31
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="3">
<li>要更新 DATE 数据，使用该 UPDATE 语句并传入一个 yyyy-mm-dd 格式的值。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2022-09-01&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | date_value
</span></span></span><span class="line"><span class="cl"><span class="cm">----+------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | 2022-09-01
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="4">
<li>查找日期为 2022-08-30，请使用以下语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | date_value
</span></span></span><span class="line"><span class="cl"><span class="cm">----+------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022-08-30
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>查找日期小于 2022-09-01 的所有的行，如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">test_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;2022-09-01&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | date_value
</span></span></span><span class="line"><span class="cl"><span class="cm">----+------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-29
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022-08-30
</span></span></span><span class="line"><span class="cl"><span class="cm">(2 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="6">
<li>PostgreSQL 提供了 TO_CHAR() 函数以按照指定格式输出日期值。 TO_CHAR() 函数接受两个参数。第一个参数是要格式化的日期值，第二个参数是格式。要以 yyyy/mm/dd 格式显示日期，请使用以下语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">to_char</span><span class="p">(</span><span class="n">date_value</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;yyyy/mm/dd&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">test_date</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |  to_char
</span></span></span><span class="line"><span class="cl"><span class="cm">----+------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022/08/29
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022/08/30
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | 2022/09/01
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="7">
<li>日期相关函数。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 获取当前日期，使用 current_date，结果的格式为：yyyy-mm-dd
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()::</span><span class="nb">date</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">current_date</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> current_date
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2023-09-24
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 要以特定格式输出日期值，可以使用TO_CHAR()函数。
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 该TO_CHAR()函数接受两个参数。第一个参数是要格式化的值，第二个参数是定义输出格式的模板。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TO_CHAR</span><span class="p">(</span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dd/mm/yyyy&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">  to_char
</span></span></span><span class="line"><span class="cl"><span class="cm">------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 23/06/2023
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">TO_CHAR</span><span class="p">(</span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Mon dd, yyyy&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">   to_char
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> Sep 26, 2023
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 指定格式的日期字符串转为日期值，使用 to_date() 函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">to_date</span><span class="p">(</span><span class="s1">&#39;2022-09-30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output:
</span></span></span><span class="line"><span class="cl"><span class="cm">  to_date
</span></span></span><span class="line"><span class="cl"><span class="cm">------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2022-09-30
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 获取两个日期之间的间隔
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hire_date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> first_name | last_name |           diff
</span></span></span><span class="line"><span class="cl"><span class="cm">------------+-----------+---------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> Shannon    | Freeman   | 4191 days 08:25:30.634458
</span></span></span><span class="line"><span class="cl"><span class="cm"> Sheila     | Wells     | 4922 days 08:25:30.634458
</span></span></span><span class="line"><span class="cl"><span class="cm"> Ethel      | Webb      | 5652 days 08:25:30.634458
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 获取日期值中的年、月、日部分，使用 date_part() 函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">)</span><span class="w"> </span><span class="s2">&#34;year&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">)</span><span class="w"> </span><span class="s2">&#34;month&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">current_date</span><span class="p">)</span><span class="w"> </span><span class="s2">&#34;day&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> year | month | day
</span></span></span><span class="line"><span class="cl"><span class="cm">------+-------+-----
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2023 |     9 | 24
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 计算年龄（年、月、日）
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 要计算相对于当前日期的年龄（以年、月和日为单位），请使用AGE()函数。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employee_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">AGE</span><span class="p">(</span><span class="n">birth_date</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> employee_id | first_name | last_name |           age
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------+------------+-----------+-------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">           1 | Shannon    | Freeman   | 36 years 5 mons 22 days
</span></span></span><span class="line"><span class="cl"><span class="cm">           2 | Sheila     | Wells     | 38 years 4 mons 18 days
</span></span></span><span class="line"><span class="cl"><span class="cm">           3 | Ethel      | Webb      | 41 years 5 mons 22 days
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 如果将日期值传递给AGE()函数，它将从当前日期中减去该日期值。如果将两个参数传递给AGE()函数，它将从第一个参数中减去第二个参数。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employee_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">age</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span><span class="n">birth_date</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> employee_id | first_name | last_name |           age
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------+------------+-----------+--------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">           1 | Shannon    | Freeman   | 35 years
</span></span></span><span class="line"><span class="cl"><span class="cm">           2 | Sheila     | Wells     | 36 years 10 mons 24 days
</span></span></span><span class="line"><span class="cl"><span class="cm">           3 | Ethel      | Webb      | 40 years
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 要从日期值获取年、季度、月、周、日，可以使用EXTRACT()函数。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employee_id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">first_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">last_name</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">EXTRACT</span><span class="w"> </span><span class="p">(</span><span class="k">YEAR</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">birth_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">YEAR</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">EXTRACT</span><span class="w"> </span><span class="p">(</span><span class="k">MONTH</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">birth_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">MONTH</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">EXTRACT</span><span class="w"> </span><span class="p">(</span><span class="k">DAY</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">birth_date</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">DAY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">employees</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> employee_id | first_name | last_name | year | month | day
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------+------------+-----------+------+-------+-----
</span></span></span><span class="line"><span class="cl"><span class="cm">           1 | Shannon    | Freeman   | 1980 |     1 |   1
</span></span></span><span class="line"><span class="cl"><span class="cm">           2 | Sheila     | Wells     | 1978 |     2 |   5
</span></span></span><span class="line"><span class="cl"><span class="cm">           3 | Ethel      | Webb      | 1975 |     1 |   1
</span></span></span><span class="line"><span class="cl"><span class="cm">(3 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h3 id="timestamp">TIMESTAMP<a hidden class="anchor" aria-hidden="true" href="#timestamp">#</a></h3>
<ol>
<li>PostgreSQL 时间戳类型用来存储日期和时间组合的数据类型。PostgreSQL 支持两种类型的时间戳数据类型，包括 TIMESTAMP 和 TIMESTAMPTZ：
<ul>
<li>TIMESTAMP 全写为：TIMESTAMP WITHOUT TIME ZONE，用来存储<strong>没有时区</strong>的时间戳。</li>
<li>TIMESTAMPTZ 全写为：TIMESTAMP WITH TIME ZONE，用来存储<strong>带时区</strong>的时间戳。</li>
</ul>
</li>
<li>TIMESTAMP 和 TIMESTAMPTZ 都使用 8 个字节来存储时间戳值。</li>
<li>在 PostgreSQL 内部，TIMESTAMPTZ 类型的值被存储为它对应的 UTC 值。当您从数据库中查询 TIMESTAMPTZ 值时，PostgreSQL 会将 UTC 值转换回数据库服务器、用户或当前数据库连接设置的时区的时间值。PostgreSQL 以 UTC 值存储timestamptz。
<ul>
<li>当您向timestamptz列中插入值时，PostgreSQL 会将该timestamptz值转换为 UTC 值并将该 UTC 值存储在表中。</li>
<li>当您从数据库查询timestamptz值时，PostgreSQL 会将 UTC 值转换回数据库服务器、用户或当前数据库连接设置的时区的时间值。</li>
</ul>
</li>
<li>创建一个新表，名称为 test_timestamp。
<ul>
<li>id 列是标识每行的主键列，它是一个标识列。</li>
<li>该 timestamp_v 列是不带时区的时间戳类型，它不能为 null，并且默认为由 now() 函数产生的当前时间。</li>
<li>该 timestamptz_v 列是带时区的时间戳类型，它不能为 null，并且默认为由 now() 函数产生的当前时间。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test_timestamp</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">timestamp_v</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">timestamptz_v</span><span class="w"> </span><span class="n">TIMESTAMPTZ</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test_timestamp</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp_v</span><span class="p">,</span><span class="w"> </span><span class="n">timestamptz_v</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;2022-08-30 10:10:10&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-08-30 10:10:10&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |     timestamp_v     |     timestamptz_v
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------+------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-30 10:10:10 | 2022-08-30 10:10:10+08
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022-08-30 00:00:00 | 2022-08-30 00:00:00+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(2 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>您不能为时间戳类型指定一个时间类型的值，PostgreSQL 将会给出一个错误。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test_timestamp</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp_v</span><span class="p">,</span><span class="w"> </span><span class="n">timestamptz_v</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;10:10:10&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;10:10:10&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">ERROR:  invalid input syntax for type timestamp: &#34;10:10:10&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">LINE 2: VALUES (&#39;10:10:10&#39;, &#39;10:10:10&#39;)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="6">
<li>要更新 TIMESTAMP 数据，使用该 UPDATE 语句并传入一个正确格式的值。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">UPDATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">test_timestamp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SET</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">timestamp_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2022-08-30 11:11:11&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">timestamptz_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2022-08-30 11:11:11&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">RETURNING</span><span class="w"> </span><span class="o">*</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |     timestamp_v     |     timestamptz_v
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------+------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="7">
<li>查找日期为 2022-08-30 的所有的行，如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">test_timestamp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">timestamp_v</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |     timestamp_v     |     timestamptz_v
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------+------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022-08-30 00:00:00 | 2022-08-30 00:00:00+08
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(2 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="8">
<li>查找日期大于 2022-08-30 的所有的行，如下：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">test_timestamp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">timestamp_v</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2022-08-30&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |     timestamp_v     |     timestamptz_v
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------+------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022-08-30 11:11:11 | 2022-08-30 11:11:11+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="9">
<li>以 yyyy/mm/dd 格式显示时间，请使用以下语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">to_char</span><span class="p">(</span><span class="n">timestamp_v</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY/MM/DD HH24:MI:SS&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">to_char</span><span class="p">(</span><span class="n">timestamptz_v</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY/MM/DD HH24:MI:SS TZH&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">test_timestamp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |       to_char       |         to_char
</span></span></span><span class="line"><span class="cl"><span class="cm">----+---------------------+-------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | 2022/08/30 00:00:00 | 2022/08/30 00:00:00 +08
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 2022/08/30 11:11:11 | 2022/08/30 11:11:11 +08
</span></span></span><span class="line"><span class="cl"><span class="cm">(2 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="10">
<li>时间戳相关函数。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 获取当前时间戳，请使用 now() 或者 current_timestamp
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 除此之外，您还可以使用 transaction_timestamp(), statement_timestamp(), localimestamp(), 或 clock_timestamp() 获取当前的时间戳。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">now</span><span class="p">(),</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">              now              |       current_timestamp       
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------------------------+-------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2024-09-25 12:30:58.789316+08 | 2024-09-25 12:30:58.789316+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 使用 current_timestamp 指定时间戳的小数秒精度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">,</span><span class="w"> </span><span class="k">current_timestamp</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">       current_timestamp       |     current_timestamp     
</span></span></span><span class="line"><span class="cl"><span class="cm">-------------------------------+---------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2024-09-25 12:32:04.488063+08 | 2024-09-25 12:32:04.49+08
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 获取时间值中的年、月、日、时、分、秒的值，请使用 date_part() 函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;year&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;month&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;day&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;hour&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;minute&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">date_part</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">now</span><span class="p">())</span><span class="w"> </span><span class="s2">&#34;second&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> year | month | day | hour | minute |  second   
</span></span></span><span class="line"><span class="cl"><span class="cm">------+-------+-----+------+--------+-----------
</span></span></span><span class="line"><span class="cl"><span class="cm"> 2024 |     9 |  25 |   12 |     32 | 54.977147
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="11">
<li>更多参考：<a href="https://www.rockdata.net/zh-cn/tutorial/type-timestamp/" target="_blank" rel="noopener">https://www.rockdata.net/zh-cn/tutorial/type-timestamp/</a></li>
</ol>
<h3 id="time">TIME<a hidden class="anchor" aria-hidden="true" href="#time">#</a></h3>
<ul>
<li>PostgreSQL 支持 TIME 数据类型，以存储时间值。</li>
<li>PostgreSQL 存储 TIME 数据类型值使用 8 个字节。TIME 数据类型允许的范围是从 00:00:00 到 24:00:00。</li>
<li>TIME 数据类型采用以下格式存储：<code>HH:MI:SS.ssssss</code>
<ul>
<li>HH 表示小时</li>
<li>MI 表示分钟</li>
<li>SS 表示秒</li>
<li>ssssss 表示小数秒</li>
</ul>
</li>
</ul>
<h2 id="枚举类型">枚举类型<a hidden class="anchor" aria-hidden="true" href="#枚举类型">#</a></h2>
<ol>
<li>在 PostgreSQL 中，枚举类型是是一组有序的常量值的集合。比如，您可以使用枚举类型用作订单的状态值。</li>
<li>如果没有枚举类型，您可能使用整数 1, 2, 3 &hellip; 或者字符串表示，但是很容易带来错误，比如书写错误等。用了枚举类型之后，数据库可以保证不能输入错误的值。</li>
<li>枚举标签是大小写敏感的，因此&rsquo;happy&rsquo;与&rsquo;HAPPY&rsquo;是不同的。标签中的空格也是有意义的。</li>
<li>要使用枚举值，您需要使用 CREATE TYPE 语句创建一个自定义的枚举值。
<ul>
<li>name 是要创建的枚举类型的名称。</li>
<li>label 是枚举类型中的常量值。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">shoping=&gt; \h CREATE TYPE
</span></span><span class="line"><span class="cl">Command:     CREATE TYPE
</span></span><span class="line"><span class="cl">Description: define a new data type
</span></span><span class="line"><span class="cl">Syntax:
</span></span><span class="line"><span class="cl">CREATE TYPE name AS ENUM
</span></span><span class="line"><span class="cl">    ( [ &#39;label&#39; [, ... ] ] )
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">URL: https://www.postgresql.org/docs/14/sql-createtype.html
</span></span></code></pre></div><ol start="5">
<li>创建一个表示星期的枚举类型。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">my_week</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ENUM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Thursday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;Sunday&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 创建一个销售表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">week_day_sales</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">week_day</span><span class="w"> </span><span class="n">my_week</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">sales</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 插入数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">week_day_sales</span><span class="w"> </span><span class="p">(</span><span class="n">week_day</span><span class="p">,</span><span class="w"> </span><span class="n">sales</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Thursday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">140</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">160</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Sunday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">170</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">210</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">220</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">230</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Thursday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">250</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">260</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">(</span><span class="s1">&#39;Sunday&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">270</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="6">
<li>向枚举列插入一个错误的值，PostgreSQL 将给出一个错误：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">week_day_sales</span><span class="w"> </span><span class="p">(</span><span class="n">week_day</span><span class="p">,</span><span class="w"> </span><span class="n">sales</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ERROR:  invalid input value for enum my_week: &#34;Error&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">-- LINE 2: VALUES (&#39;Error&#39;, 110);
</span></span></span></code></pre></div><ol start="7">
<li>检索 week_day_sales 表的所有的行。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">week_day_sales</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | week_day  | sales
</span></span></span><span class="line"><span class="cl"><span class="cm">----+-----------+-------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | Monday    |   110
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | Tuesday   |   120
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | Wednesday |   130
</span></span></span><span class="line"><span class="cl"><span class="cm">  4 | Thursday  |   140
</span></span></span><span class="line"><span class="cl"><span class="cm">  5 | Friday    |   150
</span></span></span><span class="line"><span class="cl"><span class="cm">  6 | Saturday  |   160
</span></span></span><span class="line"><span class="cl"><span class="cm">  7 | Sunday    |   170
</span></span></span><span class="line"><span class="cl"><span class="cm">  8 | Monday    |   210
</span></span></span><span class="line"><span class="cl"><span class="cm">  9 | Tuesday   |   220
</span></span></span><span class="line"><span class="cl"><span class="cm"> 10 | Wednesday |   230
</span></span></span><span class="line"><span class="cl"><span class="cm"> 11 | Thursday  |   240
</span></span></span><span class="line"><span class="cl"><span class="cm"> 12 | Friday    |   250
</span></span></span><span class="line"><span class="cl"><span class="cm"> 13 | Saturday  |   260
</span></span></span><span class="line"><span class="cl"><span class="cm"> 14 | Sunday    |   270
</span></span></span><span class="line"><span class="cl"><span class="cm">(14 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="8">
<li>按照枚举类型的值的顺序排序，请使用下面的语句。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">week_day_sales</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">week_day</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id | week_day  | sales
</span></span></span><span class="line"><span class="cl"><span class="cm">----+-----------+-------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | Monday    |   110
</span></span></span><span class="line"><span class="cl"><span class="cm">  8 | Monday    |   210
</span></span></span><span class="line"><span class="cl"><span class="cm">  2 | Tuesday   |   120
</span></span></span><span class="line"><span class="cl"><span class="cm">  9 | Tuesday   |   220
</span></span></span><span class="line"><span class="cl"><span class="cm">  3 | Wednesday |   130
</span></span></span><span class="line"><span class="cl"><span class="cm"> 10 | Wednesday |   230
</span></span></span><span class="line"><span class="cl"><span class="cm">  4 | Thursday  |   140
</span></span></span><span class="line"><span class="cl"><span class="cm"> 11 | Thursday  |   240
</span></span></span><span class="line"><span class="cl"><span class="cm">  5 | Friday    |   150
</span></span></span><span class="line"><span class="cl"><span class="cm"> 12 | Friday    |   250
</span></span></span><span class="line"><span class="cl"><span class="cm">  6 | Saturday  |   160
</span></span></span><span class="line"><span class="cl"><span class="cm"> 13 | Saturday  |   260
</span></span></span><span class="line"><span class="cl"><span class="cm">  7 | Sunday    |   170
</span></span></span><span class="line"><span class="cl"><span class="cm"> 14 | Sunday    |   270
</span></span></span><span class="line"><span class="cl"><span class="cm">(14 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="9">
<li>PostgreSQL 提供了几个用于枚举类型的函数：
<ul>
<li>enum_first() 函数返回由参数指定的枚举类型的第一个枚举值。</li>
<li>enum_last() 函数返回由参数指定的枚举类型的最后一个枚举值。</li>
<li>enum_range() 函数返回由参数指定的枚举类型的所有枚举值，或者指定的范围内的枚举值。</li>
</ul>
</li>
</ol>
<h2 id="网络地址类型">网络地址类型<a hidden class="anchor" aria-hidden="true" href="#网络地址类型">#</a></h2>
<ol>
<li>PostgreSQL提供用于存储 IPv4、IPv6 和 MAC 地址的数据类型。用这些数据类型存储网络地址比用纯文本类型好，因为这些类型提供输入错误检查以及特殊的操作符和函数。
<ul>
<li>INET：用于存储 IPv4 和 IPv6 网络地址，使用无类别域间路由（CIDR）表示法。它只存储网络地址和子网掩码，不存储主机部分。</li>
<li>CIDR：用于存储 IPv4 和 IPv6 主机地址以及网络地址。它既可以存储单个 IP 地址，也可以存储带有子网掩码的 IP 地址和网络。</li>
<li>MACADDR：用于存储媒体访问控制（MAC）地址，通常是 48 位的以太网地址。</li>
<li>MACADDR8：用于存储扩展的唯一标识符（EUI-64）格式的 MAC 地址，这通常用于 IPv6 的链路本地地址。（在 PostgreSQL 10 及以后版本中引入）</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储尺寸</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cidr</td>
<td style="text-align:center">7或19字节</td>
<td style="text-align:center">IPv4和IPv6网络</td>
</tr>
<tr>
<td style="text-align:center">inet</td>
<td style="text-align:center">7或19字节</td>
<td style="text-align:center">IPv4和IPv6主机以及网络</td>
</tr>
<tr>
<td style="text-align:center">macaddr</td>
<td style="text-align:center">6字节</td>
<td style="text-align:center">MAC地址</td>
</tr>
<tr>
<td style="text-align:center">macaddr8</td>
<td style="text-align:center">8 bytes</td>
<td style="text-align:center">MAC地址（EUI-64格式）</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>在对inet或者cidr数据类型进行排序的时候，IPv4 地址将总是排在 IPv6 地址前面，包括那些封装或者是映射在 IPv6 地址里 的 IPv4 地址，例如 ::10.2.3.4 或者 ::ffff::10.4.3.2。</li>
<li>使用示例：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- 创建一个新表以演示网络类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">network_examples</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ipv4_cidr</span><span class="w"> </span><span class="n">cidr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ipv6_cidr</span><span class="w"> </span><span class="n">cidr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ipv4_inet</span><span class="w"> </span><span class="n">inet</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ipv6_inet</span><span class="w"> </span><span class="n">inet</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mac_address</span><span class="w"> </span><span class="n">macaddr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">mac_address_eui64</span><span class="w"> </span><span class="n">macaddr8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 插入示例数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">network_examples</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ipv4_cidr</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ipv6_cidr</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ipv4_inet</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ipv6_inet</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mac_address</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">mac_address_eui64</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;192.168.1.0/24&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;2001:db8::/32&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;192.168.1.5&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;2001:db8::1&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;08:00:2b:01:02:03&#39;</span><span class="p">,</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="s1">&#39;00:1A:2B:3C:4D:5E:00:1A&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 查询并显示插入的数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">network_examples</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm"> id |   ipv4_cidr    |   ipv6_cidr   |  ipv4_inet  |  ipv6_inet  |    mac_address    |    mac_address_eui64    
</span></span></span><span class="line"><span class="cl"><span class="cm">----+----------------+---------------+-------------+-------------+-------------------+-------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | 192.168.1.0/24 | 2001:db8::/32 | 192.168.1.5 | 2001:db8::1 | 08:00:2b:01:02:03 | 00:1a:2b:3c:4d:5e:00:1a
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h2 id="几何类型">几何类型<a hidden class="anchor" aria-hidden="true" href="#几何类型">#</a></h2>
<ol>
<li>几何数据类型表示二维的空间物体。</li>
<li>PostgreSQL 有一系列丰富的函数和操作符可用来进行各种几何操作， 如缩放、平移、旋转和计算相交等。</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">名字</th>
<th style="text-align:center">存储尺寸</th>
<th style="text-align:center">表示</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">point</td>
<td style="text-align:center">16字节</td>
<td style="text-align:center">平面上的点</td>
<td style="text-align:center">(x,y)</td>
</tr>
<tr>
<td style="text-align:center">line</td>
<td style="text-align:center">32字节</td>
<td style="text-align:center">无限长的线</td>
<td style="text-align:center">{A,B,C}</td>
</tr>
<tr>
<td style="text-align:center">lseg</td>
<td style="text-align:center">32字节</td>
<td style="text-align:center">有限线段</td>
<td style="text-align:center">((x1,y1),(x2,y2))</td>
</tr>
<tr>
<td style="text-align:center">box</td>
<td style="text-align:center">32字节</td>
<td style="text-align:center">矩形框</td>
<td style="text-align:center">((x1,y1),(x2,y2))</td>
</tr>
<tr>
<td style="text-align:center">path</td>
<td style="text-align:center">16+16n字节</td>
<td style="text-align:center">封闭路径（类似于多边形）</td>
<td style="text-align:center">((x1,y1),&hellip;)</td>
</tr>
<tr>
<td style="text-align:center">path</td>
<td style="text-align:center">16+16n字节</td>
<td style="text-align:center">开放路径</td>
<td style="text-align:center">[(x1,y1),&hellip;]</td>
</tr>
<tr>
<td style="text-align:center">polygon</td>
<td style="text-align:center">40+16n字节</td>
<td style="text-align:center">多边形（类似于封闭路径）</td>
<td style="text-align:center">((x1,y1),&hellip;)</td>
</tr>
<tr>
<td style="text-align:center">circle</td>
<td style="text-align:center">24字节</td>
<td style="text-align:center">圆</td>
<td style="text-align:center">&lt;(x,y),r&gt;（中心点和半径）</td>
</tr>
</tbody>
</table>
<h3 id="点">点<a hidden class="anchor" aria-hidden="true" href="#点">#</a></h3>
<ol>
<li>点是几何类型的基本二维构造块。用下面的语法描述point类型的值：<code>(x , y)</code>，其中x和y分别是坐标，都是浮点数。</li>
</ol>
<h3 id="线">线<a hidden class="anchor" aria-hidden="true" href="#线">#</a></h3>
<ol>
<li>线由线性方程Ax + By + C = 0 表示，其中A和B都不为零。类型line 的值采用以下形式输入和输出：<code>{A, B, C}</code>。</li>
<li>另外，还可以用下列任一形式输入：其中<code>(x1,y1)</code>和<code>(x2,y2)</code>是线上不同的两点。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[ ( x1 , y1 ) , ( x2 , y2 ) ]
</span></span></code></pre></div><h3 id="线段">线段<a hidden class="anchor" aria-hidden="true" href="#线段">#</a></h3>
<ol>
<li>线段用一对线段的端点来表示。lseg类型的值用下面的语法声明：其中<code>(x1,y1)</code>和<code>(x2,y2)</code>是线段的端点。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[ ( x1 , y1 ) , ( x2 , y2 ) ]
</span></span></code></pre></div><h3 id="方框">方框<a hidden class="anchor" aria-hidden="true" href="#方框">#</a></h3>
<ol>
<li>方框用其对角的点对表示。box类型的值使用下面的语法指定：其中<code>(x1,y1)</code>和<code>(x2,y2)</code>是方框的对角点。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">( ( x1 , y1 ) , ( x2 , y2 ) )
</span></span></code></pre></div><ol start="2">
<li>在输入时可以提供任意两个对角，但是值将根据需要被按顺序记录为右上角和左下角。</li>
</ol>
<h3 id="路径">路径<a hidden class="anchor" aria-hidden="true" href="#路径">#</a></h3>
<ol>
<li>路径由一系列连接的点组成。路径可能是开放的，也就是认为列表中第一个点和最后一个点没有被连接起来；也可能是封闭的，这时认为第一个和最后一个点被连接起来。</li>
<li>path类型的值用下面的语法声明：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">[ ( x1 , y1 ) , ... , ( xn , yn ) ]
</span></span></code></pre></div><ol start="3">
<li>其中的点是组成路径的线段的端点。方括弧（[]）表示一个开放的路径，圆括弧（()）表示一个封闭的路径。如第三种到第五种语法所示，当最外面的圆括号被忽略时，路径将被假定为封闭。</li>
</ol>
<h3 id="多边形">多边形<a hidden class="anchor" aria-hidden="true" href="#多边形">#</a></h3>
<ol>
<li>多边形由一系列点代表（多边形的顶点）。多边形和封闭路径很像，但是存储方式不一样而且有自己的一套支持例程。</li>
<li>polygon类型的值用下列语法声明：其中的点是组成多边形边界的线段的端点。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">( ( x1 , y1 ) , ... , ( xn , yn ) )
</span></span></code></pre></div><h3 id="圆">圆<a hidden class="anchor" aria-hidden="true" href="#圆">#</a></h3>
<ol>
<li>圆由一个圆心和一个半径代表。circle类型的值用下面的语法指定：其中<code>(x,y)</code>是圆心，而r是圆的半径。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&gt;</span><span class="w">
</span></span></span></code></pre></div><h3 id="示例">示例<a hidden class="anchor" aria-hidden="true" href="#示例">#</a></h3>
<ol>
<li>创建 geometric_types 表：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">geometric_types</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">point_value</span><span class="w"> </span><span class="n">point</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">line_value</span><span class="w"> </span><span class="n">line</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">lseg_value</span><span class="w"> </span><span class="n">lseg</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">box_value</span><span class="w"> </span><span class="n">box</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">closed_path_value</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">open_path_value</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">polygon_value</span><span class="w"> </span><span class="n">polygon</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">circle_value</span><span class="w"> </span><span class="n">circle</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">geometric_types</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">point_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">line_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">lseg_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">box_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">closed_path_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">open_path_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">polygon_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">circle_value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s1">&#39;(10, 20)&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;{2,1,1}&#39;</span><span class="p">,</span><span class="w">    </span><span class="c1">-- 无限长的线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;[(0,0),(10,10)]&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 有限线段
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;((0,0),(10,10))&#39;</span><span class="p">,</span><span class="w">   </span><span class="c1">-- 矩形框
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;((0,0),(10,0),(10,10),(0,10),(0,0))&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 封闭路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;[(0,0),(10,10)]&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 开放路径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;((0,0),(10,0),(10,10),(0,10),(0,0))&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1">-- 多边形
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="s1">&#39;&lt;(5,5),10&gt;&#39;</span><span class="w">       </span><span class="c1">-- 圆
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>查询数据：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">geometric_types</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">id | point_value | line_value |   lseg_value    |   box_value   |          closed_path_value          | open_path_value |            polygon_value            | circle_value 
</span></span></span><span class="line"><span class="cl"><span class="cm">----+-------------+------------+-----------------+---------------+-------------------------------------+-----------------+-------------------------------------+--------------
</span></span></span><span class="line"><span class="cl"><span class="cm">  1 | (10,20)     | {2,1,1}    | [(0,0),(10,10)] | (10,10),(0,0) | ((0,0),(10,0),(10,10),(0,10),(0,0)) | [(0,0),(10,10)] | ((0,0),(10,0),(10,10),(0,10),(0,0)) | &lt;(5,5),10&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h2 id="位串类型">位串类型<a hidden class="anchor" aria-hidden="true" href="#位串类型">#</a></h2>
<ol>
<li>位串就是一串 1 和 0 的串。它们可以用于存储和可视化位掩码。我们有两种类型的 SQL 位类型：<strong>bit(n)</strong> 和 <strong>bit varying(n)</strong>，其中n是一个正整数。</li>
<li>bit类型的数据必须准确匹配长度n; 试图存储短些或者长一些的位串都是错误的。bit varying数据是最长n的变长类型，更长的串会被拒绝。写一个没有长度的bit等效于 bit(1)，没有长度的bit varying意味着没有长度限制。</li>
<li>使用示例：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="nb">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w">        </span><span class="c1">-- 固定位数 3 bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="nb">BIT</span><span class="w"> </span><span class="nb">VARYING</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="c1">-- 边长位数，最大 5 bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;101&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;00&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ERROR:  bit string length 2 does not match type bit(3)
</span></span></span><span class="line"><span class="cl"><span class="c1">-- B&#39;10&#39; 有问题
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;10&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;101&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;10&#39;</span><span class="p">::</span><span class="nb">bit</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;101&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">test</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/* Output：
</span></span></span><span class="line"><span class="cl"><span class="cm">  a  |  b  
</span></span></span><span class="line"><span class="cl"><span class="cm">-----+-----
</span></span></span><span class="line"><span class="cl"><span class="cm"> 101 | 00
</span></span></span><span class="line"><span class="cl"><span class="cm"> 100 | 101
</span></span></span><span class="line"><span class="cl"><span class="cm">(2 rows)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div>

<p><details >
  <summary markdown="span">位串函数和运算符</summary>
  <blockquote>
<ol>
<li>位串运算符。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- bit || bit → bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;011&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 10001011
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit &amp; bit → bit 按位 AND（输入的长度必须相等）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;01101&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 00001
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit | bit → bit 按位或（输入必须具有相同的长度）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;01101&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 11101
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit # bit → bit 按位异或（输入必须具有相同的长度）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">#</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;01101&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 11100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- ~ bit → bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 01110
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit &lt;&lt; integer → bit 按位左移（保留字符串长度）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 01000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit &gt;&gt; integer → bit 按位右移（保留字符串长度）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;10001&#39;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 00100
</span></span></span></code></pre></div><ol start="2">
<li>位串函数。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- bit_count ( bit ) → bigint 返回位串中设置的位数（也称为“popcount”）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">bit_count</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;10111&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- bit_length ( bit ) → integer 返回位串中的位数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">bit_length</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;10111&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- length ( bit ) → integer 返回位串中的位数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">length</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;10111&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- octet_length ( bit ) → integer 返回位串中的字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">octet_length</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;1011111011&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- overlay ( bits bit PLACING newsubstring bit FROM start integer [ FOR count integer ] ) → bit
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 将 bits 中从第 start 位开始并扩展到 count 位的子字符串替换为 newsubstring。
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 如果省略 count，则默认为 newsubstring 的长度。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">overlay</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;01010101010101010&#39;</span><span class="w"> </span><span class="k">placing</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;11111&#39;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 0111110101010101010
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 01  010101010101010
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 0111110101010101010
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- position ( substring bit IN bits bit ) → integer
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 返回 bits 内指定 substring 的第一个起始索引，如果不存在则返回零
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">position</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;010&#39;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">B</span><span class="s1">&#39;000001101011&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 8
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 000001101011
</span></span></span><span class="line"><span class="cl"><span class="c1">--        010
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- substring ( bits bit [ FROM start integer ] [ FOR count integer ] ) → bit
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 提取 bits 的子字符串，如果指定，则从第 start 位开始，并在 count 位之后停止（如果指定）。
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 至少提供 start 和 count 之一。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;110010111111&#39;</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 00
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 110010111111
</span></span></span><span class="line"><span class="cl"><span class="c1">--   00
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- get_bit ( bits bit , n integer ) → integer
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 从位串中提取 n 第位；第一个（最左边）位是位 0(下标从0开始)。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">get_bit</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;101010101010101010&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 1
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 101010101010101010
</span></span></span><span class="line"><span class="cl"><span class="c1">--       1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- set_bit ( bits bit , n integer , newvalue integer ) → bit
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 将位串中的 n 第 1 位设置为 newvalue ；第一个（最左边）位是位 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">set_bit</span><span class="p">(</span><span class="n">B</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">-- 101010001010101010
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 101010101010101010
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 101010001010101010
</span></span></span></code></pre></div><ol start="3">
<li>类型转换。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="mi">44</span><span class="p">::</span><span class="nb">bit</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">             </span><span class="c1">-- 0000101100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="mi">44</span><span class="p">::</span><span class="nb">bit</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">              </span><span class="c1">-- 100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="k">cast</span><span class="p">(</span><span class="o">-</span><span class="mi">44</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">bit</span><span class="p">(</span><span class="mi">12</span><span class="p">));</span><span class="w">    </span><span class="c1">-- 111111010100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="s1">&#39;1110&#39;</span><span class="p">::</span><span class="nb">bit</span><span class="p">(</span><span class="mi">4</span><span class="p">)::</span><span class="nb">integer</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 14
</span></span></span></code></pre></div></blockquote>

</details></p>

<h2 id="json">JSON<a hidden class="anchor" aria-hidden="true" href="#json">#</a></h2>
<ol>
<li>JSON 是一种通用的、轻量级的数据传输格式，它可以表示复杂的、结构化的数据，但同时也易于阅读和编写。</li>
<li>PostgreSQL 从 9.2 版本开始支持原生 JSON 数据类型，并且提供了许多用于操作 JSON 数据的函数和运算符。</li>
<li>JSON 对象是一个键值对的组合。键是字符串类型的文本，值可以是上面定义的几种类型的任何一种。
<ul>
<li>对象、数组、字符串、数字、true、false、null</li>
</ul>
</li>
<li>PostgreSQL 支持两种 JSON 类型：JSON 和 JSONB。他们的处理效率不同。JSON 按文本保存输入数据，保留原始数据中的空格，重复键。JSONB 则按照二进制保存输入数据，他会删除没必要的空格以及重复的键。使用时不用再次解析。两者对重复键的处理都是保留最后一个键值对。效率的差别：json类型存储快，使用慢，jsonb类型存储稍慢，使用较快。但在操作上，二者是没有区别的。</li>
<li>要将一个字符串的 JSON 文本转为 JSON 类型的值，您可以使用如下两种方法：
<ul>
<li>使用 JSON() 构造函数将 JSON 文本转为 JSON 类型的值：<code>json('[1, 2, 3]')</code></li>
<li>使用类型转换将 JSON 文本转为 JSON 类型的值：<code>'{&quot;a&quot;: [1, 2, 3]}'::json</code></li>
</ul>
</li>
<li>PostgreSQL 提供了几个用于 JSON 数据的操作符，如下：(json和jsonb都适用)
<ul>
<li><strong>-&gt;</strong>: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为 JSON 类型的值。</li>
<li><strong>-&raquo;</strong>: 获取 JSON 数组的元素或者 JSON 对象中的字段，返回值为文本。</li>
<li><strong>#&gt;</strong>: 获取指定路径的值，返回值为 JSON 类型的值。</li>
<li><strong>#&raquo;</strong>: 获取指定路径的值，返回值为文本。</li>
</ul>
</li>
</ol>
<h3 id="json-1">JSON<a hidden class="anchor" aria-hidden="true" href="#json-1">#</a></h3>
<ol>
<li>使用示例：JSON 类型</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">my_schema</span><span class="p">.</span><span class="n">login_logs</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">GENERATED</span><span class="w"> </span><span class="n">ALWAYS</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">detail</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">my_schema</span><span class="p">.</span><span class="n">login_logs</span><span class="w"> </span><span class="p">(</span><span class="n">detail</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;{ &#34;name&#34;: &#34;Tom&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.23&#34;,&#34;country&#34;: &#34;US&#34;}}&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;{ &#34;name&#34;: &#34;Tim&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.24&#34;,&#34;country&#34;: &#34;US&#34;}}&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">(</span><span class="s1">&#39;{ &#34;name&#34;: &#34;Jim&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.25&#34;,&#34;country&#34;: &#34;UK&#34;}}&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>查询JSON数据。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; SELECT * FROM my_schema.login_logs;
</span></span><span class="line"><span class="cl"> id |                               detail                                
</span></span><span class="line"><span class="cl">----+---------------------------------------------------------------------
</span></span><span class="line"><span class="cl">  1 | { &#34;name&#34;: &#34;Tom&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.23&#34;,&#34;country&#34;: &#34;US&#34;}}
</span></span><span class="line"><span class="cl">  2 | { &#34;name&#34;: &#34;Tim&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.24&#34;,&#34;country&#34;: &#34;US&#34;}}
</span></span><span class="line"><span class="cl">  3 | { &#34;name&#34;: &#34;Jim&#34;, &#34;address&#34;: {&#34;ip&#34;: &#34;192.168.1.25&#34;,&#34;country&#34;: &#34;UK&#34;}}
</span></span><span class="line"><span class="cl">(3 rows)
</span></span></code></pre></div><ol start="3">
<li>如果您想显示 JSON 对象内部的字段，请使用 -&gt; 和 -&raquo; 操作符。-&gt; 返回的值是 JSON 类型，-&raquo; 返回的值是文本类型。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; 
</span></span><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">  detail -&gt; &#39;name&#39; AS name_json,
</span></span><span class="line"><span class="cl">  detail -&gt;&gt; &#39;name&#39; AS name_text
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">  login_logs;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> name_json | name_text 
</span></span><span class="line"><span class="cl">-----------+-----------
</span></span><span class="line"><span class="cl"> &#34;Tom&#34;     | Tom
</span></span><span class="line"><span class="cl"> &#34;Tim&#34;     | Tim
</span></span><span class="line"><span class="cl"> &#34;Jim&#34;     | Jim
</span></span><span class="line"><span class="cl">(3 rows)
</span></span></code></pre></div><ol start="4">
<li>获取所有登陆用的国家和 IP，请使用下面的语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; 
</span></span><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">  detail -&gt; &#39;address&#39; -&gt;&gt; &#39;country&#39; as country,
</span></span><span class="line"><span class="cl">  detail -&gt; &#39;address&#39; -&gt;&gt; &#39;ip&#39; as ip
</span></span><span class="line"><span class="cl">FROM login_logs;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> country |      ip      
</span></span><span class="line"><span class="cl">---------+--------------
</span></span><span class="line"><span class="cl"> US      | 192.168.1.23
</span></span><span class="line"><span class="cl"> US      | 192.168.1.24
</span></span><span class="line"><span class="cl"> UK      | 192.168.1.25
</span></span><span class="line"><span class="cl">(3 rows)
</span></span></code></pre></div><ol start="5">
<li>您可以在 WHERE 子句中使用 JSON 运算符来过滤返回的行。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">postgres=&gt; 
</span></span><span class="line"><span class="cl">SELECT
</span></span><span class="line"><span class="cl">  detail -&gt;&gt; &#39;name&#39; AS name,
</span></span><span class="line"><span class="cl">  detail -&gt; &#39;address&#39; -&gt;&gt; &#39;country&#39; AS country
</span></span><span class="line"><span class="cl">FROM
</span></span><span class="line"><span class="cl">  login_logs
</span></span><span class="line"><span class="cl">WHERE
</span></span><span class="line"><span class="cl">  detail -&gt; &#39;address&#39; -&gt;&gt; &#39;country&#39; = &#39;US&#39;;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> name | country 
</span></span><span class="line"><span class="cl">------+---------
</span></span><span class="line"><span class="cl"> Tom  | US
</span></span><span class="line"><span class="cl"> Tim  | US
</span></span><span class="line"><span class="cl">(2 rows)
</span></span></code></pre></div><h3 id="jsonb">JSONB<a hidden class="anchor" aria-hidden="true" href="#jsonb">#</a></h3>
<ol>
<li>使用示例：JSONB</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">info</span><span class="w"> </span><span class="n">jsonb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;{&#34;id&#34;:1,&#34;name&#34;:&#34;张三&#34;, &#34;age&#34;:12}&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 在json查询结果里插入新的key值gender
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">info</span><span class="o">||</span><span class="s1">&#39;{&#34;gender&#34;:&#34;男&#34;}&#39;</span><span class="p">::</span><span class="n">jsonb</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;id&#39;</span><span class="p">)::</span><span class="n">int4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">                       ?column?                       
</span></span></span><span class="line"><span class="cl"><span class="cm">------------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> {&#34;id&#34;: 1, &#34;age&#34;: 12, &#34;name&#34;: &#34;张三&#34;, &#34;gender&#34;: &#34;男&#34;}
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="2">
<li>Postgres里的查询需要用到查询符。比如说，我们要查询id为1的数据，语句如下：
<ul>
<li>@&gt; 这个查询符，表明info当前这条记录里的顶层json中有没有id为1的key-value对；有的话则满足条件。</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">@&gt;</span><span class="w"> </span><span class="s1">&#39;{&#34;id&#34;:1}&#39;</span><span class="p">::</span><span class="n">jsonb</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">                 info                 
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> {&#34;id&#34;: 1, &#34;age&#34;: 12, &#34;name&#34;: &#34;张三&#34;}
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="3">
<li>查询 age&gt;16 的记录，并且只显示 name。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">)::</span><span class="n">int4</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> ?column? 
</span></span></span><span class="line"><span class="cl"><span class="cm">----------
</span></span></span><span class="line"><span class="cl"><span class="cm"> &#34;张三&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="4">
<li>将 age 从 12 改为 22 ，SQL语句：</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">||</span><span class="s1">&#39;{&#34;age&#34;:22}&#39;</span><span class="p">::</span><span class="n">jsonb</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;&gt;</span><span class="s1">&#39;id&#39;</span><span class="p">)::</span><span class="n">int4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">               ?column?               
</span></span></span><span class="line"><span class="cl"><span class="cm">--------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> {&#34;id&#34;: 1, &#34;age&#34;: 22, &#34;name&#34;: &#34;张三&#34;}
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><ol start="5">
<li>删除age这个key，直接用操作符 - 即可。</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">name_age</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="p">)::</span><span class="n">int4</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">         ?column?          
</span></span></span><span class="line"><span class="cl"><span class="cm">---------------------------
</span></span></span><span class="line"><span class="cl"><span class="cm"> {&#34;id&#34;: 1, &#34;name&#34;: &#34;张三&#34;}
</span></span></span><span class="line"><span class="cl"><span class="cm">(1 row)
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://heliu.site/tags/pgsql/">Pgsql</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://heliu.site/posts/postgresql/database/">
    <span class="title">« 上一页</span>
    <br>
    <span>数据库与模式</span>
  </a>
  <a class="next" href="https://heliu.site/posts/postgresql/query/">
    <span class="title">下一页 »</span>
    <br>
    <span>查询</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    
    <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv">
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
    </span>
    <span id="busuanzi_container_site_uv">
        本站访客数<span id="busuanzi_value_site_uv"></span>人次
    </span>
    </div>
        <span>Copyright © 2024 蜀ICP备2024091074号 <a href="#">heliu's blog</a>. All rights reserved</span>  
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Done';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
